<eventParser name="CiscoWLC4Parser">
  <deviceType>
    <Vendor>Cisco</Vendor>
    <Model>WLAN Controller</Model>
    <Version>ANY</Version>
  </deviceType>

  <eventFormatRecognizer><![CDATA[\tSNMPv2-MIB::snmpTrapOID\.0 = OID: SNMPv2-SMI::enterprises\.9\.9\.(?:513|515|598)\.]]></eventFormatRecognizer>

  <testEvents>
    <testEvent><![CDATA[2015-06-10 10:38:22 0.0.0.0TRAP2, SNMP v2c, community DLS22870	. Cold Start Trap (0) Uptime: 0:00:00.00	DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (376745200) 43 days, 14:30:52.00	SNMPv2-MIB::snmpTrapOID.0 = OID: SNMPv2-SMI::enterprises.9.9.513.0.19	SNMPv2-SMI::enterprises.9.9.513.3.2.0 = Hex-STRING: 00 0D 67 5D 0F 7B 	SNMPv2-SMI::enterprises.9.9.513.1.1.1.1.1.0 = Hex-STRING: 1C E6 C7 84 45 50 	SNMPv2-SMI::enterprises.9.9.513.1.2.2.1.1.0 = INTEGER: 1	SNMPv2-SMI::enterprises.9.9.513.3.4.0 = STRING: "XFBSECA7HE6H"	SNMPv2-SMI::enterprises.9.9.513.3.13.0 = INTEGER: 149	SNMPv2-SMI::enterprises.9.9.513.3.14.0 = INTEGER: -80	SNMPv2-SMI::enterprises.9.9.513.3.15.0 = INTEGER: 15	SNMPv2-SMI::enterprises.9.9.513.3.18.0 = INTEGER: 0	SNMPv2-SMI::enterprises.9.9.513.3.17.0 = INTEGER: 0	SNMPv2-SMI::enterprises.9.9.513.1.2.1.1.2.0 = INTEGER: 2	SNMPv2-SMI::enterprises.9.9.513.1.1.1.1.5.0 = STRING: "MVNOCAP03"	SNMPv2-SMI::enterprises.9.9.513.3.12.0 = INTEGER: 3	SNMPv2-SMI::enterprises.9.9.513.3.19.0 = INTEGER: 2	SNMPv2-SMI::enterprises.9.9.513.3.20.0 = INTEGER: 2	SNMPv2-SMI::enterprises.9.9.610.1.1.3.1.1.8.0 = INTEGER: 2458616	SNMPv2-SMI::enterprises.9.9.610.1.1.3.1.1.1.0 = ""	SNMPv2-SMI::enterprises.9.9.513.3.21.0 = Hex-STRING: 00 00 00 00 00 00 	SNMPv2-SMI::enterprises.9.9.513.3.22.0 = INTEGER: 0]]></testEvent>
  </testEvents>

  <parsingInstructions>
    <collectFieldsByRegex src="$_rawmsg">
      <regex><![CDATA[<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>\s+<_time:gPatTime>\s+.*SNMPv2-MIB::snmpTrapOID\.0 = OID: SNMPv2-SMI::enterprises\.9\.9\.<_oid:gPatInt>\.0.<_eventType:gPatInt>\t<_body:gPatMesgBody>]]></regex>
    </collectFieldsByRegex>

    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>
    <setEventAttribute attr="eventType">Cisco-WLC-Generic</setEventAttribute>
    <setEventAttribute attr="extEventRecvProto">Snmp Trap</setEventAttribute>

    <choose>
      <when test="$_oid = '513'">
        <collectAndSetAttrByKeyValuePair sep="\t" src="$_body">
          <attrKeyMap attr="_hostMACAddr" key="SNMPv2-SMI::enterprises.9.9.513.1.1.1.1.1.0 = Hex-STRING: "/>
          <attrKeyMap attr="_nepMACAddr" key="SNMPv2-SMI::enterprises.9.9.513.3.2.0 = Hex-STRING: "/>
          <attrKeyMap attr="wlanSsid" key="SNMPv2-SMI::enterprises.9.9.513.3.4.0 = STRING: "/>
        </collectAndSetAttrByKeyValuePair>

        <choose>
          <when test="$_eventType = '1'">
            <setEventAttribute attr="eventType">Cisco-WLC-1-ApIfRegulatoryDomainMismatchNotif</setEventAttribute>
          </when>

          <when test="$_eventType = '2'">
            <setEventAttribute attr="eventType">Cisco-WLC-2-ApCrash</setEventAttribute>
          </when>

          <when test="$_eventType = '3'">
            <setEventAttribute attr="eventType">Cisco-WLC-3-ApUnsupported</setEventAttribute>
          </when>

          <when test="$_eventType = '4'">
            <setEventAttribute attr="eventType">Cisco-WLC-4-ApAssociated</setEventAttribute>
            <collectAndSetAttrByRegex src="$_body">
              <regex><![CDATA[SNMPv2-SMI::enterprises\.9\.9\.513\.1\.1\.1\.1\.5\.[\d.]+ = STRING: "<nepDevName:gPatMesgBodyMin>"]]></regex>
            </collectAndSetAttrByRegex>
          </when>

          <when test="$_eventType = '5'">
            <setEventAttribute attr="eventType">Cisco-WLC-5-ApPower</setEventAttribute>
          </when>

          <when test="$_eventType = '6'">
            <setEventAttribute attr="eventType">Cisco-WLC-6-ApRogueApDetected</setEventAttribute>
          </when>

          <when test="$_eventType = '7'">
            <setEventAttribute attr="eventType">Cisco-WLC-7-ApRogueApCleared</setEventAttribute>
          </when>

          <when test="$_eventType = '8'">
            <setEventAttribute attr="eventType">Cisco-WLC-8-ApWipsNotification</setEventAttribute>
          </when>

          <when test="$_eventType = '9'">
            <setEventAttribute attr="eventType">Cisco-WLC-9-ApNoDownlinkChannelNotify</setEventAttribute>
          </when>

          <when test="$_eventType = '10'">
            <setEventAttribute attr="eventType">Cisco-WLC-10-ApIfUpNotify</setEventAttribute>
          </when>

          <when test="$_eventType = '11'">
            <setEventAttribute attr="eventType">Cisco-WLC-11-ApIfDownNotify</setEventAttribute>
          </when>
        </choose>

        <when test="exist _nepMACAddr">
          <setEventAttribute attr="nepMACAddr">normalizeMAC($_nepMACAddr)</setEventAttribute>
        </when>
      </when>

      <when test="$_oid = '515'">
        <collectAndSetAttrByKeyValuePair sep="\t" src="$_body">
          <attrKeyMap attr="user" key="SNMPv2-SMI::enterprises.9.9.515.1.1.0 = STRING: "/>
        </collectAndSetAttrByKeyValuePair>

        <when test="$_eventType = '1'">
          <setEventAttribute attr="eventType">Cisco-WLC-1-GuestUserRemoved</setEventAttribute>
        </when>
      </when>

      <when test="$_oid = '598'">
        <collectAndSetAttrByKeyValuePair sep="\t" src="$_body">
          <attrKeyMap attr="serverIpAddr" key="SNMPv2-SMI::enterprises.9.9.598.1.2.1.1.3.183 = STRING: "/>
          <attrKeyMap attr="_hostMACAddr" key="SNMPv2-SMI::enterprises.9.9.598.1.2.1.1.6.183 = Hex-STRING: "/>
          <attrKeyMap attr="user" key="SNMPv2-SMI::enterprises.9.9.598.1.2.1.1.7.183 = STRING: "/>
        </collectAndSetAttrByKeyValuePair>

        <choose>
          <when test="$_eventType = '1'">
            <setEventAttribute attr="eventType">Cisco-WLC-1-ApIfRegulatoryDomainMismatchNotif</setEventAttribute>
          </when>
          <when test="$_eventType = '2'">
            <setEventAttribute attr="eventType">Cisco-WLC-2-ServerGlobalActivated</setEventAttribute>
          </when>
          <when test="$_eventType = '3'">
            <setEventAttribute attr="eventType">Cisco-WLC-3-ServerGlobalDeactivated</setEventAttribute>
          </when>
          <when test="$_eventType = '4'">
            <setEventAttribute attr="eventType">Cisco-WLC-4-ServerWlanActivated</setEventAttribute>
          </when>
          <when test="$_eventType = '5'">
            <setEventAttribute attr="eventType">Cisco-WLC-5-ServerWlanDeactivated</setEventAttribute>
          </when>
          <when test="$_eventType = '6'">
            <setEventAttribute attr="eventType">Cisco-WLC-6-ReqTimedOut</setEventAttribute>
          </when>
        </choose>
      </when>
    </choose>

    <when test="exist _hostMACAddr">
      <setEventAttribute attr="hostMACAddr">normalizeMAC($_hostMACAddr)</setEventAttribute>
    </when>
  </parsingInstructions>
</eventParser>
