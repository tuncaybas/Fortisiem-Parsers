<eventParser name="SymantecDLPParser">
  <deviceType>
    <Vendor>Generic</Vendor>
    <Model>Generic</Model>
    <Version>ANY</Version>
  </deviceType>

  <appType>
    <Vendor>Symantec</Vendor>
    <Model>Data Loss Prevention</Model>
    <Version>ANY</Version>
    <Name>Symantec Data Loss Prevention</Name>
  </appType>

  <testEvents>
    <testEvent><![CDATA[<12>Nov 24 10:19:25  example.com CEF:0|Symantec|DLP|13.0.1|ruleID|Sagitta|5|BLOCKED=Passed DATAOWNER_NAME=N/A DATAOWNER_EMAIL=N/A ENDPOINT_DEVICE_ID=N/A ENDPOINT_MACHINE=N/A PATH=N/A FILE_NAME=N/A PARENT_PATH=N/A INCIDENT_ID=69451 INCIDENT_SNAPSHOT=https://example.com/ProtectManager/IncidentDetail.do?value(variable_1)=incident.id&value(operator_1)=incident.id_in&value(operand_1)=69451 MATCH_COUNT=1 RULES=Name and Phone PROTOCOL=SMTP QUARANTINE_PARENT_PATH=N/A RECIPIENTS=cathy@example.com SCAN=N/A SENDER=user@example.com SEVERITY=1:High SUBJECT=RE: CAU - Regular Mailing Address for Overnights TARGET=N/A FNAME=[UNKNOWN VARIABLE: ATTACHMENT_NAME]]]></testEvent>
  </testEvents>

  <eventFormatRecognizer><![CDATA[^\s*<:gPatSyslogPRI>?<:gPatMon>\s+<:gPatDay>\s+<:gPatTime>\s+<:gPatHostName>\s+CEF\s*:\d+\|Symantec\|DLP\|\d]]></eventFormatRecognizer>

  <parsingInstructions>
    <!-- Mar 18 17:49:36 ABC CEF : -->
    <collectFieldsByRegex src="$_rawmsg">
      <regex><![CDATA[^\s*<:gPatSyslogPRI>?<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<:gPatHostName>\s+CEF\s*:(?:[^|]*\|){6}<_severity:gPatInt>\|<_body:gPatMesgBody>]]></regex>
    </collectFieldsByRegex>

    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_time)</setEventAttribute>
    <setEventAttribute attr="eventType">Symantec-DLP-Generic</setEventAttribute>

    <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
      <attrKeyMap attr="status" key="BLOCKED="/>
      <attrKeyMap attr="fileName" key="FILE_NAME="/>
      <attrKeyMap attr="symEventId" key="INCIDENT_ID="/>
      <attrKeyMap attr="snapshotPath" key="INCIDENT_SNAPSHOT="/>
      <attrKeyMap attr="count" key="MATCH_COUNT="/>
      <attrKeyMap attr="filePath" key="PATH="/>
      <attrKeyMap attr="appTransportProto" key="PROTOCOL="/>
      <attrKeyMap attr="targetUser" key="RECIPIENTS="/>
      <attrKeyMap attr="ruleName" key="RULES="/>
      <attrKeyMap attr="senderMailAddr" key="SENDER="/>
      <attrKeyMap attr="_severity" key="SEVERITY="/>
      <attrKeyMap attr="mailSubject" key="SUBJECT="/>
      <attrKeyMap attr="targetName" key="TARGET="/>
    </collectAndSetAttrByKeyValuePair>

    <when test="exist mailSubject">
      <collectFieldsByRegex src="$_body">
        <regex><![CDATA[\bSUBJECT=<mailSubject:gPatMesgBodyMin>(?:\s+\w+=|\s*$)]]></regex>
      </collectFieldsByRegex>
    </when>

    <when test="exist ruleName">
      <collectFieldsByRegex src="$_body">
        <regex><![CDATA[\bRULES=<ruleName:gPatMesgBodyMin>(?:\s+\w+=|\s*$)]]></regex>
      </collectFieldsByRegex>
    </when>

    <when test="exist status">
      <setEventAttribute attr="eventType">combineMsgId("Symantec-DLP-", $status)</setEventAttribute>
      <setEventAttribute attr="eventType">replaceStringByRegex($eventType, "\s+", "-")</setEventAttribute>
    </when>

    <choose>
      <when test="$_severity = '1:High'">
        <setEventAttribute attr="eventSeverity">10</setEventAttribute>
      </when>
      <when test="$_severity = '2:Medium'">
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>
      <when test="$_severity = '3:Low'">
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>
    </choose>
  </parsingInstructions>
</eventParser>
