<eventParser name="MicrosoftDHCPTrapParser">

  <deviceType>
    <Vendor>Microsoft</Vendor>
    <Model>Windows</Model>
    <Version>ANY</Version>
  </deviceType>

  <appType>
    <Vendor>Microsoft</Vendor>
    <Model>DHCP</Model>
    <Version>ANY</Version>
    <Name>DHCP Server</Name>
  </appType>
  <eventFormatRecognizer><![CDATA[\s+SNMPv2-SMI::enterprises\.311\.]]></eventFormatRecognizer>

  <testEvents>
    <testEvent><![CDATA[2016-04-12 11:29:13 10.6.53.215TRAP, SNMP v1, community B3395668-RO	SNMPv2-SMI::enterprises.311.1.1.3.1.2 Link Up Trap (0) Uptime: 0:00:17.62	IF-MIB::ifIndex.18 = INTEGER: 18]]></testEvent>
    <testEvent><![CDATA[2016-04-12 11:28:59 10.6.53.215TRAP, SNMP v1, community B3395668-RO	SNMPv2-SMI::enterprises.311.1.1.3.1.2 Cold Start Trap (0) Uptime: 0:00:00.00]]></testEvent>
    <testEvent><![CDATA[2016-04-12 12:34:54 10.6.53.215TRAP, SNMP v1, community B3395668-RO	SNMPv2-SMI::enterprises.311.1.1.3.1.2 Authentication Failure Trap (0) Uptime: 1:05:58.93]]></testEvent>
    <testEvent><![CDATA[2016-04-13 12:34:09 10.6.53.215TRAP, SNMP v1, community B3395668-RO	SNMPv2-SMI::enterprises.311.1.1.3.1.2 Authentication Failure Trap (0) Uptime: 1 day, 1:05:13.53]]></testEvent>
  </testEvents>

  <parsingInstructions>
    <collectFieldsByRegex src="$_rawmsg">
      <regex><![CDATA[<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>\s+<_time:gPatTime>\s+<_reptIp:gPatIpAddr><:gPatStrComma>,\s+<:gPatStrComma>,\s+<_body:gPatMesgBody>]]></regex>
    </collectFieldsByRegex>
    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>
    <when test="$_reptIp != '127.0.0.1'">
      <when test="$_reptIp != '0.0.0.0'">
        <setEventAttribute attr="reptDevIpAddr">$_reptIp</setEventAttribute>
      </when>
    </when>
    <collectFieldsByRegex src="$_body">
      <regex><![CDATA[\s+SNMPv2-SMI::enterprises\.311\.[\d.]+\s+<_eventType:gPatStrLeftParen>\s+Trap\s+\(\d+\)]]></regex>
    </collectFieldsByRegex>
    <setEventAttribute attr="_eventType1">replaceStringByRegex($_eventType, "\s+", "-")</setEventAttribute>
    <setEventAttribute attr="eventType">combineMsgId("WIN-DHCP-", $_eventType1)</setEventAttribute>
  </parsingInstructions>
</eventParser>
