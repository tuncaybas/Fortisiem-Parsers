<eventParser name="CiscoMerakiTrapParser">
  <deviceType>
    <Vendor>Cisco</Vendor>
    <Model>Meraki Cloud Controller</Model>
    <Version>ANY</Version>
  </deviceType>

  <eventFormatRecognizer><![CDATA[SNMPv2-SMI::enterprises.29671\.]]></eventFormatRecognizer>
  <testEvents>
    <testEvent><![CDATA[2012-01-18 14:49:17 0.0.0.0(via UDP: [192.168.20.247]:161) TRAP2, SNMP v2c, community public                . Cold Start Trap (0) Uptime: 0:00:00.00          DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (50430787) 5 days, 20:05:07.87     SNMPv2-MIB::snmpTrapOID.0 = OID: SNMPv2-SMI::enterprises.29671.1.1.2.1	SNMPv2-SMI::enterprises.29671.1.1.3.1.3 = STRING: "ssid"	SNMPv2-SMI::enterprises.29671.1.1.3.1.4 = STRING: "user"	SNMPv2-SMI::enterprises.29671.1.1.4.1.1 = STRING: "12:34:56:78:9A:BC"	SNMPv2-SMI::enterprises.29671.1.1.4.1.13 = STRING: "255.255.255.0"	SNMPv2-SMI::enterprises.29671.1.1.5.1.3 = STRING: "interface"]]></testEvent>
  </testEvents>
  <parsingInstructions>
    <collectFieldsByRegex src="$_rawmsg">
      <regex><![CDATA[<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>\s+<_time:gPatTime>\s+<_body:gPatMesgBody>]]></regex>
    </collectFieldsByRegex>

    <setEventAttribute attr="extEventRecvProto">Snmp Trap</setEventAttribute>

    <collectAndSetAttrByKeyValuePair sep="\t\\| SNMP" src="$_body">
      <attrKeyMap attr="_id" key="SNMPv2-MIB::snmpTrapOID.0 = OID: "/>
      <attrKeyMap attr="hostName" key="SNMPv2-SMI::enterprises.29671.1.1.2.1.2 = STRING: "/>
      <attrKeyMap attr="remoteVpnIpAddr" key="SNMPv2-SMI::enterprises.29671.1.1.2.1.4 = STRING: "/>
      <attrKeyMap attr="wlanSsid" key="SNMPv2-SMI::enterprises.29671.1.1.3.1.3 = STRING: "/>
      <attrKeyMap attr="user" key="SNMPv2-SMI::enterprises.29671.1.1.3.1.4 = STRING: "/>
      <attrKeyMap attr="senderMailAddr" key="SNMPv2-SMI::enterprises.29671.1.1.3.1.5 = STRING: "/>
      <attrKeyMap attr="authServerIpAddr" key="SNMPv2-SMI::enterprises.29671.1.1.3.1.6 = STRING: "/>
      <attrKeyMap attr="hostMACAddr" key="SNMPv2-SMI::enterprises.29671.1.1.4.1.1 = STRING: "/>
      <attrKeyMap attr="systemStatus" key="SNMPv2-SMI::enterprises.29671.1.1.4.1.3 = STRING: "/>
      <attrKeyMap attr="hostIpAddr" key="SNMPv2-SMI::enterprises.29671.1.1.4.1.12 = STRING: "/>
      <attrKeyMap attr="dhcpSubnetAddr" key="SNMPv2-SMI::enterprises.29671.1.1.4.1.13 = STRING: "/>
      <attrKeyMap attr="intfName" key="SNMPv2-SMI::enterprises.29671.1.1.5.1.3 = STRING: "/>
      <attrKeyMap attr="intfAlias" key="SNMPv2-SMI::enterprises.29671.1.1.5.1.10 = STRING: "/>
      <attrKeyMap attr="hostVLAN" key="SNMPv2-SMI::enterprises.29671.1.1.6.1.2 = STRING: "/>
      <attrKeyMap attr="_devStatus" key="SNMPv2-SMI::enterprises.29671.1.1.4.1.3 = INTEGER: "/>
    </collectAndSetAttrByKeyValuePair>

    <choose>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.2.1'">
        <setEventAttribute attr="eventType">Cisco-Meraki-networkEntry</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.3.1'">
        <setEventAttribute attr="eventType">Cisco-Meraki-ssidEntry</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.4.1'">
        <setEventAttribute attr="eventType">Cisco-Meraki-devEntry</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.5.1'">
        <setEventAttribute attr="eventType">Cisco-Meraki-devInterfaceEntry</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.6.1'">
        <setEventAttribute attr="eventType">Cisco-Meraki-vlanEntry</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.1'">
        <setEventAttribute attr="eventType">Cisco-Meraki-testTrap</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.2'">
        <setEventAttribute attr="eventType">Cisco-Meraki-deviceGoesDownTrap</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.3'">
        <setEventAttribute attr="eventType">Cisco-Meraki-deviceComesOnline</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.4'">
        <setEventAttribute attr="eventType">Cisco-Meraki-foreignAPDetected</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.5'">
        <setEventAttribute attr="eventType">Cisco-Meraki-cellularNetworkUp</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.6'">
        <setEventAttribute attr="eventType">Cisco-Meraki-cellularNetworkDown</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.7'">
        <setEventAttribute attr="eventType">Cisco-Meraki-newDhcpServerAlert</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.8'">
        <setEventAttribute attr="eventType">Cisco-Meraki-noDhcpLeases</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.9'">
        <setEventAttribute attr="eventType">Cisco-Meraki-uplinkStatusChanged</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.10'">
        <setEventAttribute attr="eventType">Cisco-Meraki-unreachableDevicesDetected</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.11'">
        <setEventAttribute attr="eventType">Cisco-Meraki-upcomingFirewallInformationChanges</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.12'">
        <setEventAttribute attr="eventType">Cisco-Meraki-gatewayToRepeater</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.13'">
        <setEventAttribute attr="eventType">Cisco-Meraki-ipConflict</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.14'">
        <setEventAttribute attr="eventType">Cisco-Meraki-newSplashSignup</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.15'">
        <setEventAttribute attr="eventType">Cisco-Meraki-portCableError</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.16'">
        <setEventAttribute attr="eventType">Cisco-Meraki-portConnected</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.17'">
        <setEventAttribute attr="eventType">Cisco-Meraki-portDisconnected</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.18'">
        <setEventAttribute attr="eventType">Cisco-Meraki-portSpeedChange</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.19'">
        <setEventAttribute attr="eventType">Cisco-Meraki-rogueDhcpServer</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.20'">
        <setEventAttribute attr="eventType">Cisco-Meraki-settingsChanged</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.21'">
        <setEventAttribute attr="eventType">Cisco-Meraki-unreachableRadiusServer</setEventAttribute>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.22'">
        <choose>
          <when test="not_exist _devStatus">
            <setEventAttribute attr="eventType">Cisco-Meraki-vpnConnectivityChange</setEventAttribute>
          </when>
          <when test="$_devStatus = '0'">
            <setEventAttribute attr="eventType">Cisco-Meraki-vpnConnectivityChange-down</setEventAttribute>
          </when>
          <when test="$_devStatus = '1'">
            <setEventAttribute attr="eventType">Cisco-Meraki-vpnConnectivityChange-up</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">Cisco-Meraki-vpnConnectivityChange</setEventAttribute>
          </otherwise>
        </choose>
      </when>
      <when test="$_id = 'SNMPv2-SMI::enterprises.29671.1.1.7.23'">
        <setEventAttribute attr="eventType">Cisco-Meraki-vpnFailoverDetected</setEventAttribute>
      </when>
      <otherwise>
        <setEventAttribute attr="eventType">Cisco-Meraki-Generic</setEventAttribute>
      </otherwise>
    </choose>
  </parsingInstructions>
</eventParser>
