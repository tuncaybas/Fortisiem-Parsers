<eventParser name="CiscoWLC3Parser">
  <deviceType>
    <Vendor>Cisco</Vendor>
    <Model>WLAN Controller</Model>
    <Version>ANY</Version>
  </deviceType>

  <eventFormatRecognizer><![CDATA[SNMPv2-MIB::snmpTrapOID.0 = OID: SNMPv2-SMI::enterprises.9.9.615]]></eventFormatRecognizer>

  <testEvents>
    <testEvent><![CDATA[2011-04-05 10:37:42 0.0.0.0(via UDP: [10.10.81.240]:32768) TRAP2, SNMP v2c, community ABC	. Cold Start Trap (0) Uptime: 0:00:00.00 DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (1672429600) 193 days, 13:38:16.00	SNMPv2-MIB::snmpTrapOID.0 = OID: SNMPv2-SMI::enterprises.9.9.615.0.1 SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.1.0 = Hex-STRING: 00 25 BC 80 E8 77 	SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.8.0 = Hex-STRING: 6C 50 4D 7D AC 50 	SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.9.0 = INTEGER: 1 SNMPv2-SMI::enterprises.9.9.513.1.1.1.1.5.0 = STRING: "AP03-3.rdu2" SNMPv2-SMI::enterprises.9.9.615.1.2.1.0 = INTEGER: 1 SNMPv2-SMI::enterprises.9.9.615.1.2.2.0 = INTEGER: 5000 SNMPv2-SMI::enterprises.9.9.615.1.2.3.0 = INTEGER: 1 SNMPv2-SMI::enterprises.9.9.615.1.2.4.0 = INTEGER: 31 SNMPv2-SMI::enterprises.9.9.615.1.2.5.0 = INTEGER: -60 SNMPv2-SMI::enterprises.9.9.615.1.2.6.0 = INTEGER: -90 SNMPv2-SMI::enterprises.9.9.615.1.2.7.0 = STRING: "0,0,0,0,1,20,24,28,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0" SNMPv2-SMI::enterprises.9.9.615.1.2.8.0 = INTEGER: 2 SNMPv2-SMI::enterprises.9.9.615.1.2.9.0 = STRING: "6c:50:4d:7d:ac:50,e8:04:62:0b:b5:f0" SNMPv2-SMI::enterprises.9.9.615.1.2.10.0 = STRING: "-83,-85" SNMPv2-SMI::enterprises.9.9.615.1.2.11.0 = STRING: "1,1" SNMPv2-SMI::enterprises.9.9.512.1.1.1.1.11.5 = INTEGER: 1]]></testEvent>
  </testEvents>

  <parsingInstructions>
    <!-- sample
2011-04-05 10:37:42 0.0.0.0(via UDP: [10.10.81.240]:32768) TRAP2, SNMP
v2c, community ABC	. Cold Start Trap (0) Uptime: 0:00:00.00
DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (1672429600) 193
days, 13:38:16.00	SNMPv2-MIB::snmpTrapOID.0 = OID:
SNMPv2-SMI::enterprises.9.9.615.0.1
SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.1.0 = Hex-STRING: 00 25 BC 80
E8 77 	SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.8.0 = Hex-STRING: 6C 50
4D 7D AC 50 	SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.9.0 = INTEGER: 1
SNMPv2-SMI::enterprises.9.9.513.1.1.1.1.5.0 = STRING: "AP03-3.rdu2"
SNMPv2-SMI::enterprises.9.9.615.1.2.1.0 = INTEGER: 1 SNMPv2-SMI::enterprises.9.9.615.1.2.2.0 = INTEGER: 5000 SNMPv2-SMI::enterprises.9.9.615.1.2.3.0 = INTEGER: 1 SNMPv2-SMI::enterprises.9.9.615.1.2.4.0 = INTEGER: 31 SNMPv2-SMI::enterprises.9.9.615.1.2.5.0 = INTEGER: -60 SNMPv2-SMI::enterprises.9.9.615.1.2.6.0 = INTEGER: -90 SNMPv2-SMI::enterprises.9.9.615.1.2.7.0 = STRING:
"0,0,0,0,1,20,24,28,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0"
SNMPv2-SMI::enterprises.9.9.615.1.2.8.0 = INTEGER: 2 SNMPv2-SMI::enterprises.9.9.615.1.2.9.0 = STRING:
"6c:50:4d:7d:ac:50,e8:04:62:0b:b5:f0"
SNMPv2-SMI::enterprises.9.9.615.1.2.10.0 = STRING: "-83,-85"
SNMPv2-SMI::enterprises.9.9.615.1.2.11.0 = STRING: "1,1"
SNMPv2-SMI::enterprises.9.9.512.1.1.1.1.11.5 = INTEGER: 1
-->

    <switch>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>\s+<_time:gPatTime>\s+<:gPatIpAddr><_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>\s+<_time:gPatTime>\s+<hostName:gPatStr> <:gPatStr> <_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
    </switch>

    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>
    <setEventAttribute attr="eventType">Cisco-WLC3-Generic</setEventAttribute>
    <setEventAttribute attr="eventSeverity">1</setEventAttribute>
    <setEventAttribute attr="extEventRecvProto">Snmp Trap</setEventAttribute>

    <collectAndSetAttrByKeyValuePair sep="\t" src="$_body">
      <attrKeyMap attr="_eventType" key="SNMPv2-MIB::snmpTrapOID.0 = OID: SNMPv2-SMI::enterprises.9.9.615.0."/>
      <attrKeyMap attr="_hostMACAddr" key="SNMPv2-SMI::enterprises.9.9.615.1.2.12.0 = Hex-STRING: "/>
      <attrKeyMap attr="hostIpAddr" key="SNMPv2-SMI::enterprises.9.9.615.1.2.13.0 = IpAddress: "/>
    </collectAndSetAttrByKeyValuePair>


    <choose>
      <when test="$_eventType = '1'">
        <setEventAttribute attr="eventType">Cisco-WLC-1-clientCoverageHolePreAlarm</setEventAttribute>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        <collectAndSetAttrByKeyValuePair sep="\t" src="$_body">
          <attrKeyMap attr="_hostMACAddr" key="SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.1.0 = Hex-STRING: "/>
          <attrKeyMap attr="_nepMACAddr" key="SNMPv2-SMI::enterprises.9.9.599.1.3.1.1.8.0 = Hex-STRING: "/>
          <attrKeyMap attr="nepDevName" key="SNMPv2-SMI::enterprises.9.9.513.1.1.1.1.5.0 = STRING: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>
    </choose>

    <choose>
      <when test="$_eventType = '2'">
        <setEventAttribute attr="eventType">Cisco-WLC-2-rrmRfGroupLeaderChanged</setEventAttribute>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>
    </choose>

    <choose>
      <when test="$_eventType = '3'">
        <setEventAttribute attr="eventType">Cisco-WLC-3-rrmRfGroupMemberAdded</setEventAttribute>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>
    </choose>
    <choose>
      <when test="$_eventType = '4'">
        <setEventAttribute attr="eventType">Cisco-WLC-4-rrnRfGroupMemberRemoved</setEventAttribute>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>
    </choose>

    <when test="exist _nepMACAddr">
      <setEventAttribute attr="nepMACAddr">normalizeMAC($_nepMACAddr)</setEventAttribute>
    </when>

    <when test="exist _hostMACAddr">
      <setEventAttribute attr="hostMACAddr">normalizeMAC($_hostMACAddr)</setEventAttribute>
    </when>

  </parsingInstructions>

</eventParser>
