<eventParser name="UCMCDR">

  <deviceType>
    <Vendor>Cisco</Vendor>
    <Model>Call Manager</Model>
    <Version>ANY</Version>
  </deviceType>

  <testEvents>
    <testEvent><![CDATA[<134> May 11 10:15:25 2012 127.0.0.1 AccelOps-FileLog-UCMCDR [cdrRecordType]="1" [globalCallID_callManagerId]="2" [globalCallID_callId]="109358" [origLegCallIdentifier]="39101096" [dateTimeOrigination]="1267900802" [origNodeId]="2" [origSpan]="0" [origIpAddr]="1083779082" [callingPartyNumber]="3600" [callingPartyUnicodeLoginUserID]="emaitia" [origCause_location]="0" [origCause_value]="0" [origPrecedenceLevel]="4" [origMediaTransportAddress_IP]="1083779082" [origMediaTransportAddress_Port]="26932" [origMediaCap_payloadCapability]="4" [origMediaCap_maxFramesPerPacket]="20" [origMediaCap_g723BitRate]="0" [origVideoCap_Codec]="0" [origVideoCap_Bandwidth]="0" [origVideoCap_Resolution]="0" [origVideoTransportAddress_IP]="0" [origVideoTransportAddress_Port]="0" [origRSVPAudioStat]="0" [origRSVPVideoStat]="0" [destLegIdentifier]="39101097" [destNodeId]="1" [destSpan]="0" [destIpAddr]="77146122" [originalCalledPartyNumber]="7137" [finalCalledPartyNumber]="7137" [finalCalledPartyUnicodeLoginUserID]="" [destCause_location]="0" [destCause_value]="16" [destPrecedenceLevel]="4" [destMediaTransportAddress_IP]="77146122" [destMediaTransportAddress_Port]="29394" [destMediaCap_payloadCapability]="4" [destMediaCap_maxFramesPerPacket]="20" [destMediaCap_g723BitRate]="0" [destVideoCap_Codec]="0" [destVideoCap_Bandwidth]="0" [destVideoCap_Resolution]="0" [destVideoTransportAddress_IP]="0" [destVideoTransportAddress_Port]="0" [destRSVPAudioStat]="0" [destRSVPVideoStat]="0" [dateTimeConnect]="1267900815" [dateTimeDisconnect]="1267900828" [lastRedirectDn]="7137" [pkid]="11111111-1111-1111-1111-111111111111" [originalCalledPartyNumberPartition]="899_PT_Phones" [callingPartyNumberPartition]="899_PT_Phones" [finalCalledPartyNumberPartition]="899_PT_Phones" [lastRedirectDnPartition]="899_PT_Phones" [duration]="13" [origDeviceName]="SEP0021A086E5B8" [destDeviceName]="SEP0024142F7B5E" [origCallTerminationOnBehalfOf]="0" [destCallTerminationOnBehalfOf]="12" [origCalledPartyRedirectOnBehalfOf]="0" [lastRedirectRedirectOnBehalfOf]="0" [origCalledPartyRedirectReason]="0" [lastRedirectRedirectReason]="0" [destConversationId]="0" [globalCallId_ClusterID]="StandAloneCluster" [joinOnBehalfOf]="0" [comment]="" [authCodeDescription]="" [authorizationLevel]="0" [clientMatterCode]="" [origDTMFMethod]="3" [destDTMFMethod]="3" [callSecuredStatus]="0" [origConversationId]="0" [origMediaCap_Bandwidth]="64" [destMediaCap_Bandwidth]="64" [authorizationCodeValue]="" [outpulsedCallingPartyNumber]="" [outpulsedCalledPartyNumber]="" [origIpv4v6Addr]="10.40.153.64" [destIpv4v6Addr]="10.40.153.4"]]></testEvent>
  </testEvents>

  <eventFormatRecognizer><![CDATA[AccelOps-FileLog-UCMCDR]]></eventFormatRecognizer>

  <patternDefinitions>
    <pattern name="patMonabbrDay"><![CDATA[(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)(?:\s*)\d{1,2}]]></pattern>
  </patternDefinitions>

  <parsingInstructions>
    <collectFieldsByRegex src="$_rawmsg">
      <regex><![CDATA[<:gPatStr>\s+<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<_year:gPatYear>\s+<:gPatIpAddr>\s+AccelOps\-FileLog\-UCMCDR\s+<_body:gPatMesgBody>]]></regex>
    </collectFieldsByRegex>

    <setEventAttribute attr="eventType">Cisco-CM-CDR</setEventAttribute>
    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>

    <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
      <attrKeyMap attr="_srcIpAddr" key="[origIpv4v6Addr]="/>
      <attrKeyMap attr="_destIpAddr" key="[destIpv4v6Addr]="/>
      <attrKeyMap attr="_srcIpAddr2" key="[origIpAddr]="/>
      <attrKeyMap attr="_destIpAddr2" key="[destIpAddr]="/>
      <attrKeyMap attr="srcName" key="[origDeviceName]="/>
      <attrKeyMap attr="destName" key="[destDeviceName]="/>
      <attrKeyMap attr="callingPartyNumber" key="[callingPartyNumber]="/>
      <attrKeyMap attr="originalCalledPartyNumber" key="[originalCalledPartyNumber]="/>
      <attrKeyMap attr="finalCalledPartyNumber" key="[finalCalledPartyNumber]="/>
      <attrKeyMap attr="dateTimeConnect" key="[dateTimeConnect]="/>
      <attrKeyMap attr="dateTimeDisconnect" key="[dateTimeDisconnect]="/>
      <attrKeyMap attr="callDuration" key="[duration]="/>
      <attrKeyMap attr="ipConnId" key="[globalCallID_callId]="/>
      <attrKeyMap attr="callingPartyLoginUserID" key="[callingPartyUnicodeLoginUserID]="/>
      <attrKeyMap attr="latency" key="[latency]="/>
      <attrKeyMap attr="recvBytes64" key="[numberOctetsReceived]="/>
      <attrKeyMap attr="sentBytes64" key="[numberOctetsSent]="/>
      <attrKeyMap attr="pktLost" key="[numberPacketsLost]="/>
      <attrKeyMap attr="recvPkts64" key="[numberPacketsReceived]="/>
      <attrKeyMap attr="sentPkts64" key="[numberPacketsSent]="/>
      <attrKeyMap attr="waitTimeMs" key="[totalWaitTimeInQueue]="/>
      <attrKeyMap attr="callQueued" key="[wasCallQueued]="/>
      <attrKeyMap attr="_varVQMetrics" key="[varVQMetrics]="/>
      <attrKeyMap attr="avgJitterMs" key="[jitter]="/>
      <attrKeyMap attr="deviceTime" key="[dateTimeOrigination]="/>
      <attrKeyMap attr="destPrecedenceLevel" key="[destPrecedenceLevel]="/>
      <attrKeyMap attr="finalCalledPartyNumberPartition" key="[finalCalledPartyNumberPartition]="/>
      <attrKeyMap attr="finalCalledPartyPattern" key="[finalCalledPartyPattern]="/>
      <attrKeyMap attr="finalCalledPartyUnicodeLoginUserID" key="[finalCalledPartyUnicodeLoginUserID]="/>
      <attrKeyMap attr="huntPilotDN" key="[huntPilotDN]="/>
      <attrKeyMap attr="huntPilotPattern" key="[huntPilotPattern]="/>
      <attrKeyMap attr="joinOnBehalfOf" key="[joinOnBehalfOf]="/>
      <attrKeyMap attr="lastRedirectDn" key="[lastRedirectDn]="/>
      <attrKeyMap attr="lastRedirectDnPartition" key="[lastRedirectDnPartition]="/>
      <attrKeyMap attr="lastRedirectingPartyPattern" key="[lastRedirectingPartyPattern]="/>
      <attrKeyMap attr="lastRedirectingRoutingReason" key="[lastRedirectingRoutingReason]="/>
      <attrKeyMap attr="lastRedirectRedirectOnBehalfOf" key="[lastRedirectRedirectOnBehalfOf]="/>
      <attrKeyMap attr="lastRedirectRedirectReason" key="[lastRedirectRedirectReason]="/>
      <attrKeyMap attr="mobileCallType" key="[mobileCallType]="/>
      <attrKeyMap attr="origCalledPartyRedirectOnBehalfOf" key="[origCalledPartyRedirectOnBehalfOf]="/>
      <attrKeyMap attr="origCalledPartyRedirectReason" key="[origCalledPartyRedirectReason]="/>
      <attrKeyMap attr="origCallTerminationOnBehalfOf" key="[origCallTerminationOnBehalfOf]="/>
      <attrKeyMap attr="originalCalledPartyNumberPartition" key="[originalCalledPartyNumberPartition]="/>
      <attrKeyMap attr="originalCalledPartyPattern" key="[originalCalledPartyPattern]="/>
      <attrKeyMap attr="origMediaCap_Bandwidth" key="[origMediaCap_Bandwidth]="/>
    </collectAndSetAttrByKeyValuePair>

    <when test="exist _varVQMetrics">
      <collectAndSetAttrByKeyValuePair sep=";" src="$_varVQMetrics">
        <attrKeyMap attr="mosScore" key="MLQK="/>
        <attrKeyMap attr="avgMosScore" key="MLQKav="/>
        <attrKeyMap attr="minMosScore" key="MLQKmn="/>
        <attrKeyMap attr="maxMosScore" key="MLQKmx="/>
      </collectAndSetAttrByKeyValuePair>
    </when>

    <setEventAttribute attr="srcIpAddr">convertIpDecimalToStr($_srcIpAddr, $_srcIpAddr2)</setEventAttribute>
    <setEventAttribute attr="destIpAddr">convertIpDecimalToStr($_destIpAddr, $_destIpAddr2)</setEventAttribute>
  </parsingInstructions>
</eventParser>
