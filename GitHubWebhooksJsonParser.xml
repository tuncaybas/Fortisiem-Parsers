<eventParser name="GitHubWebhooksJsonParser">
  <deviceType>
    <Vendor>Generic</Vendor>
    <Model>Generic</Model>
    <Version>ANY</Version>
  </deviceType>
  <appType>
    <Vendor>GitHub.com</Vendor>
    <Model>GitHub</Model>
    <Version>ANY</Version>
    <Name>GitHub Webserver</Name>
  </appType>
  <testEvents>
    <testEvent><![CDATA[[PH_DEV_MON_CUSTOM_JSON]:[reptVendor]=GitHub.com,[reptModel]=GitHub,[reptDevName]=GitHub.com,[reptDevIpAddr]=1.1.1.1,[keyword]=push,[json]={"ref":"refs/heads/main","before":"dbfa142e611116237eb7ec45255c79d53e53929e","after":"ee67c6b544707af0d94f4f901c1cf2d748729fb8","repository":{"id":768823079,"node_id":"R_kgDOLdNPJw","name":"DH_TESTER","full_name":"Org1/DH_TESTER","private":true,"owner":{"name":"Org1","email":null,"login":"Org1","id":23552948,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIzNTUyOTQ4","avatar_url":"https://avatars.githubusercontent.com/u/23552948?v=4","gravatar_id":"","url":"https://api.github.com/users/Org1","html_url":"https://github.com/Org1","followers_url":"https://api.github.com/users/Org1/followers","following_url":"https://api.github.com/users/Org1/following{/other_user}","gists_url":"https://api.github.com/users/Org1/gists{/gist_id}","starred_url":"https://api.github.com/users/Org1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Org1/subscriptions","organizations_url":"https://api.github.com/users/Org1/orgs","repos_url":"https://api.github.com/users/Org1/repos","events_url":"https://api.github.com/users/Org1/events{/privacy}","received_events_url":"https://api.github.com/users/Org1/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/Org1/DH_TESTER","description":"DH_TEsTER","fork":false,"url":"https://github.com/Org1/DH_TESTER","forks_url":"https://api.github.com/repos/Org1/DH_TESTER/forks","keys_url":"https://api.github.com/repos/Org1/DH_TESTER/keys{/key_id}","collaborators_url":"https://api.github.com/repos/Org1/DH_TESTER/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/Org1/DH_TESTER/teams","hooks_url":"https://api.github.com/repos/Org1/DH_TESTER/hooks","issue_events_url":"https://api.github.com/repos/Org1/DH_TESTER/issues/events{/number}","events_url":"https://api.github.com/repos/Org1/DH_TESTER/events","assignees_url":"https://api.github.com/repos/Org1/DH_TESTER/assignees{/user}","branches_url":"https://api.github.com/repos/Org1/DH_TESTER/branches{/branch}","tags_url":"https://api.github.com/repos/Org1/DH_TESTER/tags","blobs_url":"https://api.github.com/repos/Org1/DH_TESTER/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/Org1/DH_TESTER/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/Org1/DH_TESTER/git/refs{/sha}","trees_url":"https://api.github.com/repos/Org1/DH_TESTER/git/trees{/sha}","statuses_url":"https://api.github.com/repos/Org1/DH_TESTER/statuses/{sha}","languages_url":"https://api.github.com/repos/Org1/DH_TESTER/languages","stargazers_url":"https://api.github.com/repos/Org1/DH_TESTER/stargazers","contributors_url":"https://api.github.com/repos/Org1/DH_TESTER/contributors","subscribers_url":"https://api.github.com/repos/Org1/DH_TESTER/subscribers","subscription_url":"https://api.github.com/repos/Org1/DH_TESTER/subscription","commits_url":"https://api.github.com/repos/Org1/DH_TESTER/commits{/sha}","git_commits_url":"https://api.github.com/repos/Org1/DH_TESTER/git/commits{/sha}","comments_url":"https://api.github.com/repos/Org1/DH_TESTER/comments{/number}","issue_comment_url":"https://api.github.com/repos/Org1/DH_TESTER/issues/comments{/number}","contents_url":"https://api.github.com/repos/Org1/DH_TESTER/contents/{+path}","compare_url":"https://api.github.com/repos/Org1/DH_TESTER/compare/{base}...{head}","merges_url":"https://api.github.com/repos/Org1/DH_TESTER/merges","archive_url":"https://api.github.com/repos/Org1/DH_TESTER/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/Org1/DH_TESTER/downloads","issues_url":"https://api.github.com/repos/Org1/DH_TESTER/issues{/number}","pulls_url":"https://api.github.com/repos/Org1/DH_TESTER/pulls{/number}","milestones_url":"https://api.github.com/repos/Org1/DH_TESTER/milestones{/number}","notifications_url":"https://api.github.com/repos/Org1/DH_TESTER/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/Org1/DH_TESTER/labels{/name}","releases_url":"https://api.github.com/repos/Org1/DH_TESTER/releases{/id}","deployments_url":"https://api.github.com/repos/Org1/DH_TESTER/deployments","created_at":1709841354,"updated_at":"2024-03-08T17:54:58Z","pushed_at":1709946519,"git_url":"git://github.com/Org1/DH_TESTER.git","ssh_url":"git@github.com:Org1/DH_TESTER.git","clone_url":"https://github.com/Org1/DH_TESTER.git","svn_url":"https://github.com/Org1/DH_TESTER","homepage":null,"size":18,"stargazers_count":0,"watchers_count":0,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1,"license":null,"allow_forking":false,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"private","forks":0,"open_issues":1,"watchers":0,"default_branch":"main","stargazers":0,"master_branch":"main","organization":"Org1","custom_properties":{}},"pusher":{"name":"ExampleUser1","email":"User1@fortinet.com"},"organization":{"login":"Org1","id":23552948,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIzNTUyOTQ4","url":"https://api.github.com/orgs/Org1","repos_url":"https://api.github.com/orgs/Org1/repos","events_url":"https://api.github.com/orgs/Org1/events","hooks_url":"https://api.github.com/orgs/Org1/hooks","issues_url":"https://api.github.com/orgs/Org1/issues","members_url":"https://api.github.com/orgs/Org1/members{/member}","public_members_url":"https://api.github.com/orgs/Org1/public_members{/member}","avatar_url":"https://avatars.githubusercontent.com/u/23552948?v=4","description":null},"enterprise":{"id":132685,"slug":"dh-mei-enterprise","name":"dh-mei-enterprise","node_id":"E_kgDOAAIGTQ","avatar_url":"https://avatars.githubusercontent.com/b/132685?v=4","description":null,"website_url":null,"html_url":"https://github.com/enterprises/dh-mei-enterprise","created_at":"2024-03-07T20:52:55Z","updated_at":"2024-03-07T20:52:57Z"},"sender":{"login":"ExampleUser1","id":23548610,"node_id":"MDQ6VXNlcjIzNTQ4NjEw","avatar_url":"https://avatars.githubusercontent.com/u/23548610?v=4","gravatar_id":"","url":"https://api.github.com/users/ExampleUser1","html_url":"https://github.com/ExampleUser1","followers_url":"https://api.github.com/users/ExampleUser1/followers","following_url":"https://api.github.com/users/ExampleUser1/following{/other_user}","gists_url":"https://api.github.com/users/ExampleUser1/gists{/gist_id}","starred_url":"https://api.github.com/users/ExampleUser1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ExampleUser1/subscriptions","organizations_url":"https://api.github.com/users/ExampleUser1/orgs","repos_url":"https://api.github.com/users/ExampleUser1/repos","events_url":"https://api.github.com/users/ExampleUser1/events{/privacy}","received_events_url":"https://api.github.com/users/ExampleUser1/received_events","type":"User","site_admin":false},"created":false,"deleted":false,"forced":false,"base_ref":null,"compare":"https://github.com/Org1/DH_TESTER/compare/dbfa142e6111...ee67c6b54470","commits":[{"id":"ee67c6b544707af0d94f4f901c1cf2d748729fb8","tree_id":"631ce064279a989204114fedab7c40678285e596","distinct":true,"message":"Update new_file_1","timestamp":"2024-03-08T17:08:39-08:00","url":"https://github.com/Org1/DH_TESTER/commit/ee67c6b544707af0d94f4f901c1cf2d748729fb8","author":{"name":"ExampleUser1","email":"User1@fortinet.com","username":"ExampleUser1"},"committer":{"name":"GitHub","email":"noreply@github.com","username":"web-flow"},"added":[],"removed":[],"modified":["new_file_1"]}],"head_commit":{"id":"ee67c6b544707af0d94f4f901c1cf2d748729fb8","tree_id":"631ce064279a989204114fedab7c40678285e596","distinct":true,"message":"Update new_file_1","timestamp":"2024-03-08T17:08:39-08:00","url":"https://github.com/Org1/DH_TESTER/commit/ee67c6b544707af0d94f4f901c1cf2d748729fb8","author":{"name":"ExampleUser1","email":"User1@fortinet.com","username":"ExampleUser1"},"committer":{"name":"GitHub","email":"noreply@github.com","username":"web-flow"},"added":[],"removed":[],"modified":["new_file_1"]}}]]></testEvent>
  </testEvents>
  <eventFormatRecognizer><![CDATA[\[PH_DEV_MON_CUSTOM_JSON]\:\[reptVendor\]=GitHub.com,\[reptModel\]=GitHub,]]></eventFormatRecognizer>
  <parsingInstructions>
    <setEventAttribute attr="extEventRecvProto">WEBHOOK</setEventAttribute>
    <collectFieldsByKeyValuePair kvsep="]=" sep=",[" src="$_rawmsg">
      <attrKeyMap attr="reptDevName" key="reptDevName"/>
      <attrKeyMap attr="reptDevIpAddr" key="reptDevIpAddr"/>
      <attrKeyMap attr="_keyword" key="keyword"/>
      <attrKeyMap attr="_json" key="json"/>
    </collectFieldsByKeyValuePair>
    <when test="exist _json">
      <collectAndSetAttrByJSON src="$_json">
        <attrKeyMap attr="actionName" key="action"/>
        <attrKeyMap attr="targetType" key="ref_type"/>
        <attrKeyMap attr="status" key="status"/>
        <attrKeyMap attr="repoName" key="repository.full_name"/>
        <attrKeyMap attr="repoURL" key="repository.url"/>
        <attrKeyMap attr="repoOwner" key="repository.owner.name"/>
        <attrKeyMap attr="description" key="repository.description"/>
        <attrKeyMap attr="_actionTime" key="repository.updated_at"/>
        <attrKeyMap attr="_actionTime" key="repository.pushed_at"/>
        <attrKeyMap attr="reptGeoOrg" key="organization.login"/>
        <attrKeyMap attr="enterpriseName" key="enterprise.name"/>
        <attrKeyMap attr="user" key="sender.login"/>
        <attrKeyMap attr="type" key="sender.type"/>
        <attrKeyMap attr="uuid" key="head_commit.id"/>
        <attrKeyMap attr="comment" key="head_commit.message"/>
        <attrKeyMap attr="_actionTime" key="head_commit.timestamp"/>
        <attrKeyMap attr="modifiedItem" key="head_commit.modified"/>
        <attrKeyMap attr="addedItem" key="head_commit.added"/>
        <attrKeyMap attr="deletedItem" key="head_commit.removed"/>
        <attrKeyMap attr="ruleName" key="rule.name"/>
        <attrKeyMap attr="infoURL" key="rule.url"/>
        <attrKeyMap attr="details" key="check_run.text"/>
        <attrKeyMap attr="title" key="check_run.title"/>
        <attrKeyMap attr="status" key="check_run.status"/>
        <attrKeyMap attr="infoURL" key="check_run.url"/>
        <attrKeyMap attr="status" key="alert.state"/>
        <attrKeyMap attr="details" key="alert.rule.description"/>
        <attrKeyMap attr="scanEngine" key="alert.tool.name"/>
        <attrKeyMap attr="engineVersion" key="alert.tool.version"/>
        <attrKeyMap attr="infoURL" key="alert.url"/>
        <attrKeyMap attr="comment" key="comment.body"/>
        <attrKeyMap attr="uuid" key="comment.id"/>
        <attrKeyMap attr="infoURL" key="comment.url"/>
        <attrKeyMap attr="title" key="key.title"/>
        <attrKeyMap attr="infoURL" key="key.url"/>
        <attrKeyMap attr="infoURL" key="deployment.url"/>
        <attrKeyMap attr="infoURL" key="discussion.url"/>
        <attrKeyMap attr="status" key="discussion.state"/>
        <attrKeyMap attr="repoName" key="forkee.full_name"/>
        <attrKeyMap attr="issueBody" key="issue.body"/>
        <attrKeyMap attr="infoURL" key="issue.url"/>
        <attrKeyMap attr="status" key="issue.state"/>
        <attrKeyMap attr="label" key="label.name"/>
        <attrKeyMap attr="infoURL" key="label.url"/>
        <attrKeyMap attr="details" key="label.description"/>
        <attrKeyMap attr="memberID" key="member.id"/>
        <attrKeyMap attr="memberName" key="member.name"/>
        <attrKeyMap attr="infoURL" key="member.url"/>
        <attrKeyMap attr="groupName" key="team.name"/>
        <attrKeyMap attr="infoURL" key="team.url"/>
        <attrKeyMap attr="scope" key="scope"/>
        <attrKeyMap attr="hookName" key="hook.name"/>
      </collectAndSetAttrByJSON>
    </when>
    <when test="exist _actionTime">
      <switch>
        <case>
          <!--2024-03-11T16:12:08-07:00"-->
          <!--2024-03-08T17:54:58Z"-->
          <collectAndSetAttrByRegex src="$_actionTime">

            <regex><![CDATA[<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>T<_time:gPatTime><_tz:gPatTimeZone>]]></regex>
          </collectAndSetAttrByRegex>
          <setEventAttribute attr="actionTime">toDateTime($_mon, $_day, $_year, $_time, $_tz)</setEventAttribute>
        </case>
        <case>
          <collectAndSetAttrByRegex src="$_actionTime">
            <regex><![CDATA[^<_sec:gPatInt>$]]></regex>
          </collectAndSetAttrByRegex>
          <setEventAttribute attr="actionTime">$_sec</setEventAttribute>
        </case>
        <default/>
      </switch>
    </when>
    <setEventAttribute attr="eventType">combineMsgId("GitHub-", $_keyword)</setEventAttribute>
    <choose>
      <when test="exist targetType">
        <setEventAttribute attr="eventType">combineMsgId($eventType, "-", $targetType)</setEventAttribute>
      </when>
      <when test="exist actionName">
        <setEventAttribute attr="eventType">combineMsgId($eventType, "-", $actionName)</setEventAttribute>
      </when>
    </choose>
    <setEventAttribute attr="eventType">replaceStringByRegex($eventType, "[\._]", "-")</setEventAttribute>

    <setEventAttribute attr="eventSeverity">1</setEventAttribute>
  </parsingInstructions>
</eventParser>
