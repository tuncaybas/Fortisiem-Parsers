<eventParser name="IsilonParser">
  <deviceType>
    <Vendor>Isilon</Vendor>
    <Model>OneFS</Model>
    <Version>ANY</Version>
  </deviceType>

  <testEvents>
    <testEvent><![CDATA[<46>2017-06-27T01:30:07+08:00 popisilon-1 audit_protocol[4626]: S-1-5-21-1177238915-1275210071-839522115-500|1000001|System|1|192.168.1.126|SMB|CLOSE|SUCCESS|DIR|0:0|0:0|4323266743|/ifs/data/FINANCE2/DW Import/S1116/s1461]]></testEvent>
    <testEvent><![CDATA[<46>2017-06-27T01:30:07+08:00 popisilon-1 audit_protocol[4626]: S-1-5-21-1177238915-1275210071-839522115-500|1000001|System|1|192.168.1.126|SMB|OPEN|SUCCESS|1048705|DIR|OPENED|4324202051|/ifs/data/FINANCE2/DW Import/S1141]]></testEvent>
  </testEvents>

  <patternDefinitions>
    <pattern name="patVbar"><![CDATA[[^|]*]]></pattern>
  </patternDefinitions>

  <eventFormatRecognizer><![CDATA[<:gPatSyslogPRI><:gPatYear>-<:gPatMonNum>-<:gPatDay>T<:gPatTime><:gPatTimeZone>\s+<:gPatHostName>\s+audit_protocol\[\d+\]:\s]]></eventFormatRecognizer>

  <parsingInstructions>
    <setEventAttribute attr="eventType">Isilon-Generic</setEventAttribute>

    <collectFieldsByRegex src="$_rawmsg">
      <regex><![CDATA[<:gPatSyslogPRI><_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>T<_time:gPatTime><_tz:gPatTimeZone>\s+(?:<reptDevIpAddr:gPatIpAddr>|<reptDevName:gPatHostName>)\s+audit_protocol\[\d+\]:\s+<uuid:patVbar>\|<:patVbar>\|<module:patVbar>\|<:patVbar>\|<srcIpAddr:patVbar>\|<appTransportProto:patVbar>\|<fileAccess:patVbar>\|<_body:gPatMesgBody>]]></regex>
    </collectFieldsByRegex>

    <choose>
      <when test="not_exist fileAccess"/>
      <when test="$fileAccess = 'OPEN'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[^<_result:patVbar>\|<:patVbar>\|<fileType:patVbar>\|<:patVbar>\|<:patVbar>\|<fileName:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </when>
      <when test="$fileAccess = 'CLOSE'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[^<_result:patVbar>\|<fileType:patVbar>\|<:patVbar>\|<:patVbar>\|<:patVbar>\|<fileName:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </when>
    </choose>

    <setEventAttribute attr="eventType">combineMsgId("Isilon-", $fileAccess)</setEventAttribute>
    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time, $_tz)</setEventAttribute>

    <when test="exist _result">
      <setEventAttribute attr="eventType">combineMsgId($eventType, "-", $_result)</setEventAttribute>
    </when>
  </parsingInstructions>
</eventParser>
