<eventParser name="TipPointIPSParser">

  <deviceType>
    <Vendor>TrendMicro</Vendor>
    <Model>TippingPoint UnityOne IPS</Model>
    <Version>ANY</Version>
  </deviceType>

  <patternDefinitions>
    <pattern name="patTipType"><![CDATA[ALT|BLK|P2P]]></pattern>
    <pattern name="patTipHead"><![CDATA[\d{8}T\d{6}(?:\+|-)\d{4}]]></pattern>
    <pattern name="patTipAction"><![CDATA[Permit|Block]]></pattern>
    <pattern name="patTipSev"><![CDATA[Low|Minor|Major|Critical]]></pattern>
    <pattern name="patTipUuid"><![CDATA[\w{8}-\w{4}-\w{4}-\w{4}-\w{12}]]></pattern>
    <pattern name="patSep"><![CDATA[\t|,|;]]></pattern>
  </patternDefinitions>

  <eventFormatRecognizer><![CDATA[<:gPatMon>\s+<:gPatDay> <:gPatTime> <:gPatStr> <:patTipType><:patSep>v\d<:patSep>]]></eventFormatRecognizer>

  <testEvents>
    <testEvent><![CDATA[<36>Oct 28 13:10:45 3.3.3.3 ALT,v4,20091028T131045+0480,"PH-QA-TIP1"/2.2.2.2,835197,1,Permit,Minor,11111111-1111-1111-1111-111111111111,"0089: IP: Short Time To Live (1)","0089: IP: Short Time To Live (1)",ip," ",172.16.10.1:0,2.2.2.2:0,20091028T130945+0480,6," ",0,1A-1B]]></testEvent>
    <testEvent><![CDATA[<37>Nov  5 20:16:19 2.2.2.2 BLK,v4,20091105T201619+0480,"PH-QA-TIP1"/2.2.2.2,70,2,Block,Low,11111111-1111-1111-1111-111111111111,"4316: OSPF: OSPF Packet With Time-To-Live of 1","4316: OSPF: OSPF Packet With Time-To-Live of 1",ip," ",172.16.10.1:0,2.2.2.2:0,20091105T201619+0480,1," ",0,1A-1B]]></testEvent>
    <testEvent><![CDATA[<37>Jul 12 15:04:01 SOCIPS01 ALT,v5,20110712T150401-0500,SOCIPS01/192.168.10.122,3225227,1,Permit,Low,11111111-1111-1111-1111-111111111111,"10960: IM: Google GMail Chat SSL Connection Attempt","10960: IM: Google GMail Chat SSL Connection Attempt",tcp," ",4.4.4.4,10948,5.5.5.5,443,20110712T150239-0500,3," ",0,6A-6B]]></testEvent>
  </testEvents>

  <parsingInstructions>

    <setEventAttribute attr="eventType">Tipp-Generic</setEventAttribute>

    <!-- <36>Oct 16 15:48:42 172.16.20.41 ALT,v4,20091016T154842+0480,"PH-QA-TIP1"/172.16.20.41,57946,1,
          Permit,Minor,11111111-1111-1111-1111-111111111111,"1221: SNMP: 'public' Access","1221: SNMP: 'public' Access",
          snmp," ",192.168.20.103:57576,172.16.10.8:161,20091016T154742+0480,10825," ",0,1A-1B  -->
    <switch>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatSyslogPRI><_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<reptDevIpAddr:gPatIpAddr>\s+<_tiptype:patTipType><:patSep>v\d<:patSep><:patTipHead><:patSep><_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatSyslogPRI><_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<hostName:gPatStr>\s+<_tiptype:patTipType><:patSep>v\d<:patSep><:patTipHead><:patSep><_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
    </switch>

    <setEventAttribute attr="eventType">combineMsgId("Tipp", "_", "IPS", "-", $_tiptype)</setEventAttribute>

    <switch>
      <case>
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[\"<hostName:gPatStr>\"/<reptDevIpAddr:gPatIpAddr><:patSep><:gPatInt><:patSep><:gPatInt><:patSep><remedyAction:patTipAction><:patSep><_severity:patTipSev><:patSep><_uuid:patTipUuid><:patSep>\"<:gPatMesgBody>\"<:patSep>\"<ipsSignatureId:gPatInt>: <:gPatMesgBody>\"<:patSep><appTransportProto:gPatProto><:patSep>\"<:gPatMesgBody>\"<:patSep><srcIpAddr:gPatIpAddr>:<srcIpPort:gPatInt><:patSep><destIpAddr:gPatIpAddr>:<destIpPort:gPatInt><:patSep><:patTipHead><:patSep><count:gPatInt><:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
      <case>
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[<hostName:gPatStr>/<reptDevIpAddr:gPatIpAddr><:patSep><:gPatInt><:patSep><:gPatInt><:patSep><remedyAction:patTipAction><:patSep><_severity:patTipSev><:patSep><_uuid:patTipUuid><:patSep>\"<:gPatMesgBody>\"<:patSep>\"<ipsSignatureId:gPatInt>: <:gPatMesgBody>\"<:patSep><appTransportProto:gPatProto><:patSep>\"<:gPatMesgBody>\"<:patSep><srcIpAddr:gPatIpAddr><:patSep><srcIpPort:gPatInt><:patSep><destIpAddr:gPatIpAddr><:patSep><destIpPort:gPatInt><:patSep><:patTipHead><:patSep><count:gPatInt><:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
    </switch>

    <setEventAttribute attr="eventType">combineMsgId("Tipp_IPS-", $ipsSignatureId)</setEventAttribute>
    <setEventAttribute attr="ipProto">convertStrToIntIpProto($appTransportProto)</setEventAttribute>

    <when test="$_severity = 'Low'">
      <setEventAttribute attr="eventSeverity">1</setEventAttribute>
    </when>

    <when test="$_severity = 'Minor'">
      <setEventAttribute attr="eventSeverity">3</setEventAttribute>
    </when>

    <when test="$_severity = 'Major'">
      <setEventAttribute attr="eventSeverity">6</setEventAttribute>
    </when>

    <when test="$_severity = 'Critical'">
      <setEventAttribute attr="eventSeverity">9</setEventAttribute>
    </when>
  </parsingInstructions>
</eventParser>
