<eventParser name="WinOSWmiParser">
  <deviceType>
    <Vendor>Microsoft</Vendor>
    <Model>Windows</Model>
    <Version>ANY</Version>
  </deviceType>

  <!--
Fri Oct 30 18:19:58 2009 192.168.0.10 AccelOps-WinLog-WMI [Category]="2" [CategoryString]="Logon/Logoff" [ComputerName]="ADS-PRI" [Data]="Unsupported" [EventCode]="540" [EventIdentifier]="540" [EventType]="4" [InsertionStrings]="Unsupported" [Logfile]="Security" [RecordNumber]="8574571" [SourceName]="Security" [TimeGenerated]="20091029184451.000000-420" [TimeWritten]="20091029184451.000000-420" [Type]="Audit Success" [User]="ABC\user" [User Name]="user" [Domain]="ABC" [Logon ID]="(0x0,0xCDDA2A4)" [Logon Type]="3" [Logon Process]="Kerberos" [Authentication Package]="Kerberos" [Workstation Name]="" [Logon GUID]="{11111111-1111-1111-1111-111111111111}" [Caller User Name]="-" [Caller Domain]="-" [Caller Logon ID]="-" [Caller Process ID]="-" [Transited Services]="-" [Source Network Address]="192.168.22.6" [Source Port]="3546"
Fri Oct 30 18:30:01 2009 192.168.0.40 AccelOps-WinLog-WMI [Category]="0" [CategoryString]="(null)" [ComputerName]="FILER" [Data]="Unsupported" [EventCode]="1" [EventIdentifier]="1" [EventType]="3" [InsertionStrings]="Unsupported" [Logfile]="Application" [RecordNumber]="37132" [SourceName]="WinVNC4" [TimeGenerated]="20091030181640.000000-420" [TimeWritten]="20091030181640.000000-420" [Type]="Information" [User]="(null)"
Fri Oct 30 18:30:47 2009 192.168.0.40 AccelOps-WinLog-WMI [Category]="0" [CategoryString]="(null)" [ComputerName]="FILER" [Data]="Unsupported" [EventCode]="5722" [EventIdentifier]="5722" [EventType]="1" [InsertionStrings]="Unsupported" [Logfile]="System" [RecordNumber]="26966" [SourceName]="NETLOGON" [TimeGenerated]="20091030171410.000000-420" [TimeWritten]="20091030171410.000000-420" [Type]="Error" [User]="(null)" [SJDEVVWINDB06$.  The following error occurred]=""
   -->

  <testEvents>
    <testEvent><![CDATA[Fri Oct 30 18:19:58 2009 20.20.20.20 AccelOps-WinLog-WMI  [Category]="12803" [CategoryString]="SAM" [ComputerName]="jha.local" [Data]="NULL" [EventCode]="4661" [EventIdentifier]="4661" [EventType]="4" [Logfile]="Security" [RecordNumber]="184035316" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20100505222910.822003-000" [TimeWritten]="20100505222910.822003-000" [Type]="Audit Success" [User]="(null)" [[Subject ]][Security ID]="S-1-5-21-2090294290-982477196-2044928816-8287" [Account Name]="ACTIVITIES13$" [Account Domain]="JHA" [Logon ID]="0x550bb1d" [[Object]][Object Server]="Security Account Manager" [Object Type]="SAM_USER" [Object Name]="S-1-5-21-2090294290-982477196-2044928816-6428" [Handle ID]="0x9683170" [[Process Information]][Process ID]="0x240" [Process Name]="C:\Windows\System32\lsass.exe" [[Access Request Information]][Transaction ID]="{11111111-1111-1111-1111-111111111111}" [Accesses]="READ_CONTROL,WritePreferences,ReadAccount,SetTrueword (without knowledge of old Trueword),			" [Access Mask]="0x20094" [Privileges Used for Access Check]="-" [Properties]="---,{11111111-1111-1111-1111-111111111111}"]]></testEvent>
    <testEvent><![CDATA[Fri Aug 31 18:27:47 2012 10.1.8.115 AccelOps-WinLog-WMI [Category]="12544" [CategoryString]="登录" [ComputerName]="CSJW-DbServer" [Data]="NULL" [EventCode]="4625" [EventIdentifier]="4625" [EventType]="5" [Logfile]="Security" [RecordNumber]="14141488" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20120831103329.843797-000" [TimeWritten]="20120831103329.843797-000" [Type]="审核失败" [User]="(null)" [Message]="帐户登录失败。" [[主题]] [安全 ID]="S-1-0-0" [帐户名]="" [帐户域]="" [登录 ID]="0x0" [登录类型]="3" [[登录失败的帐户]] [安全 ID]="S-1-0-0" [帐户名]="Administrator" [帐户域]="HNCSSW2" [[失败信息]] [失败原因]="未知用户名或密码错误。" [状态]="0xc000006d" [子状态]="0xc000006a" [[进程信息]] [调用方进程 ID]="0x0" [调用方进程名]="" [[网络信息]] [工作站名]="HNCSSW2" [源网络地址]="10.1.8.41" [源端口]="30217" [[详细身份验证信息]] [登录进程]="NtLmSsp" [身份验证数据包]="NTLM" [传递服务]="" [数据包名(仅限 NTLM)]="" [密钥长度]="0"]]></testEvent>
    <testEvent><![CDATA[Wed May  8 16:52:58 2013 172.16.20.232 AccelOps-WinLog-WMI [Category]="12544" [CategoryString]="Inicio de sesi¾n" [ComputerName]="Win2008Spanish.Win2008AD.net" [Data]="NULL" [EventCode]="4625" [EventIdentifier]="4625" [EventType]="5" [Logfile]="Security" [RecordNumber]="206341" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20130509073221.932817-000" [TimeWritten]="20130509073221.932817-000" [Type]="Error de auditorÝa" [User]="(null)" [Message]="Error de una cuenta al iniciar sesi¾n." [[Sujeto]] [Id. de seguridad]="S-1-0-0" [Nombre de cuenta]="" [Dominio de cuenta]="" [Id. de inicio de sesi¾n]="0x0" [Tipo de inicio de sesi¾n]="3" [Cuenta con error de inicio de sesi¾n]="" [Id. de seguridad]="S-1-0-0" [Nombre de cuenta]="Administrator" [Dominio de cuenta]="ACCELOPS" [[Informaci¾n de error]] [Motivo del error]="Nombre de usuario desconocido o contrase±a incorrecta" [Estado]="0xc000006d" [Subestado]="0xc0000064" [[Informaci¾n de proceso]] [Id. de proceso del autor de la llamada]="0x0" [Nombre de proceso del autor de la llamada]="" [[Informaci¾n de red]] [Nombre de estaci¾n de trabajo]="LAPTOP" [Direcci¾n de red de origen]="" [Puerto de origen]="" [[Informaci¾n de autenticaci¾n detallada]] [Proceso de inicio de sesi¾n]="NtLmSsp" [Paquete de autenticaci¾n]="NTLM" [Servicios transitados]="" [Nombre de paquete (s¾lo NTLM)]="" [Longitud de clave]="0"]]></testEvent>
    <testEvent><![CDATA[2016-06-15T02:53:39Z host1 10.1.2.249 AccelOps-WUA-WinLog-Security [monitorStatus]="Success" [Locale]="en-US" [MachineGuid]="11111111-1111-1111-1111-111111111111" [timeZone]="+0800" [eventName]="Security" [eventSource]="Microsoft-Windows-Security-Auditing" [eventId]="5156" [eventType]="Information" [domain]="" [computer]="host1" [user]="" [userSID]="" [userSIDAcctType]="" [eventTime]="Jun 15 2016 02:53:39" [deviceTime]="Jun 15 2016 02:53:39" [msg]="The Windows Filtering Platform has permitted a connection." [[Application Information]][Process ID]="4" [Application Name]="System" [[Network Information]][Direction]="Inbound" [Source Address]="10.1.3.255" [Source Port]="137" [Destination Address]="10.1.2.199" [Destination Port]="137" [Protocol]="17" [[Filter Information]][Filter Run-Time ID]="7457650" [Layer Name]="Receive/Accept" [Layer Run-Time ID]="44"]]></testEvent>
    <testEvent><![CDATA[2016-07-01T01:51:51Z example.com 10.1.2.249 AccelOps-WUA-WinLog [monitorStatus]="Failed" [Locale]="en-US" [MachineGuid]="11111111-1111-1111-1111-111111111111" [timeZone]="+0800" [errorString]="Failed to initialize 'EVENT LOG' monitoring of 'PreEmptive'. 2147943568 (Element not found.)"]]></testEvent>
    <testEvent><![CDATA[2022-12-16T16:31:54Z computer1 172.31.91.181 AccelOps-WUA-WinLog-Microsoft-IIS-Configuration/Operational [phCustId]="1" [customer]="super" [monitorStatus]="Success" [Locale]="en-US" [MachineGuid]="a343d712-8660-419c-b40c-4fe46bc92f08" [timeZone]="+0000" [eventName]="Microsoft-IIS-Configuration/Operational" [eventSource]="Microsoft-Windows-IIS-Configuration" [eventId]="29" [eventType]="5" [domain]="computer1" [computer]="computer1" [user]="Administrator" [userSID]="S-1-5-21-3523248010-1737578178-2087917891-500" [userSIDAcctType]="User" [eventTime]="Dec 16 2022 16:31:53" [deviceTime]="Dec 16 2022 16:31:53" [msg]="Changes to '/system.webServer/modules/add[@name=\"Fake6\"]' at 'MACHINE/WEBROOT/APPHOST' have successfully been committed."]]></testEvent>
  </testEvents>

  <eventFormatRecognizer><![CDATA[\sAccelOps-(?:WinLog-[OW]MI|WUA-WinLog)|\s+eventid="\d+"\s+keywords="[^"]*"\s+level="]]></eventFormatRecognizer>

  <languageLoader>
    <language>WinOSWmiParser-de_DE</language>
    <language>WinOSWmiParser-es_ES</language>
    <language>WinOSWmiParser-fr_FR</language>
    <language>WinOSWmiParser-it_IT</language>
    <language>WinOSWmiParser-ja</language>
    <language>WinOSWmiParser-ko_KR</language>
    <language>WinOSWmiParser-pl_PL</language>
    <language>WinOSWmiParser-ru_RU</language>
    <language>WinOSWmiParser-zh_CN</language>
    <language>WinOSWmiParser-zh_TW</language>
  </languageLoader>

  <!-- pattern definitions -->
  <patternDefinitions>
    <pattern name="patWordTab"><![CDATA[[^\t]+]]></pattern>
    <pattern name="patStrQuote"><![CDATA[[^']*]]></pattern>
    <pattern name="patStrRightSquareBracket"><![CDATA[[^\]]+]]></pattern>
    <pattern name="patStrLeftSquareBracket"><![CDATA[[^\[]*]]></pattern>
    <pattern name="patStrDollar"><![CDATA[[^\$]+]]></pattern>
    <pattern name="patStrAt"><![CDATA[[^@]*]]></pattern>
    <pattern name="patStrDot"><![CDATA[[^.]+]]></pattern>
    <pattern name="patToRightBracket"><![CDATA[[^)]+\)]]></pattern>
    <pattern name="patBool"><![CDATA[true|false]]></pattern>
    <pattern name="patDNSAction"><![CDATA[created|deleted|updated]]></pattern>
    <pattern name="patStrRightParen"><![CDATA[[^\)]*]]></pattern>
    <pattern name="patLine"><![CDATA[[^\n]*]]></pattern>
  </patternDefinitions>

  <parsingInstructions>
    <switch>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[\s<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<_year:gPatYear>\s+<reptDevIpAddr:gPatIpAddr>\s+AccelOps-<_category:patStrLeftSquareBracket>\s+<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>
      </case>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[(?:<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>T<_time:gPatTime>Z|<_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<_year:gPatYear>)\s+<reptDevName:gPatHostName>\s+<reptDevIpAddr:gPatIpAddr>\s+AccelOps-<_category:patStrLeftSquareBracket>\s+<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time, "UTC")</setEventAttribute>
        <setEventAttribute attr="relayDevName">$reptDevName</setEventAttribute>
        <setEventAttribute attr="relayDevIpAddr">$reptDevIpAddr</setEventAttribute>
      </case>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatSyslogPRI>\d+\s+<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>T<_time:gPatTime>\.\d{1,3}<_tz:gPatTimeZone>\s+<:gPatHostName>(?:\s+\S+){3}\s+\[<_info:gPatMesgBodyMin>"\]\s+<msg:patLine>\n*<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="_body">formatRawWmiBody($_body)</setEventAttribute>
        <setEventAttribute attr="usrMsg">$_body</setEventAttribute>
      </case>
    </switch>

    <!-- remove \xA0 -->
    <setEventAttribute attr="_body">replaceStrInStr($_body, " ", "")</setEventAttribute>
    <!-- remove space (\x20) before ] -->
    <setEventAttribute attr="_body">replaceStrInStr($_body, " ]", "]")</setEventAttribute>

    <choose>
      <when test="not_exist _category">
        <collectAndSetAttrByKeyValuePair sep=" [" src="$_info">
          <attrKeyMap attr="_logType" key="channel="/>
          <attrKeyMap attr="_id" key="eventid="/>
          <attrKeyMap attr="type" key="keywords="/>
          <attrKeyMap attr="eventSource" key="providername="/>
          <attrKeyMap attr="action" key="task="/>
          <attrKeyMap attr="user" key="userid="/>
          <attrKeyMap attr="cluster" key="vmw_cluster="/>
          <attrKeyMap attr="datacenter" key="vmw_datacenter="/>
          <attrKeyMap attr="_host" key="vmw_host="/>
          <attrKeyMap attr="vmName" key="vmw_object_id="/>
          <attrKeyMap attr="vcenter" key="vmw_vcenter="/>
        </collectAndSetAttrByKeyValuePair>

        <when test="exist _host">
          <setEventAttribute attr="reptDevName">$_host</setEventAttribute>
          <setEventAttribute attr="_ip">resolveDNSName($_host)</setEventAttribute>
          <choose>
            <when test="exist _ip">
              <setEventAttribute attr="reptDevIpAddr">$_ip</setEventAttribute>
            </when>
            <otherwise>
              <setEventAttribute attr="reptDevIpAddr">""</setEventAttribute>
            </otherwise>
          </choose>
        </when>
      </when>

      <!-- when test="$_category = 'WinLog-WMI'" -->
      <when test="matches($_category, 'WinLog-[OW]MI')">

        <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
          <attrKeyMap attr="_logType" key="[Logfile]="/>
          <attrKeyMap attr="templateName" key="[templateName]="/>
          <attrKeyMap attr="seqNum" key="[RecordNumber]="/>
          <attrKeyMap attr="eventSource" key="[SourceName]="/>
          <attrKeyMap attr="_id" key="[EventCode]="/>
          <attrKeyMap attr="_eventTime" key="[TimeGenerated]="/>
          <attrKeyMap attr="type" key="[Type]="/>
          <attrKeyMap attr="reptDevName" key="[ComputerName]="/>
          <attrKeyMap attr="destName" key="[ComputerName]="/>
          <attrKeyMap attr="hostName" key="[ComputerName]="/>
          <attrKeyMap attr="computer" key="[ComputerName]="/>
          <attrKeyMap attr="msg" key="[Message]="/>
          <attrKeyMap attr="serviceName" key="[Service Name]="/>
          <attrKeyMap attr="serviceFileName" key="[Service File Name]="/>
          <attrKeyMap attr="serviceAccount" key="[Service Account]="/>
          <attrKeyMap attr="serviceType" key="[Service Type]="/>
          <attrKeyMap attr="srcIpAddrList" key="[Client IP]="/>
          <attrKeyMap attr="errorString" key="[Error message]="/>
          <attrKeyMap attr="details" key="[Exception details]="/>
          <attrKeyMap attr="user" key="[User]="/>
          <attrKeyMap attr="appName" key="[Windows Installer removed the product. Product Name]="/>
        </collectAndSetAttrByKeyValuePair>
        <when test="exist srcIpAddrList">
          <switch>
            <case>
              <collectFieldsByRegex src="$srcIpAddrList">
                <regex><![CDATA[<srcIpAddr:gPatIpAddr>,?]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>

        <when test="not_exist serviceFileName">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[Service File Name\]=<serviceFileName:patStrLeftSquareBracket>]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="serviceFileName">replaceStringByRegex($serviceFileName, "(?:^\s*\"\s*\"|\"\s*\"\s*$)", "")</setEventAttribute>
            </case>
            <default/>
          </switch>
        </when>
        <when test="exist msg">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[Message\]="<msg:gPatMesgBodyMin>"(?:\s*$|\s+\[)]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>
        <when test="$_category = 'WinLog-WMI'">
          <setEventAttribute attr="extEventRecvProto">WMI</setEventAttribute>
        </when>
        <when test="$_category = 'WinLog-OMI'">
          <setEventAttribute attr="extEventRecvProto">OMI</setEventAttribute>
        </when>

        <setEventAttribute attr="eventTime">toUnixTime($_eventTime)</setEventAttribute>
        <when test="exist deviceTime">
          <setEventAttribute attr="_latency">calculateLatency($deviceTime, $eventTime)</setEventAttribute>
          <setEventAttribute attr="latency">scale($_latency, 1000)</setEventAttribute>
        </when>
      </when>

      <otherwise>
        <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
          <attrKeyMap attr="_logType" key="[eventName]="/>
          <attrKeyMap attr="eventSource" key="[eventSource]="/>
          <attrKeyMap attr="_id" key="[eventId]="/>
          <attrKeyMap attr="_eventTime" key="[deviceTime]="/>
          <attrKeyMap attr="_eventTime" key="[eventTime]="/>
          <attrKeyMap attr="domain" key="[domain]="/>
          <attrKeyMap attr="_locale" key="[Locale]="/>
          <attrKeyMap attr="type" key="[monitorStatus]="/>
          <attrKeyMap attr="status" key="[monitorStatus]="/>
          <attrKeyMap attr="msg" key="[msg]="/>
          <attrKeyMap attr="reptDevName" key="[computer]="/>
          <attrKeyMap attr="hostName" key="[computer]="/>
          <attrKeyMap attr="computer" key="[computer]="/>
          <attrKeyMap attr="errorString" key="[errorString]="/>
          <attrKeyMap attr="_machineGUID" key="[MachineGuid]="/>
          <attrKeyMap attr="procName" key="[procName]="/>
          <attrKeyMap attr="user" key="[user]="/>
          <attrKeyMap attr="securityId" key="[userSID]="/>
          <attrKeyMap attr="serviceName" key="[Service Name]="/>
          <attrKeyMap attr="serviceFileName" key="[Service File Name]="/>
          <attrKeyMap attr="serviceAccount" key="[Service Account]="/>
          <attrKeyMap attr="serviceType" key="[Service Type]="/>
          <attrKeyMap attr="phCustId" key="[phCustId]="/>
          <attrKeyMap attr="customer" key="[customer]="/>
          <attrKeyMap attr="fileName" key="[File Name]="/>
          <attrKeyMap attr="_xml" key="[XML]="/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="extEventRecvProto">Windows Agent</setEventAttribute>

        <when test="exist _xml">
          <collectAndSetAttrByKeyValuePair sep="&lt;" src="$_xml">
            <attrKeyMap attr="authenMethod" key="&lt;AuditType&gt;"/>
            <attrKeyMap attr="authResult" key="&lt;AuditResult&gt;"/>
            <attrKeyMap attr="errorCode" key="&lt;ErrorCode&gt;"/>
            <attrKeyMap attr="srcUser" key="&lt;UserId&gt;"/>
            <attrKeyMap attr="authServerName" key="&lt;Server&gt;"/>
            <attrKeyMap attr="appTransportProto" key="&lt;AuthProtocol&gt;"/>
            <attrKeyMap attr="srcNetwork" key="&lt;NetworkLocation&gt;"/>
            <attrKeyMap attr="srcIpAddr" key="&lt;IpAddress&gt;"/>
            <attrKeyMap attr="httpProxyRealm" key="&lt;ProxyIpAddress&gt;"/>
            <attrKeyMap attr="UserAgentString" key="&lt;UserAgentString&gt;"/>
            <attrKeyMap attr="httpEndUri" key="&lt;Endpoint&gt;"/>
            <attrKeyMap attr="errorString" key="&lt;FailureType&gt;"/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="exist fileName">
          <collectFieldsByRegex src="$fileName">
            <regex><![CDATA[(?:<filePath:gPatMesgBody>\\)?<fileName:gPatMesgBodyMin>\s*$]]></regex>
          </collectFieldsByRegex>
        </when>

        <when test="exist _eventTime">
          <!-- Dec 19 2018 06:28:10 -->
          <!-- this is UTC time -->
          <collectFieldsByRegex src="$_eventTime">
            <regex><![CDATA[^<_etmon:gPatMon>\s+<_etday:gPatDay>\s+<_etyear:gPatYear>\s+<_ettime:gPatTime>]]></regex>
          </collectFieldsByRegex>
          <setEventAttribute attr="eventTime">toDateTime($_etmon, $_etday, $_etyear, $_ettime, "UTC")</setEventAttribute>
        </when>

        <switch>
          <case>
            <collectFieldsByRegex src="$_category">
              <regex><![CDATA[^WUA-WinLog-<subtype:gPatMesgBodyMin>\s*$]]></regex>
            </collectFieldsByRegex>

            <choose>
              <when test="$subtype = 'ForwardedEvents'">
                <setEventAttribute attr="reptDevIpAddr">""</setEventAttribute>
                <when test="exist computer">
                  <setEventAttribute attr="_ip">resolveDNSName($computer)</setEventAttribute>
                  <when test="exist _ip">
                    <setEventAttribute attr="srcIpAddr">$_ip</setEventAttribute>
                    <setEventAttribute attr="reptDevIpAddr">$_ip</setEventAttribute>
                  </when>
                </when>
              </when>
              <otherwise>
                <setEventAttribute attr="machineGUID">$_machineGUID</setEventAttribute>
              </otherwise>
            </choose>
          </case>
          <default>
            <setEventAttribute attr="machineGUID">$_machineGUID</setEventAttribute>
          </default>
        </switch>
      </otherwise>
    </choose>

    <when test="not_exist serviceName">
      <when test="exist serviceFileName">
        <setEventAttribute attr="serviceName">$serviceFileName</setEventAttribute>
      </when>
    </when>
    <choose>
      <when test="not_exist _logType"/>
      <when test="matches($_logType, '^[a-z]')">
        <!-- if starts with lower case, change the first letter to upper case -->
        <setEventAttribute attr="_first">replaceStringByRegex($_logType, "(?&lt;=.).*", "")</setEventAttribute>
        <setEventAttribute attr="_first">toUpper($_first)</setEventAttribute>
        <setEventAttribute attr="_rest">replaceStringByRegex($_logType, "^.", "")</setEventAttribute>
        <setEventAttribute attr="_logType">combineMsgId($_first, $_rest)</setEventAttribute>
      </when>
    </choose>
    <when test="exist eventSource">
      <setEventAttribute attr="_sourceName">replaceStringByRegex($eventSource, "\s+", "-")</setEventAttribute>
      <setEventAttribute attr="_sourceName">replaceStringByRegex($_sourceName, "[()]", "")</setEventAttribute>
    </when>

    <choose>
      <when test="not_exist _logType">
        <setEventAttribute attr="eventType">Win-Generic</setEventAttribute>
      </when>
      <when test="$_logType = 'Security'">
        <choose>
          <when test="$_sourceName = 'LOGbndSC'">
            <setEventAttribute attr="eventType">combineMsgId("Win-Security-LOGbndSC-", $_id)</setEventAttribute>
          </when>
          <when test="$_sourceName = 'AD-FS-Auditing'">
            <setEventAttribute attr="eventType">combineMsgId("Win-AD-FS-", $_id)</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId("Win-Security-", $_id)</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_logType = 'Application'">
        <choose>
          <when test="matches($eventSource, '^MSSQL\$\w+$')">
            <setEventAttribute attr="eventType">combineMsgId("Win-App-MSSQLSERVER-", $_id)</setEventAttribute>
          </when>
          <when test="matches($eventSource, '^SQLAgent\$\w+$')">
            <setEventAttribute attr="eventType">combineMsgId("Win-App-SQLSERVERAGENT-", $_id)</setEventAttribute>
          </when>
          <when test="matches($eventSource, '^Report Server Windows Service \(MSSQLSERVER\)$')">
            <setEventAttribute attr="eventType">combineMsgId("Win-App-MSSQL-SSRS-", $_id)</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId("Win-App-", $_sourceName, "-", $_id)</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_logType = 'CodeIntegrity Operational'">
        <setEventAttribute attr="eventType">combineMsgId("Win-CodeIntegrity-Operational-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType IN 'DFS Replication, DNS Server'">
        <setEventAttribute attr="eventType">combineMsgId("Win-App-", $_sourceName, "-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'DNS Client'">
        <setEventAttribute attr="eventType">combineMsgId("Win-DNS-Client-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Firewall AS'">
        <setEventAttribute attr="eventType">combineMsgId("Win-Firewall-AS-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'MSExchange Management'">
        <setEventAttribute attr="eventType">combineMsgId("Win-MSExchange-Management-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'OpenSSH'">
        <setEventAttribute attr="eventType">combineMsgId("Win-OpenSSH-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Microsoft-Windows-Sysmon/Operational'">
        <setEventAttribute attr="eventType">combineMsgId("Win-Sysmon-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Microsoft-Windows-DNSServer/Audit'">
        <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Microsoft-Windows-AppXDeployment-Server'">
        <setEventAttribute attr="eventType">combineMsgId("Win-AppXDeployment-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType IN 'Windows PowerShell, Microsoft-Windows-PowerShell/Operational'">
        <setEventAttribute attr="eventType">combineMsgId("Win-PowerShell-", $_id)</setEventAttribute>
        <switch>
          <case>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^Creating Scriptblock text[^:]*:<script:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </case>
          <default/>
        </switch>
      </when>

      <when test="$_logType = 'Microsoft-Windows-DNSServer/Analytical'">
        <collectFieldsByRegex src="$msg">
          <regex><![CDATA[^<type:gPatStrEndColon>:<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=";" src="$_body">
          <attrKeyMap attr="srcIpPort" key="TCP="/>
          <attrKeyMap attr="dnsServer" key="InterfaceIP="/>
          <attrKeyMap attr="srcIpAddr" key="Source="/>
          <attrKeyMap attr="destName" key="QNAME="/>
          <attrKeyMap attr="dnsQueryType" key="QTYPE="/>
          <attrKeyMap attr="queryId" key="XID="/>
          <attrKeyMap attr="srcIpPort" key="Port="/>
          <attrKeyMap attr="destIpAddr" key="Destination="/>
          <attrKeyMap attr="dnsSec" key="DNSSEC="/>
          <attrKeyMap attr="dnsResponseCode" key="RCODE="/>
          <attrKeyMap attr="reason" key="Reason="/>
          <attrKeyMap attr="scope" key="Scope="/>
          <attrKeyMap attr="scope" key="ServerScope="/>
          <attrKeyMap attr="scope" key="ZoneScope="/>
          <attrKeyMap attr="cacheScope" key="CacheScope="/>
          <attrKeyMap attr="dnsZone" key="Zone="/>
          <attrKeyMap attr="policyName" key="PolicyName="/>
        </collectAndSetAttrByKeyValuePair>

        <when test="not_exist srcIpAddr">
          <when test="exist reptDevIpAddr">
            <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
          </when>
        </when>

        <when test="exist destName">
          <setEventAttribute attr="destName">trimAttribute($destName, ".")</setEventAttribute>
        </when>

        <choose>
          <when test="$_id = '256'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Query-received")</setEventAttribute>
          </when>
          <when test="$_id = '257'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Response-success")</setEventAttribute>
          </when>
          <when test="$_id = '258'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Response-failure")</setEventAttribute>
          </when>
          <when test="$_id = '259'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Ignored-query")</setEventAttribute>
          </when>
          <when test="$_id = '260'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Query-out")</setEventAttribute>
          </when>
          <when test="$_id = '261'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Response-in")</setEventAttribute>
          </when>
          <when test="$_id = '262'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Recursive-query-timeout")</setEventAttribute>
          </when>
          <when test="$_id = '263'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Update-in")</setEventAttribute>
          </when>
          <when test="$_id = '264'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Update-response")</setEventAttribute>
          </when>
          <when test="$_id = '265'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "IXFR-request-out")</setEventAttribute>
          </when>
          <when test="$_id = '266'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "IXFR-request-in")</setEventAttribute>
          </when>
          <when test="$_id = '267'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "IXFR-response-out")</setEventAttribute>
          </when>
          <when test="$_id = '268'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "IXFR-response-in")</setEventAttribute>
          </when>
          <when test="$_id = '269'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "AXFR-request-out")</setEventAttribute>
          </when>
          <when test="$_id = '270'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "AXFR-request-in")</setEventAttribute>
          </when>
          <when test="$_id = '271'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "AXFR-response-out")</setEventAttribute>
          </when>
          <when test="$_id = '272'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "AXFR-response-in")</setEventAttribute>
          </when>
          <when test="$_id = '273'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "XFR-notification-in")</setEventAttribute>
          </when>
          <when test="$_id = '274'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "XFR-notification-out")</setEventAttribute>
          </when>
          <when test="$_id = '275'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "XFR-notify-ACK-in")</setEventAttribute>
          </when>
          <when test="$_id = '276'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "XFR-notify-ACK-out")</setEventAttribute>
          </when>
          <when test="$_id = '277'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Update-forward")</setEventAttribute>
          </when>
          <when test="$_id = '278'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Update-response-in")</setEventAttribute>
          </when>
          <when test="$_id = '279'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Internal-lookup-CNAME")</setEventAttribute>
          </when>
          <when test="$_id = '280'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", "Internal-lookup-additional")</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id, "-", $type)</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_logType = 'Directory Service'">
        <setEventAttribute attr="eventType">combineMsgId("Win-App-AD-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Microsoft-IIS-Logging/Logs'">
        <setEventAttribute attr="eventType">combineMsgId("Win-IIS-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Microsoft-IIS-Configuration/Operational'">
        <setEventAttribute attr="eventType">combineMsgId("Win-IIS-Configuration-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'AD FS/Admin'">
        <setEventAttribute attr="eventType">combineMsgId("Win-AD-FS-", $_id)</setEventAttribute>
        <when test="$_id = '364'">
          <when test="exist msg">
            <setEventAttribute attr="_msg">replaceStrInStr($msg, "\r\n", " ")</setEventAttribute>
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[Additional Data\s+Protocol Name:\s+<appTransportProto:gPatStr>\s+Relying Party:\s+<srcApp:gPatStr>\s+Exception details:\s+<errReason:gPatMesgBody>]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
        </when>
      </when>

      <when test="$_logType = 'Security Mitigation'">
        <setEventAttribute attr="eventType">combineMsgId("Win-Security-Mitigation-", $_id)</setEventAttribute>
      </when>

      <when test="$_logType = 'Shell-Core'">
        <setEventAttribute attr="eventType">combineMsgId("Win-Shell-Core-", $_id)</setEventAttribute>
      </when>

      <otherwise>
        <setEventAttribute attr="eventType">combineMsgId("Win-", $_logType, "-", $_sourceName, "-", $_id)</setEventAttribute>
      </otherwise>
    </choose>

    <choose>
      <when test="matches($type, __i18n_patAudit_Success)">
        <setEventAttribute attr="type">Audit Success</setEventAttribute>
      </when>
      <when test="matches($type, __i18n_patAudit_Failure)">
        <setEventAttribute attr="type">Audit Failure</setEventAttribute>
      </when>
      <when test="matches($type, __i18n_patError)">
        <setEventAttribute attr="type">Audit Failure</setEventAttribute>
      </when>
      <when test="matches($type, '成功|correcta')">
        <setEventAttribute attr="type">Audit Success</setEventAttribute>
      </when>
      <when test="matches($type, '失[败敗]|Error de')">
        <setEventAttribute attr="type">Audit Failure</setEventAttribute>
      </when>
    </choose>

    <choose>
      <when test="matches($type, 'Success')">
        <setEventAttribute attr="eventAction">0</setEventAttribute>
      </when>
      <when test="matches($type, 'Failure|Failed')">
        <setEventAttribute attr="eventAction">1</setEventAttribute>
      </when>
    </choose>

    <!-- SharePoint Audit Events -->
    <choose>
      <when test="not_exist _logType"/>
      <when test="$_logType IN 'LOGbndSP, Security'">
        <when test="$eventSource IN 'LOGbndSP, LOGbndSC'">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<:gPatMesgBody>,<_year:gPatYear>-<_mon:gPatMonNum>-<_day:gPatDay>T<_time:gPatTime>\..*]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="eventTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>
              <choose>
                <!-- SharePoint Audit Trail Integrity Events -->
                <when test="$_id = '11'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<newAuditPolicy:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '12'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<subtype:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<newAuditPolicy:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '20'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<logsDeleted:gPatStrComma>,<lastDate:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '60'">
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <!-- SharePoint Access Control Changes -->
                <when test="$_id = '25'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<groupID:gPatStrComma>,<groupName:gPatStrComma>,<initialMembers:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '26'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<groupID:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '27,28'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<groupID:gPatStrComma>,<groupName:gPatStrComma>,<memberID:gPatStrComma>,<memberName:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '29,30'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<parentObjType:gPatStrComma>,<parentObjSubtype:gPatStrComma>,<parentObjUrl:gPatStrComma>,<parentObjTitle:gPatStrComma>,<parentObjDescription:gPatStrComma>,<infoURL:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '31'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<subtype:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<targetName:gPatStrComma>,<targetType:gPatStrComma>,<permissionRoleName:gPatStrComma>,<permissionRoleDescription:gPatMesgBody>,,,,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '32'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<subtype:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<targetName:gPatStrComma>,<targetType:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '33'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '34,36'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<permissionLevelID:gPatStrComma>,<permissionLevelName:gPatStrComma>,<permissionLevelType:gPatStrComma>,<permissionLevelDescription:gPatStrComma>,<listPermissions:gPatStrComma>,<sitePermissions:gPatStrComma>,<personalPermissions:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '35'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<permissionLevelID:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '37,38'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<administratorID:gPatStrComma>,<administratorName:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint Document Update Events -->
                <when test="$_id IN '13,14,43'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<version:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '19'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<versionsDeleted:gPatStrComma>,<recycled:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint List Update Events -->
                <when test="$_id = '44'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '45'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint Container Object Update Events -->
                <when test="$_id = '40'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '41'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '42'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<libraryItemUpdated:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '46'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<version:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint Generic Object Change Events -->
                <when test="$_id = '15'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<parentObjType:gPatStrComma>,<parentObjSubtype:gPatStrComma>,<parentObjUrl:gPatStrComma>,<parentObjTitle:gPatStrComma>,<childObjType:gPatStrComma>,<childObjUrl:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '16'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<parentObjType:gPatStrComma>,<parentObjSubtype:gPatStrComma>,<parentObjUrl:gPatStrComma>,<parentObjTitle:gPatStrComma>,<parentObjDescription:gPatStrComma>,<childObjType:gPatStrComma>,<childObjTitle:gPatStrComma>,<childObjOrigLocation:gPatStrComma>,<childObjNewLocation:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '17'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<origLocation:gPatStrComma>,<newLocation:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '21'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<title:gPatStrComma>,<origLocation:gPatStrComma>,<newLocation:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '22'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<subtype:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<profileDetails:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '23'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<subtype:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<details:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '39,51'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint View Events -->
                <when test="$_id = '48'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '47'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<version:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '49,50'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '24'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<searchStr:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint Import/Export Events -->
                <when test="$_id = '56'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<requestedBy:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '57'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<requestedBy:gPatStrComma>,<totalNum:gPatStrComma>,<size:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '58'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<requestedBy:gPatStrComma>,<size:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id = '59'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<requestedBy:gPatStrComma>,<totalNum:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

                <!-- SharePoint Information Management Policy Changes -->
                <when test="$_id IN '52,53'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<objType:gPatStrComma>,<subtype:gPatStrComma>,<infoURL:gPatStrComma>,<title:gPatStrComma>,<description:gPatStrComma>,<policyDetails:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>
                <when test="$_id IN '54,55'">
                  <collectAndSetAttrByRegex src="$_body">
                    <regex><![CDATA[.*\[InsertionStrings\]="\(<:gPatStrComma>,<site:gPatStrComma>,<user:gPatStrComma>,<policyDetails:gPatStrComma>,.*]]></regex>
                  </collectAndSetAttrByRegex>
                  <setEventAttribute attr="eventSeverity">1</setEventAttribute>
                </when>

              </choose>

              <when test="exist infoURL">
                <setEventAttribute attr="destName">extractHostFromURL($infoURL)</setEventAttribute>
              </when>
            </case>
            <default>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
                <attrKeyMap attr="domain" key="domain]="/>
                <attrKeyMap attr="hostName" key="computer]="/>
                <attrKeyMap attr="srcUser" key="user]="/>
                <attrKeyMap attr="securityId" key="userSID]="/>
                <attrKeyMap attr="_deviceTime" key="deviceTime]="/>
                <attrKeyMap attr="msg" key="msg]="/>
                <attrKeyMap attr="site" key="Site]="/>
                <attrKeyMap attr="user" key="User]="/>
                <attrKeyMap attr="details" key="details]="/>
                <attrKeyMap attr="downloadURL" key="URL]="/>
                <attrKeyMap attr="_title" key="Title]="/>
                <attrKeyMap attr="version" key="Version]="/>
                <attrKeyMap attr="infoURL" key="For more information, see http]="/>
              </collectAndSetAttrByKeyValuePair>

              <when test="exist _deviceTime">
                <case>
                  <collectFieldsByRegex src="$_deviceTime">
                    <regex><![CDATA[<_mon:gPatMon>\s+<_day:gPatDay>\s+<_year:gPatYear>\s+<_time:gPatTime>]]></regex>
                  </collectFieldsByRegex>
                </case>
                <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>
              </when>
              <when test="exist infoURL">
                <!-- Prune the // at start of url -->
                <switch>
                  <case>
                    <collectFieldsByRegex src="$infoURL">
                      <regex><![CDATA[^\/\/<infoURL:gPatMesgBody>$]]></regex>
                    </collectFieldsByRegex>
                  </case>
                  <default/>
                </switch>
              </when>
            </default>
          </switch>
        </when>

      </when>
    </choose>
    <choose>
      <when test="not_exist _logType"/>
      <when test="$_logType = 'Security'">
        <when test="$_id = '501'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '512'">
          <!-- windows staring up -->
          <setEventAttribute attr="eventSeverity">2</setEventAttribute>
        </when>

        <when test="$_id = '513'">
          <!-- windows shutting down -->
          <setEventAttribute attr="eventSeverity">2</setEventAttribute>
        </when>

        <when test="$_id = '514'">
          <!-- auth package loaded <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	514	Security	SYSTEM	User	Success Audit	ADS-PRI	An authentication package has been loaded by the Local Security Authority		Authentication Package Name]=NTLM  -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Authentication Package Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">6</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '515'">
          <!-- trusted logon process registered <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	515	Security	SYSTEM	User	Success Audit	ADS-PRI	A trusted logon process has registered with the Local Security Authority		Logon Process Name]=KSecDD  -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Logon Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">6</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '516'">
          <!-- internal resources for queueing audit messages exhausted -->
          <setEventAttribute attr="eventSeverity">7</setEventAttribute>
        </when>

        <when test="$_id = '517'">
          <!-- audit log cleared <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	517	Security	SYSTEM	User	Success Audit	ADS-PRI	The audit log was cleared		Client User Name]=user   Client Domain]=ABC		Client Logon ID]=(0x0, 0x158E87)  -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Client User Name]="/>
            <attrKeyMap attr="domain" key="[Client Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Client Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '518'">
          <!-- notofication package loaded <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	515	Security	SYSTEM	User	Success Audit	ADS-PRI	A notification package has been loaded by the Security Account Manager		Notification Package Name]=scecli  -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Notification Package Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">6</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '519'">
          <!-- process using invalid LPC port -->
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '520'">
          <!-- system time changed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	520	Security	SYSTEM	User	Success Audit	ADS-PRI	The system time was changed		Client User Name]=joeUser   Client Domain]=ABC		Client Logon ID]=(0x0, 0x158E87)  Process name]=C:\WINDOWS\system32\rundll32.exe -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Client User Name]="/>
            <attrKeyMap attr="domain" key="[Client Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Client Logon ID]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">6</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '528, 538'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id IN '529, 530, 531, 532, 533, 534, 535, 536, 537'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcName" key="[Workstation Name]="/>
            <attrKeyMap attr="computer" key="[Workstation Name]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        </when>

        <when test="$_id = '539'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="srcName" key="[Workstation Name]="/>
            <attrKeyMap attr="computer" key="[Workstation Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">10</setEventAttribute>
        </when>

        <when test="$_id = '540'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="srcUser" key="[User Name]="/>
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="srcName" key="[Workstation Name]="/>
            <attrKeyMap attr="computer" key="[Workstation Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
            <attrKeyMap attr="winLogonCallerUser" key="[Caller User Name]="/>
            <attrKeyMap attr="procName" key="[Logon Process]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist srcName">
            <switch>
              <case>
                <collectFieldsByRegex src="$srcName">
                  <regex><![CDATA[[\\]<srcName:gPatMesgBody>]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '552'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target User Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        </when>

        <when test="$_id = '560'">
          <!-- various <13>Dec 12 10:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	560	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Open		Client User Name: suer   Client Domain: ABC		Client Logon ID: (0x0,0x158E87)  Object Type: File  Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe Object Name: C:\ConfidentialFiles\ProjectPlan.doc.txt  Accesses: WriteData (or AddFile) AppendData (or AddSubdirectory or CreatePipeInstance) -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Image File Name]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
            <attrKeyMap attr="_user" key="[Client User Name]="/>
            <attrKeyMap attr="_domain" key="[Client Domain]="/>
            <attrKeyMap attr="_winLogonId" key="[Client Logon ID]="/>
            <attrKeyMap attr="user" key="[Primary User Name]="/>
            <attrKeyMap attr="domain" key="[Primary Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Primary Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">2</setEventAttribute>
          <switch>
            <case>
              <collectFieldsByRegex src="$user">
                <regex><![CDATA[<:patStrDollar>\$]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="user">$_user</setEventAttribute>
              <setEventAttribute attr="domain">$_domain</setEventAttribute>
              <setEventAttribute attr="winLogonId">$_winLogonId</setEventAttribute>
            </case>
            <default/>
          </switch>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '562'">
          <!-- windows object closed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	562	Security	SYSTEM	User	Success Audit	ADS-PRI	Handle Closed	 Handle ID]=144 	Image File Name]=C:\WINDOWS\system32\notepad.exe -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Image File Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="_user" key="[User]="/>
          </collectAndSetAttrByKeyValuePair>

          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-560">
            <when test="$osObjHandleID = $AnotherEvent.osObjHandleID">
              <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              <setEventAttribute attr="user">$AnotherEvent.user</setEventAttribute>
              <setEventAttribute attr="domain">$AnotherEvent.domain</setEventAttribute>
              <setEventAttribute attr="winLogonId">$AnotherEvent.winLogonId</setEventAttribute>
              <setEventAttribute attr="osObjName">$AnotherEvent.osObjName</setEventAttribute>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '563'">
          <!-- windows object open for delete <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	563	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Open for Delete		Client User Name]=user   Client Domain]=ABC		Client Logon ID]=(0x0, 0x158E87)  Object Type]=File  New Handle ID]=144 	Image File Name]=C:\WINDOWS\system32\notepad.exe Object Name:C:\ConfidentialFiles\ ProjectPlan.doc.txt  Accesses]=WriteData (or AddFile) AppendData (or AddSubdirectory or CreatePipeInstance) -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="_user" key="[Client User Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="$_user != '-')">
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
                <attrKeyMap attr="user" key="[Client User Name]="/>
                <attrKeyMap attr="domain" key="[Client Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Client Logon ID]="/>
                <attrKeyMap attr="procName" key="[Image File Name]="/>
                <attrKeyMap attr="osObjType" key="[Object Type]="/>
                <attrKeyMap attr="osObjName" key="[Object Name]="/>
                <attrKeyMap attr="osObjHandleID" key="[New Handle ID]="/>
                <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
              </collectAndSetAttrByKeyValuePair>
            </when>
            <otherwise>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
                <attrKeyMap attr="user" key="[Primary User Name]="/>
                <attrKeyMap attr="domain" key="[Primary Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Primary Logon ID]="/>
                <attrKeyMap attr="procName" key="[Image File Name]="/>
                <attrKeyMap attr="osObjType" key="[Object Type]="/>
                <attrKeyMap attr="osObjName" key="[Object Name]="/>
                <attrKeyMap attr="osObjHandleID" key="[New Handle ID]="/>
                <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
              </collectAndSetAttrByKeyValuePair>
            </otherwise>
            <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
              <when test="exist winLogonId">
                <when test="$winLogonId = $AnotherEvent.winLogonId">
                  <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
                </when>
              </when>
            </collectAndSetAttrFromAnotherEvent>
          </choose>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '564'">
          <!-- windows object deleted <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	564	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Deleted	 Handle ID]=144 	Image File Name]=C:\WINDOWS\system32\notepad.exe -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Image File Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="_user" key="[User]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist _user">
            <collectAndSetAttrByPos src="$_user" sep="\">
              <attrPosMap attr="domain" pos="1"/>
              <attrPosMap attr="user" pos="2"/>
            </collectAndSetAttrByPos>
          </when>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-560">
            <when test="$osObjHandleID = $AnotherEvent.osObjHandleID">
              <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              <setEventAttribute attr="user">$AnotherEvent.user</setEventAttribute>
              <setEventAttribute attr="domain">$AnotherEvent.domain</setEventAttribute>
              <setEventAttribute attr="winLogonId">$AnotherEvent.winLogonId</setEventAttribute>
              <setEventAttribute attr="osObjName">$AnotherEvent.osObjName</setEventAttribute>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '567'">
          <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	567	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Access Attempt	 Object Type: File  Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe Accesses: WriteData (or AddFile) AppendData (or AddSubdirectory or CreatePipeInstance) -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="procName" key="[Image File Name]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
            <attrKeyMap attr="user" key="[User]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-560">
            <when test="$osObjHandleID = $AnotherEvent.osObjHandleID">
              <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              <setEventAttribute attr="user">$AnotherEvent.user</setEventAttribute>
              <setEventAttribute attr="domain">$AnotherEvent.domain</setEventAttribute>
              <setEventAttribute attr="winLogonId">$AnotherEvent.winLogonId</setEventAttribute>
              <setEventAttribute attr="osObjName">$AnotherEvent.osObjName</setEventAttribute>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '576'">
          <!-- Special privileges assigned to new logon -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[User]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '578'">
          <!--  PRIVILEDGED OBJECT OPERATION <13>Mar 10 15:40:44 ADS-Pri.example.com MSWinEventLog     1       Security        1250    Mon Mar 10 15:40:24 2008        578     Security        Administrator  User    Failure Audit   ADS-PRI Privilege Use           Privileged object operation:     Object Server: Security     Object Handle: 0     Process ID: 2080     Primary User Name: Administrator     Primary Domain: ABC     Primary Logon ID: (0x0,0x3F98A7)     Client User Name: -     Client Domain: -     Client Logon ID: -     Privileges: SeTcbPrivilege         1237 -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="_user" key="[Client User Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          <choose>
            <when test="$_user != '-'">
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
                <attrKeyMap attr="user" key="[Client User Name]="/>
                <attrKeyMap attr="domain" key="[Client Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Client Logon ID]="/>
              </collectAndSetAttrByKeyValuePair>
            </when>
            <otherwise>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
                <attrKeyMap attr="user" key="[Primary User Name]="/>
                <attrKeyMap attr="domain" key="[Primary Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Primary Logon ID]="/>
              </collectAndSetAttrByKeyValuePair>
            </otherwise>
          </choose>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528 ">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '592, 593'">
          <!--  A new process has been created <13>Mar 10 17:06:43 ADS-Pri.example.com MSWinEventLog	1	Security	8485	Mon Mar 10 17:06:36 2008	592	Security	SYSTEM	User	Success Audit	ADS-PRI	Detailed Tracking		A new process has been created:     New Process ID: 5788     Image File Name: C:\Program Files\Splunk\bin\splunk-optimize.exe     Creator Process ID: 4416     User Name: ADS-PRI$     Domain: ABC     Logon ID: (0x0,0x3E7)    	8470 <13>Mar 10 16:56:13 ADS-Pri.example.com MSWinEventLog	1	Security	7827	Mon Mar 10 16:56:05 2008	593	Security	SYSTEM	User	Success Audit	ADS-PRI	Detailed Tracking		A process has exited:     Process ID: 5160     Image File Name: C:\Program Files\Splunk\bin\splunk-optimize.exe     User Name: ADS-PRI$     Domain: ABC     Logon ID: (0x0,0x3E7)    	7813 -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="fileName" key="[Image File Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="procName" key="[Image File Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '608'">
          <!-- user right assigned <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="_targetDomUser" key="[Assigned To]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectFieldsByRegex src="$_targetDomUser">
            <regex><![CDATA[<targetDomain:gPatStr>[\\]<targetUser:gPatStr>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '609'">
          <!-- user right removed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="_userRight" key="[User Right]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectFieldsByRegex src="$_userRight">
            <regex><![CDATA[ <targetUser:gPatWord> Removed From <targetUserGrp:gPatWord>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '610, 611, 620'">
          <!-- windows trust domain added/modified/removed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="targetDomain" key="[Domain Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">8</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '612, 617, 618, 619'">
          <!-- kerberos policy, QoS policy, audit policy <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	612	Security	SYSTEM	User	Success Audit	ADS-PRI	Windows Audit Policy Changed		User Name]=user   Domain]=ABC		Logon ID]=(0x0, 0x158E87)  -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '613'">
          <!-- ipsec policy agent started -->
          <setEventAttribute attr="eventSeverity">2</setEventAttribute>
        </when>

        <when test="$_id = '614'">
          <!-- windows policy agent disabled -->
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '615'">
          <!-- windows ipsec policy changed -->
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '616'">
          <!-- windows policy agent serious failure -->
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id IN '621, 622'">
          <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="targetUser" key="[Account Modified]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[User Name]="/>
          </collectAndSetAttrByKeyValuePair>

          <switch>
            <case>
              <collectFieldsByRegex src="$targetUser">
                <regex><![CDATA[<targetDomain:gPatStr>[\\]<targetUser:gPatStr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>

          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">8</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '624, 645'">
          <!-- USER / COMPUTER ACCOUNT CREATED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	624	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Created		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0,0x158E87) 	New Account Name: user	New Domain: ABC	New Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[New Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[New Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '625, 626, 642, 627, 629, 630, 643, 646, 647'">
          <!-- USER ACCOUNT TYPE CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	625	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Type Change		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '631, 635, 648, 653, 658, 663'">
          <!-- Security enabled/disabled local/global/universal group created -->
          <!-- <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	631	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group created		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	New Account Name: user2  New Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUserGrp" key="[New Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[New Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '632, 636, 650, 655, 660, 665'">
          <!-- A member added to a security-enabled/disabled local/global/universal group -->
          <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP MEMBER ADDED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	632	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group member added		Caller User Name: user   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Member Name]="/>
            <attrKeyMap attr="targetUserGrp" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '633, 637, 651, 656, 661, 666'">
          <!-- A member was removed from a security-enabled global group -->
          <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP MEMBER REMOVED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	633	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group member removed		Caller User Name: user   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user2  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Member Name]="/>
            <attrKeyMap attr="targetUserGrp" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '634, 638, 652, 657, 662, 667, 639, 641, 649, 654, 659, 664'">
          <!-- Group deleted or modified -->
          <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP DELETED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUserGrp" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '640, 668'">
          <!-- 640: account database change, 668: group type change <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '644'">
          <!-- USER ACCOUNT LOCKED OUT <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	644	Security	SYSTEM	User	Success Audit	ADS-PRI	Domain Policy Changed		Caller User Name: abc-laptop$	 Caller Machine Name: abc-laptop  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: abc  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="hostName" key="[Caller Machine Name]="/>
            <attrKeyMap attr="user" key="[Target Account Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="$winLogonId = $AnotherEvent.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">10</setEventAttribute>
        </when>

        <when test="$_id = '669'">
          <!-- 670: add SID hostory success <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">4</setEventAttribute>
        </when>

        <when test="$_id IN '670, 671'">
          <!-- 670: add SID hostory failure, 671: account unlocked <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '672'">
          <!-- domain auth success/failure -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="winKerbFailCode" key="[Result Code]="/>
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="domain" key="[Supplied Realm Name]="/>
            <attrKeyMap attr="user" key="[User Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '673'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="domain" key="[User Domain]="/>
            <attrKeyMap attr="user" key="[User Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">2</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '674'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[User Domain]="/>
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '675'">
          <!-- FAILED DOMAIN AUTH VIA KERBEROS <13>Nov 29 00:01:12 ADS-Pri.example.com MSWinEventLog	1	Security	16714	Thu Nov 29 00:01:04 2007	675	Security	SYSTEM	User	Failure Audit	ADS-PRI	Pre-authentication failed:  User Name: user     User ID: ABC\user Service Name: krbtgt/abc Pre-Authentication Type: 0x02 Failure Code: 24 Client Address: 192.168.20.33     -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="_combUsrId" key="[User ID]="/>
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="winKerbFailCode" key="[Failure Code]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          <switch>
            <case>
              <collectFieldsByRegex src="$_combUsrId">
                <regex><![CDATA[<domain:gPatStr>\\]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>

        <when test="$_id = '676'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Supplied Realm Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        </when>

        <when test="$_id = '677'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Supplied Realm Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        </when>

        <when test="$_id = '680'">
          <!-- SUCCESSFUL / FAILED DOMAIN RESOURCE ACCESS VIA NTLM <13>Nov 29 00:01:12 ADS-Pri.example.com MSWinEventLog	1	Security	16714	Thu Nov 29 00:01:04 2007	680	Security	SYSTEM	User	Failure Audit	ADS-PRI  Account Used For Logon By  Logon Account]=user  Source Workstation]=joeUser_LAPTOP Error Code]=0xC0000064     -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="winLogonFailCode2" key="[Error Code]="/>
            <attrKeyMap attr="user" key="[User]="/>
            <attrKeyMap attr="user" key="[Logon account]="/>
            <attrKeyMap attr="user" key="[Logon Account]="/>
            <attrKeyMap attr="srcName" key="[Source Workstation]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '682, 683'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="srcName" key="[Client Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '684'">
          <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="_targetAcct" key="[Target Account ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectFieldsByRegex src="$_targetAcct">
            <regex><![CDATA[<targetDomain:gPatWord>\<:gPatWord>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '685'">
          <!-- ACCOUNT NAME CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Old Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">2</setEventAttribute>
        </when>

        <when test="$_id = '686'">
          <!-- password of user accessed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target User Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id IN '687, 688'">
          <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[New Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[New Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id IN '689, 690, 691, 692, 693, 694, 695, 696'">
          <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: user  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: user  Target Domain: ABC	Target Account ID: ABC\user -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Caller User Name]="/>
            <attrKeyMap attr="domain" key="[Caller Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Caller Logon ID]="/>
            <attrKeyMap attr="targetUser" key="[Target Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Target Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '806'">
          <!-- per user audit policy refreshed -->
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '807'">
          <!-- per user audit policy set -->
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '1001, 1003'">
          <!-- Process started or stopped -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[<:patWordTab>\s+<:patWordTab>\s+The <procName:gPatMesgBody> has<:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <setEventAttribute attr="hostIpAddr">$reptDevIpAddr</setEventAttribute>
        </when>

        <when test="$_id = '1102'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Domain Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '2020'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[<:patWordTab>\s+<:patWordTab>\s+<procName:gPatMesgBody> has terminated<:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <setEventAttribute attr="hostIpAddr">$reptDevIpAddr</setEventAttribute>
        </when>

        <when test="$_id = '4611'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="procName" key="[Logon Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4616'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_processInfo">
            <attrKeyMap attr="procName" key="[Name]="/>
            <attrKeyMap attr="msg" key="[details]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4624'">
          <!-- windows 2008 equivalent - concept of sections -->
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>(?:\[\[<:__i18n_patLogon_Information>\]\]<_logonInfo:gPatMesgBody>)?\[\[<:__i18n_patNew_Logon>\]\]<_newLogon:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_netInfo:gPatMesgBody>\[\[<:__i18n_patDetailed_Authentication_Information>\]\]<_detailedAuth:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>

          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="winLogonCallerUser" key="[Account Name]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>

          <when test="exist _logonInfo">
            <collectAndSetAttrByKeyValuePair sep=" [" src="$_logonInfo">
              <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_newLogon">
            <attrKeyMap attr="srcUser" key="[Account Name]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonGUID" key="[Logon GUID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_processInfo">
            <attrKeyMap attr="procName" key="[Process Name]="/>
            <attrKeyMap attr="procId" key="[Process ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_netInfo">
            <attrKeyMap attr="srcName" key="[Workstation Name]="/>
            <attrKeyMap attr="computer" key="[Workstation Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <!-- win logon proc is the logon method/ssp e.g. winlogon, schannel, advadpi, kerberos, ntlmssp -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_detailedAuth">
            <attrKeyMap attr="winLogonProc" key="[Logon Process]="/>
            <attrKeyMap attr="authenMethod" key="[Authentication Package]="/>
            <attrKeyMap attr="msgLen" key="[Key Length]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="permissionLevelID" key="[Impersonation Level]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist srcName">
            <switch>
              <case>
                <collectFieldsByRegex src="$srcName">
                  <regex><![CDATA[[\\]<srcName:gPatMesgBody>]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
        </when>

        <when test="$_id = '4625'">
          <!-- Fri Aug 31 18:27:47 2012 10.1.8.115 AccelOps-WinLog-WMI [Category]="12544" [CategoryString]="登录" [ComputerName]="CSJW-DbServer" [Data]="NULL" [EventCode]="4625" [EventIdentifier]="4625" [EventType]="5" [Logfile]="Security" [RecordNumber]="14141488" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20120831103329.843797-000" [TimeWritten]="20120831103329.843797-000" [Type]="审核失败" [User]="(null)" [Message]="帐户登录失败。" [[主题]] [安全 ID]="S-1-0-0" [帐户名]="" [帐户域]="" [登录 ID]="0x0" [登录类型]="3" [[登录失败的帐户]] [安全 ID]="S-1-0-0" [帐户名]="Administrator" [帐户域]="HNCSSW2" [[失败信息]] [失败原因]="未知用户名或密码错误。" [状态]="0xc000006d" [子状态]="0xc000006a" [[进程信息]] [调用方进程 ID]="0x0" [调用方进程名]="" [[网络信息]] [工作站名]="HNCSSW2" [源网络地址]="10.1.8.41" [源端口]="30217" [[详细身份验证信息]] [登录进程]="NtLmSsp" [身份验证数据包]="NTLM" [传递服务]="" [数据包名(仅限 NTLM)]="" [密钥长度]="0" -->
          <!-- Wed May  8 16:52:58 2013 172.16.20.232 AccelOps-WinLog-WMI [Category]="12544" [CategoryString]="Inicio de sesi¾n" [ComputerName]="Win2008Spanish.Win2008AD.net" [Data]="NULL" [EventCode]="4625" [EventIdentifier]="4625" [EventType]="5" [Logfile]="Security" [RecordNumber]="206341" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20130509073221.932817-000" [TimeWritten]="20130509073221.932817-000" [Type]="Error de auditorÝa" [User]="(null)" [Message]="Error de una cuenta al iniciar sesi¾n." [[Sujeto]] [Id. de seguridad]="S-1-0-0" [Nombre de cuenta]="" [Dominio de cuenta]="" [Id. de inicio de sesi¾n]="0x0" [Tipo de inicio de sesi¾n]="3" [Cuenta con error de inicio de sesi¾n]="" [Id. de seguridad]="S-1-0-0" [Nombre de cuenta]="Administrator" [Dominio de cuenta]="ACCELOPS" [[Informaci¾n de error]] [Motivo del error]="Nombre de usuario desconocido o contrase±a incorrecta" [Estado]="0xc000006d" [Subestado]="0xc0000064" [[Informaci¾n de proceso]] [Id. de proceso del autor de la llamada]="0x0" [Nombre de proceso del autor de la llamada]="" [[Informaci¾n de red]] [Nombre de estaci¾n de trabajo]="LAPTOP" [Direcci¾n de red de origen]="" [Puerto de origen]="" [[Informaci¾n de autenticaci¾n detallada]] [Proceso de inicio de sesi¾n]="NtLmSsp" [Paquete de autenticaci¾n]="NTLM" [Servicios transitados]="" [Nombre de paquete (s¾lo NTLM)]="" [Longitud de clave]="0" -->
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[(?:<:__i18n_patSubject>|<:__i18n_patMember>)\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patAccount_For_Which_Logon_Failed>\]\]<_failedLogon:gPatMesgBody>\[\[<:__i18n_patFailure_Information>\]\]<_failInfo:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_netInfo:gPatMesgBody>\[\[<:__i18n_patDetailed_Authentication_Information>\]\]<_detailedAuth:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patFailure_Information>\]\]<_failInfo:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_netInfo:gPatMesgBody>\[\[<:__i18n_patDetailed_Authentication_Information>\]\]<_detailedAuth:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
          </switch>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="winLogonCallerUser" key="[Account Name]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist _failedLogon">
            <collectAndSetAttrByKeyValuePair sep=" [" src="$_failedLogon">
              <attrKeyMap attr="user" key="[Account Name]="/>
              <attrKeyMap attr="domain" key="[Account Domain]="/>
              <attrKeyMap attr="securityId" key="[Security ID]="/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_failInfo">
            <attrKeyMap attr="errReason" key="[Failure Reason]="/>
            <attrKeyMap attr="errorCode" key="[Status]="/>
            <attrKeyMap attr="subStatus" key="[Sub Status]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_processInfo">
            <attrKeyMap attr="procName" key="[Caller Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_netInfo">
            <attrKeyMap attr="srcName" key="[Workstation Name]="/>
            <attrKeyMap attr="computer" key="[Workstation Name]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <!-- win logon proc is the logon method/ssp e.g. winlogon, schannel, advadpi, kerberos, ntlmssp -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_detailedAuth">
            <attrKeyMap attr="winLogonProc" key="[Logon Process]="/>
            <attrKeyMap attr="authenMethod" key="[Authentication Package]="/>
          </collectAndSetAttrByKeyValuePair>
          <switch>
            <case>
              <collectFieldsByRegex src="$srcName">
                <regex><![CDATA[.*\\\\<srcName:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>

        <when test="$_id IN '4698,4699,4700,4701,4702'">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTask_Information>\]\]<_taskInfo:gPatMesgBody>\[\[<:__i18n_patOther_Information>\]\]<_otherTaskInfo:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTask_Information>\]\]<_taskInfo:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
          </switch>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="securityId" key="[Security ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist _taskInfo">
            <collectAndSetAttrByKeyValuePair sep=" [" src="$_taskInfo">
              <attrKeyMap attr="task" key="[Task Name]="/>
              <attrKeyMap attr="details" key="[Task Content]="/>
              <attrKeyMap attr="details" key="[Task New Content]="/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <when test="exist _otherTaskInfo">
            <collectAndSetAttrByKeyValuePair sep=" [" src="$_otherTaskInfo">
              <attrKeyMap attr="createTime" key="[ProcessCreationTime]="/>
              <attrKeyMap attr="procId" key="[ClientProcessId]="/>
              <attrKeyMap attr="parentProcId" key="[ParentProcessId]="/>
              <attrKeyMap attr="fqdnName" key="[FQDN]="/>
            </collectAndSetAttrByKeyValuePair>
          </when>
        </when>
        <when test="$_id = '4704'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_target:gPatMesgBody>\[\[<:__i18n_patNew_Right>\]\]<_right:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_right">
            <attrKeyMap attr="userPerm" key="[User Right]="/>
            <attrKeyMap attr="privName" key="[Privileges]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id IN '4634, 4647, 4719, 4793'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="actionName" key="[Changes]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4648'">
          <!-- A logon was attempted using explicit credentials -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patAccount_Whose_Credentials_Were_Used>\]\]<_target:gPatMesgBody>\[\[<:__i18n_patTarget_Server>\]\]<_server:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_netInfo:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonGUID" key="[Logon GUID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_server">
            <attrKeyMap attr="targetName" key="[Target Server Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_processInfo">
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_netInfo">
            <attrKeyMap attr="srcIpAddr" key="[Network Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        </when>

        <when test="$_id IN '4656,4659'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
            <attrKeyMap attr="fileAccess" key="[Access Mask]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4657'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_object:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>\[\[<:__i18n_patChange_Information>\]\]<_change:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_object">
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjValue" key="[Object Value Name]="/>
            <attrKeyMap attr="osObjAction" key="[Operation Type]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_change">
            <attrKeyMap attr="newValueType" key="[New Value Type]="/>
            <attrKeyMap attr="newObjValue" key="[New Value]="/>
            <attrKeyMap attr="oldValueType" key="[Old Value Type]="/>
            <attrKeyMap attr="oldObjValue" key="[Old Value]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4658'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4660'">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_object:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
                <attrKeyMap attr="user" key="[Account Name]="/>
                <attrKeyMap attr="domain" key="[Account Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
              </collectAndSetAttrByKeyValuePair>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_object">
                <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
                <attrKeyMap attr="osObjName" key="[Object Name]="/>
                <attrKeyMap attr="osObjType" key="[Object Type]="/>
              </collectAndSetAttrByKeyValuePair>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
                <attrKeyMap attr="procName" key="[Process Name]="/>
              </collectAndSetAttrByKeyValuePair>
            </case>
            <default/>
          </switch>
        </when>

        <when test="$_id = '4661'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="fileAccess" key="[Access Mask]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4662'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="fileAccess" key="[Access Mask]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="serverName" key="[Object Server]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
            <attrKeyMap attr="propName" key="[Properties]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4663'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
            <attrKeyMap attr="serverName" key="[Object Server]="/>
            <attrKeyMap attr="fileAccess" key="[Access Mask]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4670'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_object:gPatMesgBody>\[\[<:__i18n_patProcess>\]\]<_process:gPatMesgBody>\[\[<:__i18n_patPermissions_Change>\]\]<_permChg:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_object">
            <attrKeyMap attr="osObjHandleID" key="[Handle ID]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_permChg">
            <attrKeyMap attr="originalSecurityDescriptor" key="[Original Security Descriptor]="/>
            <attrKeyMap attr="newSecurityDescriptor" key="[New Security Descriptor]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4672'">
          <!-- Special privileges assigned to new logon -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="privName" key="[Privileges]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4673'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
            <attrKeyMap attr="serviceName" key="[Service Name]="/>
            <attrKeyMap attr="_server" key="[Server]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
            <attrKeyMap attr="privName" key="[Privileges]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4674'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
            <attrKeyMap attr="osObjHandleID" key="[Object Handle]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
            <attrKeyMap attr="privName" key="[Privileges]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4688'">
          <switch>
            <case>
              <!-- Tue Dec 11 14:26:14 2018 172.30.52.30 AccelOps-WinLog-WMI [Category]="13312" [CategoryString]="Process Creation" [ComputerName]="example.com" [Data]="NULL" [EventCode]="4688" [EventIdentifier]="4688" [EventType]="4" [Logfile]="Security" [RecordNumber]="415545818" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20181211142542.879492-000" [TimeWritten]="20181211142542.879492-000" [Type]="Audit Success" [User]="(null)" [Message]="A new process has been created." [[Creator Subject]] [Security ID]="S-1-5-18" [Account Name]="SJCITPWDC01$" [Account Domain]="DOM1" [Logon ID]="0x3E7" [[Target Subject]] [Security ID]="S-1-5-21-4138606553-3123060173-1908782870-1347" [Account Name]="user1" [Account Domain]="DOM1" [Logon ID]="0x28899ACC8" [[Process Information]] [New Process ID]="0x1970" [New Process Name]="C:\Windows\System32\taskhost.exe" [Token Elevation Type]="TokenElevationTypeLimited (3)" [Creator Process ID]="0x2e0" [[Process Command Line]] -->
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patCreator_Subject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Subject>\]\]<_target:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <case>
              <!-- Fri Oct 30 18:19:58 2009 10.1.1.1 AccelOps-WinLog-WMI [Category]="13312" [CategoryString]="Process Creation" [ComputerName]="example.com" [Data]="NULL" [EventCode]="4688" [EventIdentifier]="4688" [EventType]="4" [Logfile]="Security" [RecordNumber]="184033590" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20100505222650.293514-000" [TimeWritten]="20100505222650.293514-000" [Type]="Audit Success" [User]="(null)" [[Subject]][Security ID]="S-1-5-18" [Account Name]="SF1DC03$" [Account Domain]="JHA" [Logon ID]="0x3e7" [[Process Information]][New Process ID]="0x1060" [New Process Name]="C:\Program Files (x86)\Symantec\Symantec Endpoint Protection\SescLU.exe" [Token Elevation Type]="TokenElevationTypeDefault (1)" [Creator Process ID]="0x320" -->
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
          </switch>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist _target">
            <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
              <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
              <attrKeyMap attr="targetUser" key="[Account Name]="/>
              <attrKeyMap attr="domain" key="[Account Domain]="/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
            <attrKeyMap attr="procName" key="[New Process Name]="/>
            <attrKeyMap attr="parentProcName" key="[Creator Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <!-- special regex processing for process command line -->
          <switch>
            <case>
              <collectFieldsByRegex src="$_process">
                <regex><![CDATA[\[<:__i18n_patProcess_Command_Line>\]="?<command:gPatMesgBodyMin>"?(?:\s+\[|\s*$)]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '4689'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '4696'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[Target Process\]\]<_target:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
            <attrKeyMap attr="_targetProcName" key="[Target Process Name]="/>
            <attrKeyMap attr="_targetUser" key="[Account Name]="/>
            <attrKeyMap attr="_targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '4697'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patService_Information>\]\]<_service:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_service">
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
            <attrKeyMap attr="serviceAccount" key="[Service Account]="/>
            <attrKeyMap attr="serviceFileName" key="[Service File Name]="/>
            <attrKeyMap attr="serviceStartType" key="[Service Start Type]="/>
            <attrKeyMap attr="serviceType" key="[Service Type]="/>
            <attrKeyMap attr="serviceAccount" key="Service Account:"/>
            <attrKeyMap attr="serviceFileName" key="Service File Name:"/>
            <attrKeyMap attr="serviceStartType" key="Service Start Type:"/>
            <attrKeyMap attr="serviceType" key="Service Type:"/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '6416'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
            <attrKeyMap attr="deviceType" key="[Class Name]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4717'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="winLogonType" key="[Logon Type]="/>
            <attrKeyMap attr="osObjAccessType" key="[Access Right]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4720'">
          <!-- user account created -->
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patNew_Account>\]\]<_acct:gPatMesgBody>\[\[<:__i18n_patAttributes>\]\]<_attrib:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
                <attrKeyMap attr="user" key="[Account Name]="/>
                <attrKeyMap attr="domain" key="[Account Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
              </collectAndSetAttrByKeyValuePair>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
                <attrKeyMap attr="targetUser" key="[Account Name]="/>
                <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
              </collectAndSetAttrByKeyValuePair>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_attrib">
                <attrKeyMap attr="oldTargetUser" key="[SAM Account Name]="/>
              </collectAndSetAttrByKeyValuePair>
            </case>
            <default/>
          </switch>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '4722, 4723, 4724, 4725'">
          <!-- 4725: A user account was disabled 4722: A user account was enabled 4723: Password changed 4724: Password reset -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_target:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
            <attrKeyMap attr="userAcctControl" key="[User Account Control]="/>
            <attrKeyMap attr="essId" key="[SID History]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4726'">
          <!-- user account deleted -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_acct:gPatMesgBody>\[<:__i18n_patAdditional_Information>\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">4</setEventAttribute>
        </when>

        <when test="$_id IN '4731, 4744, 4727, 4754, 4759, 4749'">
          <!-- A security-enabled/disabled local/global/universal group was created -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[(?:<:__i18n_patNew_Group>|<:__i18n_patGroup>)\]\]<_grp:gPatMesgBody>\[\[<:__i18n_patAttributes>\]\]<_attrib:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_grp">
            <attrKeyMap attr="targetUserGrp" key="[Group Name]="/>
            <attrKeyMap attr="targetDomain" key="[Group Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <when test="exist winLogonId">
            <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </collectAndSetAttrFromAnotherEvent>
          </when>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <!-- Subject, Target Account, Changed Attributes, Additional Info -->
        <when test="$_id = '4738'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_target:gPatMesgBody>\[\[<:__i18n_patChanged_Attributes>\]\]<_attrib:gPatMesgBody>\[<:__i18n_patAdditional_Information>\]<_addInfo:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <!-- Subject -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <!-- Target Account -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <!-- Changed Attributes -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_attrib">
            <attrKeyMap attr="allowedToDelegateTo" key="[AllowedToDelegateTo]="/>
            <attrKeyMap attr="userAcctControl" key="[User Account Control]="/>
            <attrKeyMap attr="essId" key="[SID History]="/>
          </collectAndSetAttrByKeyValuePair>
          <!-- several attributes user might want to filter on here for 4738 user account changed-->
          <when test="exist _attrib">
            <setEventAttribute attr="details">$_attrib</setEventAttribute>
          </when>
          <!-- Obtain source ip of the subject/actor from another event -->
          <when test="exist winLogonId">
            <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </collectAndSetAttrFromAnotherEvent>
          </when>

        </when>

        <when test="$_id IN '4735, 4737, 4755, 4745, 4750, 4760'">
          <!-- A security-enabled/disabled local/global/unversal group was modified -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patGroup>\]\]<_grp:gPatMesgBody>\[\[<:__i18n_patChanged_Attributes>\]\]<_attrib:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_grp">
            <attrKeyMap attr="targetUserGrp" key="[Group Name]="/>
            <attrKeyMap attr="targetDomain" key="[Group Domain]="/>
          </collectAndSetAttrByKeyValuePair>

          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4739'">
          <!-- Domain Policy was changed -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patDomain>\]\]<_dom:gPatMesgBody>\[\[<:__i18n_patChanged_Attributes>\]\]<_attrib:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_dom">
            <attrKeyMap attr="targetDomain" key="[Domain Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4740'">
          <!-- A user account was locked out -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patAccount_That_Was_Locked_Out>\]\]<_target:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
            <attrKeyMap attr="user" key="[Account Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_addl">
            <attrKeyMap attr="_srcIpAddr" key="[Caller Computer Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcIpAddr">
                <regex><![CDATA[<srcIpAddr:gPatIpAddr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default>
              <setEventAttribute attr="srcName">$_srcIpAddr</setEventAttribute>
            </default>
          </switch>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <setEventAttribute attr="eventSeverity">10</setEventAttribute>
        </when>

        <when test="$_id = '4741'">
          <!-- new computer account created -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patNew_Computer_Account>\]\]<_acct:gPatMesgBody>\[\[<:__i18n_patAttributes>\]\]<_attrib:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4742'">
          <!-- computer account changed -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patComputer_Account_That_Was_Changed>\]\]<_acct:gPatMesgBody>\[\[<:__i18n_patChanged_Attributes>\]\]<_attrib:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_attrib">
            <attrKeyMap attr="principal" key="[Service Principal Names]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4743'">
          <!-- computer account deleted -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Computer>\]\]<_acct:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '4746, 4751, 4761, 4728, 4732, 4756, 4785, 4787'">
          <!-- A member was added to a security-enabled global group -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patMember>\]\]<_member:gPatMesgBody>\[\[<:__i18n_patGroup>\]\]<_grp:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_member">
            <attrKeyMap attr="_targetUser" key="[Account Name]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_grp">
            <attrKeyMap attr="targetUserGrp" key="[Account Name]="/>
            <attrKeyMap attr="targetUserGrp" key="[Group Name]="/>
            <attrKeyMap attr="targetDomain" key="[Group Domain]="/>
            <attrKeyMap attr="groupID" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '4747, 4752, 4762, 4729, 4733, 4757, 4786, 4788'">
          <!-- A member was removed from a security-enabled global group -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patMember>\]\]<_member:gPatMesgBody>\[\[<:__i18n_patGroup>\]\]<_grp:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_member">
            <attrKeyMap attr="_targetUser" key="[Account Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_grp">
            <attrKeyMap attr="targetUserGrp" key="[Group Name]="/>
            <attrKeyMap attr="targetDomain" key="[Group Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4765'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_targetAcct:gPatMesgBody>\[\[<:__i18n_patSource_Account>\]\]<_sourceAcct:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_targetAcct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_sourceAcct">
            <attrKeyMap attr="srcUser" key="[Account Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_addl">
            <attrKeyMap attr="privName" key="[Privileges]="/>
            <attrKeyMap attr="essId" key="[SID List]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4766'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_targetAcct:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="securityId" key="[Security ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_targetAcct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
            <attrKeyMap attr="srcUser" key="[Source Account]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_addl">
            <attrKeyMap attr="privName" key="[Privileges]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4767'">
          <!--The workstation was unlocked-->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_targetAcct:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_targetAcct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4768'">
          <!-- domain auth success/failure -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patAccount_Information>\]\]<_account:gPatMesgBody>\[\[<:__i18n_patService_Information>\]\]<_service:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_network:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>\[\[<:__i18n_patCertificate_Information>\]\]<certInfo:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_account">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Supplied Realm Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_service">
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_addl">
            <attrKeyMap attr="winKerbFailCode" key="[Result Code]="/>
            <attrKeyMap attr="encryptAlgo" key="[Ticket Encryption Type]="/>
            <attrKeyMap attr="kerbTicketOption" key="[Ticket Options]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_network">
            <attrKeyMap attr="_srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Client Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$certInfo">
            <attrKeyMap attr="certThumbprint" key="[Certificate Thumbprint]="/>
          </collectAndSetAttrByKeyValuePair>
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcIpAddr">
                <regex><![CDATA[<srcIpAddr:gPatIpAddr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
          <choose>
            <when test="not_exist winKerbFailCode">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="$winKerbFailCode IN '-,0x0'">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <otherwise>
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </otherwise>
          </choose>

          <when test="exist user">
            <when test="matches($user, '\$$')">
              <setEventAttribute attr="computer">replaceStringByRegex($user, "\$$", "")</setEventAttribute>
              <when test="exist domain">
                <setEventAttribute attr="computer">combineMsgId($computer, ".", $domain)</setEventAttribute>
              </when>
              <setEventAttribute attr="computer">toUpper($computer)</setEventAttribute>
            </when>
          </when>
        </when>

        <when test="$_id = '4769'">
          <!-- ticket grant success/failure -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patAccount_Information>\]\]<_account:gPatMesgBody>\[\[<:__i18n_patService_Information>\]\]<_service:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_network:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_account">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_service">
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_addl">
            <attrKeyMap attr="winKerbFailCode" key="[Failure Code]="/>
            <attrKeyMap attr="encryptAlgo" key="[Ticket Encryption Type]="/>
            <attrKeyMap attr="kerbTicketOption" key="[Ticket Options]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_network">
            <attrKeyMap attr="_srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Client Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcIpAddr">
                <regex><![CDATA[<srcIpAddr:gPatIpAddr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
          <choose>
            <when test="not_exist winKerbFailCode">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="$winKerbFailCode IN '-, 0x0'">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <otherwise>
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </otherwise>
          </choose>

          <when test="exist _server">
            <when test="matches($_server, '\$$')">
              <setEventAttribute attr="computer">replaceStringByRegex($_server, "\$$", "")</setEventAttribute>
              <when test="exist domain">
                <setEventAttribute attr="computer">combineMsgId($computer, ".", $domain)</setEventAttribute>
              </when>
              <setEventAttribute attr="computer">toUpper($computer)</setEventAttribute>
            </when>
          </when>
        </when>

        <when test="$_id = '4770'">
          <!-- ticket grant success/failure -->
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patAccount_Information>\]\]<_account:gPatMesgBody>\[\[<:__i18n_patService_Information>\]\]<_service:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_network:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_account">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_service">
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_addl">
            <attrKeyMap attr="_ticketOpt" key="[Ticket Options]="/>
            <attrKeyMap attr="_ticketType" key="[Ticket Encryption Type]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_network">
            <attrKeyMap attr="_srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Client Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcIpAddr">
                <regex><![CDATA[<srcIpAddr:gPatIpAddr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>

        <when test="$_id = '4771'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patAccount_Information>\]\]<_account:gPatMesgBody>\[\[<:__i18n_patService_Information>\]\]<_service:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_network:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>\[\[<:__i18n_patCertificate_Information>\]\]<certInfo:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_account">
            <attrKeyMap attr="user" key="[Account Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_service">
            <attrKeyMap attr="winSrvcName" key="[Service Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_addl">
            <attrKeyMap attr="winKerbFailCode" key="[Failure Code]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_network">
            <attrKeyMap attr="_srcIpAddr" key="[Client Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Client Port]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectFieldsByRegex src="$_srcIpAddr">
            <regex><![CDATA[[^\d]*<srcIpAddr:gPatIpAddr>]]></regex>
          </collectFieldsByRegex>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        </when>

        <when test="$_id = '4776'">
          <!-- The domain controller attempted to validate the credentials for an account -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Logon Account]="/>
            <attrKeyMap attr="srcName" key="[Source Workstation]="/>
            <attrKeyMap attr="winLogonFailCode2" key="[Error Code]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          <choose>
            <when test="not_exist winLogonFailCode2">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            </when>
            <when test="$winLogonFailCode2 = '0x0'">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            </when>
            <otherwise>
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </otherwise>
          </choose>
        </when>

        <when test="$_id = '4781'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTarget_Account>\]\]<_target:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_target">
            <attrKeyMap attr="targetUser" key="[New Account Name]="/>
            <attrKeyMap attr="oldTargetUser" key="[Old Account Name]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4783'">
          <!-- basic application group created -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patGroup>\]\]<_acct:gPatMesgBody>\[\<:__i18n_patAttributes>\]\]<_attrib:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4784'">
          <!-- basic application group changed -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patGroup>\]\]<_acct:gPatMesgBody>\[\[<:__i18n_patAttributes>\]\]<_attrib:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_acct">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">4</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id IN '4789, 4763, 4748, 4753, 4734, 4758, 4730'">
          <!-- A security-enabled/disabled local/global/universal group was deleted -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[(?:<:__i18n_patDeleted_Group>|<:__i18n_patGroup>)\]\]<_grp:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]:?<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_grp">
            <attrKeyMap attr="targetUserGrp" key="[Group Name]="/>
            <attrKeyMap attr="targetDomain" key="[Group Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
            <when test="exist winLogonId">
              <when test="$winLogonId = $AnotherEvent.winLogonId">
                <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
              </when>
            </when>
          </collectAndSetAttrFromAnotherEvent>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">5</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure')">
              <setEventAttribute attr="eventSeverity">7</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '4798'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>\[\[<:__i18n_patUser>\]\]<_account:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_account">
            <attrKeyMap attr="targetUser" key="[Account Name]="/>
            <attrKeyMap attr="targetDomain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4799'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>\[\[<:__i18n_patGroup>\]\]<_grp:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_grp">
            <attrKeyMap attr="targetUserGrp" key="[Group Name]="/>
            <attrKeyMap attr="targetDomain" key="[Group Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id IN '4825'">
          <!--A user was denied the access to Remote Desktop-->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>\[\[<:__i18n_patAdditional_Information>\]\]:?<_addl:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[User Name]="/>
            <attrKeyMap attr="domain" key="[Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_addl">
            <attrKeyMap attr="srcIpAddr" key="[Client Address]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">6</setEventAttribute>
        </when>

        <when test="$_id IN '4898,4899'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="templateContent" key="[Template Content]="/>
            <attrKeyMap attr="newTemplateContent" key="[New Template Content]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id IN '4800,4801'">
          <!--The workstation was locked/unlocked-->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subj:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subj">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '4906'">
          <!-- This event generates every time CrashOnAuditFail audit flag value was modified -->
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="newValue" key="[New Value of CrashOnAuditFail]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4907'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_object:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_process:gPatMesgBody>\[\[<:__i18n_patAuditing_Settings>\]\]<:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_object">
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="osObjName" key="[Object Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_process">
            <attrKeyMap attr="procName" key="[Process Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '4931'">
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="destIpAddr" key="[Destination Address]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '4985'">
          <switch>
            <case>
              <!--2017-05-17T01:40:34Z W2012Agentyj-cn 10.30.2.166 AccelOps-WUA-WinLog-Security [monitorStatus]="Success" [Locale]="zh-CN" [MachineGuid]="11111111-1111-1111-1111-111111111111" [timeZone]="+0800" [eventName]="Security" [eventSource]="Microsoft-Windows-Security-Auditing" [eventId]="4985" [eventType]="Information" [domain]="" [computer]="W2012Agentyj-cn" [user]="" [userSID]="" [userSIDAcctType]="" [eventTime]="May 17 2017 01:40:33" [deviceTime]="May 17 2017 01:40:33" [msg]="事务的状态已更改。" [[使用者]][安全 ID]="S-1-5-18" [帐户名称]="W2012AGENTYJ-CN$" [帐户域]="WORKGROUP" [登录 ID]="0x3E7" [[事务信息]][RM 事务 ID]="{11111111-1111-1111-1111-111111111111}" [新状态]="52" [资源管理器]="{11111111-1111-1111-1111-111111111111}" [[进程信息]][进程 ID]="0x300" [进程名称]="C:\\Windows\\System32\\svchost.exe"
-->
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patUser>\]\]<_account:gPatMesgBody>\[\[<:__i18n_patTransaction_Information>\]\]<_transaction:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_account">
                <attrKeyMap attr="user" key="[Account Name]="/>
                <attrKeyMap attr="domain" key="[Account Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
              </collectAndSetAttrByKeyValuePair>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_processInfo">
                <attrKeyMap attr="procName" key="[Process Name]="/>
              </collectAndSetAttrByKeyValuePair>
            </case>
            <default>
              <!-- Fri Aug  1 19:08:40 2014 10.1.2.18 AccelOps-WinLog-WMI [Category]="12800" [CategoryString]="File System" [ComputerName]="SH-WIN08R2-VC50" [Data]="NULL" [EventCode]="4985" [EventIdentifier]="4985" [EventType]="4" [Logfile]="Security" [RecordNumber]="394296254" [SourceName]="Microsoft-Windows-Security-Auditing" [TimeGenerated]="20140801110558.281250-000" [TimeWritten]="20140801110558.281250-000" [Type]="Audit Success" [User]="(null)" [Message]="The state of a transaction has changed." [[Subject]]  [Security ID]="S-1-5-18"  [Account Name]="SH-WIN08R2-VC50$"  [Account Domain]="WORKGROUP"  [Logon ID]="0x3e7" [[Transaction Information]]  [RM Transaction ID]="{11111111-1111-1111-1111-111111111111}"  [New State]="48"  [Resource Manager]="{11111111-1111-1111-1111-111111111111}" [[Process Information]]  [Process ID]="0x32c"  [Process Name]="C:\Windows\System32\svchost.exe " -->
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patTransaction_Information>\]\]<:gPatMesgBody>\[\[<:__i18n_patProcess_Information>\]\]<_processInfo:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
                <attrKeyMap attr="user" key="[Account Name]="/>
                <attrKeyMap attr="domain" key="[Account Domain]="/>
                <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
              </collectAndSetAttrByKeyValuePair>
              <collectAndSetAttrByKeyValuePair sep=" [" src="$_processInfo">
                <attrKeyMap attr="procName" key="[Process Name]="/>
              </collectAndSetAttrByKeyValuePair>
            </default>
          </switch>
        </when>

        <when test="$_id = '5136'">
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patDirectory_Service>\]\]<_dir:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_obj:gPatMesgBody>\[\[<:__i18n_patAttribute>\]\]<_attr:gPatMesgBody>\[\[<:__i18n_patOperation>\]\]<_opt:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_dir">
            <attrKeyMap attr="serviceType" key="[Type]="/>
            <attrKeyMap attr="targetDomain" key="[Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_obj">
            <attrKeyMap attr="osObjType" key="[Class]="/>
            <attrKeyMap attr="osObjName" key="[DN]="/>
            <attrKeyMap attr="machineGUID" key="[GUID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_attr">
            <attrKeyMap attr="propName" key="[LDAP Display Name]="/>
            <attrKeyMap attr="propValue" key="[Value]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_opt">
            <attrKeyMap attr="opName" key="[Type]="/>
          </collectAndSetAttrByKeyValuePair>
          <choose>
            <when test="not_exist osObjType"/>
            <when test="$osObjType = 'user'">
              <!-- we will split the user from the DN later in the parser -->
              <setEventAttribute attr="_targetUser">$osObjName</setEventAttribute>
            </when>
          </choose>
        </when>

        <when test="$_id = '5137'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_obj:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_obj">
            <attrKeyMap attr="osObjType" key="[Class]="/>
            <attrKeyMap attr="osObjName" key="[DN]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '5139'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patDirectory_Service>\]\]<_dir:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_obj:gPatMesgBody>\[\[<:__i18n_patOperation>\]\]<_opt:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_obj">
            <attrKeyMap attr="classifier" key="[Class]="/>
            <attrKeyMap attr="userDN" key="[DN]="/>
            <attrKeyMap attr="userDN" key="[New DN]="/>
            <attrKeyMap attr="oldUserDN" key="[Old DN]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '5140'">
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="fileName" key="[Share Name]="/>
            <attrKeyMap attr="filePath" key="[Share Path]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '5141'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[<:__i18n_patDirectory_Service>\]\]<_dir:gPatMesgBody>\[\[<:__i18n_patObject>\]\]<_obj:gPatMesgBody>\[\[<:__i18n_patOperation>\]\]<_opt:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id IN '5142, 5143, 5144'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[Share Information\]\]<_shareInfo:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_shareInfo">
            <attrKeyMap attr="fileName" key="[Share Path]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '5145'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="osObjAccessType" key="[Accesses]="/>
            <attrKeyMap attr="fileAccess" key="[Access Mask]="/>
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
            <attrKeyMap attr="osObjType" key="[Object Type]="/>
            <attrKeyMap attr="targetName" key="[Relative Target Name]="/>
            <attrKeyMap attr="fileName" key="[Share Name]="/>
            <attrKeyMap attr="filePath" key="[Share Path]="/>
            <attrKeyMap attr="srcIpAddr" key="[Source Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
          </collectAndSetAttrByKeyValuePair>

          <when test="exist osObjType">
            <when test="$osObjType = 'File'">
              <setEventAttribute attr="destFileName">$targetName</setEventAttribute>
            </when>
          </when>
          <!-- Strip trailing comma from source port -->
          <when test="exist srcIpPort">
            <setEventAttribute attr="srcIpPort">replaceStrInStr($srcIpPort, ",", "")</setEventAttribute>
          </when>
        </when>

        <when test="$_id IN '5152,5153,5156,5154,5158'">
          <!--The Windows Filtering Platform has allowed a connection  -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*\[\[<:__i18n_patApplication_Information>\]\]<_appl:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_net:gPatMesgBody>\[\[<:__i18n_patFilter_Information>\]\]<_filter:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_appl">
            <attrKeyMap attr="appName" key="[Application Name]="/>
            <attrKeyMap attr="procId" key="[Process ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_filter">
            <attrKeyMap attr="filter" key="[Filter Origin]="/>
            <attrKeyMap attr="filterId" key="[Filter Run-Time ID]="/>
            <attrKeyMap attr="layerName" key="[Layer Name]="/>
            <attrKeyMap attr="permissionLevelID" key="[Layer Run-Time ID]="/>
            <attrKeyMap attr="destUser" key="[Remote User ID]="/>
            <attrKeyMap attr="destMachineId" key="[Remote Machine ID]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_net">
            <attrKeyMap attr="srcIpAddr" key="[Source Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
            <attrKeyMap attr="destIpAddr" key="[Destination Address]="/>
            <attrKeyMap attr="destIpPort" key="[Destination Port]="/>
            <attrKeyMap attr="_proto" key="[Protocol]="/>
            <attrKeyMap attr="ifIntefIndx" key="[Interface Index]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '5157'">
          <!--The Windows Filtering Platform has blocked a connection  -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patApplication_Information>\]\]<_appl:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_net:gPatMesgBody>\[\[<:__i18n_patFilter_Information>\]\]<_filter:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" " src="$_appl">
            <attrKeyMap attr="appName" key="[Application Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_filter">
            <attrKeyMap attr="filter" key="[Filter Origin]="/>
            <attrKeyMap attr="filterId" key="[Filter Run-Time ID]="/>
            <attrKeyMap attr="layerName" key="[Layer Name]="/>
            <attrKeyMap attr="permissionLevelID" key="[Layer Run-Time ID]="/>
            <attrKeyMap attr="destUser" key="[Remote User ID]="/>
            <attrKeyMap attr="destMachineId" key="[Remote Machine ID]="/>
            <attrKeyMap attr="profileName" key="[Current Profile]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_net">
            <attrKeyMap attr="srcIpAddr" key="[Source Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
            <attrKeyMap attr="destIpAddr" key="[Destination Address]="/>
            <attrKeyMap attr="destIpPort" key="[Destination Port]="/>
            <attrKeyMap attr="_proto" key="[Protocol]="/>
            <attrKeyMap attr="ifIntefIndx" key="[Interface Index]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>

        <when test="$_id = '5159'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patApplication_Information>\]\]<_appl:gPatMesgBody>\[\[<:__i18n_patNetwork_Information>\]\]<_net:gPatMesgBody>\[\[<:__i18n_patFilter_Information>\]\]<_filter:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_appl">
            <attrKeyMap attr="appName" key="[Application Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_filter">
            <attrKeyMap attr="layerName" key="[Layer Name]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_net">
            <attrKeyMap attr="srcIpAddr" key="[Source Address]="/>
            <attrKeyMap attr="srcIpPort" key="[Source Port]="/>
            <attrKeyMap attr="_proto" key="[Protocol]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>

        <when test="$_id = '5168'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patSubject>\]\]<_subject:gPatMesgBody>\[\[SPN\]\]<:gPatMesgBody>\[\[Server Information\]\]]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_subject">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
            <attrKeyMap attr="winLogonId" key="[Logon ID]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id IN '6272,6278'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patUser>\]\]<_user:gPatMesgBody>\[\[<:__i18n_patClient_Machine>\]\]<_client:gPatMesgBody>\[\[<:__i18n_patNAS>\]\]<_nas:gPatMesgBody>\[\[<:__i18n_patRADIUS_Client>\]\]<_radius:gPatMesgBody>\[\[<:__i18n_patAuthentication_Details>\]\]<_auth:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_user">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '6273'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[\[\[<:__i18n_patUser>\]\]<_user:gPatMesgBody>\[\[<:__i18n_patClient_Machine>\]\]<_client:gPatMesgBody>\[\[<:__i18n_patNAS>\]\]<_nas:gPatMesgBody>\[\[<:__i18n_patRADIUS_Client>\]\]<_radius:gPatMesgBody>\[\[<:__i18n_patAuthentication_Details>\]\]<_auth:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_user">
            <attrKeyMap attr="user" key="[Account Name]="/>
            <attrKeyMap attr="domain" key="[Account Domain]="/>
          </collectAndSetAttrByKeyValuePair>
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="errorNoInt" key="[Reason Code]="/>
            <attrKeyMap attr="errReason" key="[Reason]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '7035'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[<:patWordTab>\t+<:patWordTab>\t+The <procName:gPatMesgBody> service<:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
        </when>

        <when test="$_id = '7036'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[<:patWordTab>\t+<:patWordTab>\t+The <procName:gPatMesgBody> service entered the <_state:gPatStr> state<:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <setEventAttribute attr="appName">$procName</setEventAttribute>
          <setEventAttribute attr="serviceName">$procName</setEventAttribute>
          <choose>
            <when test="$_state = 'running'">
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-Start")</setEventAttribute>
            </when>
            <otherwise>
              <setEventAttribute attr="eventType">combineMsgId($eventType, "-Stop")</setEventAttribute>
            </otherwise>
          </choose>
        </when>

        <when test="$_id = '17137'">
          <!-- Starting up database 'mssql' -->
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[Starting up database '<dbName:gPatStr>']]></regex>
          </collectFieldsByRegex>
        </when>

        <when test="$_id IN '18453,18454'">
          <!-- MS-SQL successful login (non-trusted and trusted) -->
          <when test="$eventSource = 'MSSQLSERVER'">
            <collectFieldsByRegex src="$_body">
              <regex><![CDATA[Login\s+succeeded\s+for\s+user\s+'<user:patStrQuote>'\.\s+Connection:\s*<_connType:gPatStr>\.\s+\[CLIENT:\s*<_srcId:patStrRightSquareBracket>\]]]></regex>
            </collectFieldsByRegex>
          </when>
          <!-- set src ip or name -->
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[local machine]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
            </case>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
              </collectFieldsByRegex>
            </case>
          </switch>
        </when>

        <when test="$_id = '18456'">
          <!-- MS-SQL failed login -->
          <when test="$eventSource = 'MSSQLSERVER'">
            <collectFieldsByRegex src="$_body">
              <regex><![CDATA[Login\s+failed\s+for\s+user\s+'<user:patStrQuote>'\..*\[CLIENT:\s*<_srcId:patStrRightSquareBracket>\]]]></regex>
            </collectFieldsByRegex>
            <switch>
              <case>
                <collectFieldsByRegex src="$_srcId">
                  <regex><![CDATA[local machine]]></regex>
                </collectFieldsByRegex>
                <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
              </case>
              <case>
                <collectFieldsByRegex src="$_srcId">
                  <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
                </collectFieldsByRegex>
              </case>
            </switch>
          </when>
        </when>
      </when>

      <when test="$_logType = 'System'">
        <when test="$_id IN '20250, 20255, 20271, 20272, 20274, 20275'">
          <when test="$eventSource = 'RemoteAccess'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_body">
                  <regex><![CDATA[\[(?:CoID|CoId)=[^\]]*\]=<msg:gPatMesgBody>]]></regex>
                </collectFieldsByRegex>
              </case>
              <case>
                <collectFieldsByRegex src="$_body">
                  <regex><![CDATA[(?:CoID|CoId)=\{[^\}]*\}:\s*<msg:gPatMesgBody>]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>

            <when test="exist msg">
              <setEventAttribute attr="msg">replaceStringByRegex($msg, "\s*\"\s*$|\s*\"\s*", "")</setEventAttribute>
              <switch>
                <case>
                  <collectFieldsByRegex src="$msg">
                    <regex><![CDATA[The user <user:gPatStr> has connected and has been successfully authenticated on port <appPort:patStrDot>\.]]></regex>
                  </collectFieldsByRegex>
                </case>
                <case>
                  <collectFieldsByRegex src="$msg">
                    <regex><![CDATA[The following error occurred in the Point to Point Protocol module on port: <appPort:gPatStrComma>,\s*UserName:\s*<user:gPatStr>]]></regex>
                  </collectFieldsByRegex>
                </case>
                <case>
                  <collectFieldsByRegex src="$msg">
                    <regex><![CDATA[The user <user:gPatStr> connected from <srcIpAddr:gPatIpAddr> but failed an authentication attempt due to the following\s+reason:\s*<reason:patStrDot>\.]]></regex>
                  </collectFieldsByRegex>
                </case>
                <case>
                  <collectFieldsByRegex src="$msg">
                    <regex><![CDATA[The user <user:gPatStr> connected on port <appPort:gPatStr> on \S+ at \S+ AM and disconnected on \S+ at \S+ AM.\s*The user was active for <_min:gPatInt> minutes <_sec:gPatInt> seconds\.\s*<sentBytes:gPatInt> bytes were sent and <recvBytes:gPatInt> bytes were received. The reason for <reason:patStrDot>\.]]></regex>
                  </collectFieldsByRegex>
                  <setEventAttribute attr="_sec1">scale($_min, 60)</setEventAttribute>
                  <setEventAttribute attr="_sec">add($_sec1, $_sec)</setEventAttribute>
                  <setEventAttribute attr="durationMSec">scale($_sec, 1000)</setEventAttribute>
                </case>
                <case>
                  <collectFieldsByRegex src="$msg">
                    <regex><![CDATA[The user <user:gPatStr> connected on port <appPort:gPatStr> has been assigned address <srcIpAddr:gPatIpAddr>]]></regex>
                  </collectFieldsByRegex>
                </case>
                <case>
                  <collectFieldsByRegex src="$msg">
                    <regex><![CDATA[The user with ip address <srcIpAddr:gPatIpAddr> has disconnected]]></regex>
                  </collectFieldsByRegex>
                </case>
                <default/>
              </switch>
            </when>
          </when>
        </when>

        <when test="$_id = '98'">
          <when test="$eventSource = 'Microsoft-Windows-Ntfs'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Volume <diskName:patToRightBracket> <_desc:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>

            <choose>
              <when test="matches($_desc, 'needs to be taken offline to perform a Full Chkdsk')">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Chkdsk")</setEventAttribute>
              </when>

              <when test="matches($_desc, '^is healthy\.')">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Disk-Healthy")</setEventAttribute>
              </when>
            </choose>
          </when>
        </when>
        <!--Process started or stopped  -->
        <when test="$_id IN '1001, 1003'">
          <collectAndSetAttrByRegex src="$_body">
            <regex><![CDATA[The <procName:gPatMesgBody> has]]></regex>
          </collectAndSetAttrByRegex>
          <setEventAttribute attr="hostIpAddr">$reptDevIpAddr</setEventAttribute>
        </when>

        <when test="$_id = '1074'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[<_body:gPatMesgBody>"]]></regex>
          </collectFieldsByRegex>

          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User]="/>
            <attrKeyMap attr="errReason" key="[Reason Code]="/>
            <attrKeyMap attr="shutdownReason" key="[Shutdown Type]="/>
            <attrKeyMap attr="comment" key="[Comment]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '2020'">
          <collectAndSetAttrByRegex src="$_body">
            <regex><![CDATA[<:patWordTab>\t+<:patWordTab>\t+<procName:gPatMesgBody> has terminated<:gPatMesgBody>]]></regex>
          </collectAndSetAttrByRegex>
          <setEventAttribute attr="hostIpAddr">$reptDevIpAddr</setEventAttribute>
        </when>

        <when test="$_id = '7045'">
          <collectAndSetAttrByKeyValuePair sep="\n" src="$msg">
            <attrKeyMap attr="serviceAccount" key="Service Account:"/>
            <attrKeyMap attr="serviceFileName" key="Service File Name:"/>
            <attrKeyMap attr="serviceName" key="Service Name:"/>
            <attrKeyMap attr="serviceStartType" key="Service Start Type:"/>
            <attrKeyMap attr="serviceType" key="Service Type:"/>
          </collectAndSetAttrByKeyValuePair>
        </when>

        <when test="$_id = '10028'">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[DCOM was unable to communicate with the computer <_src:gPatStr> using any of the configured protocols]]></regex>
              </collectFieldsByRegex>

              <switch>
                <case>
                  <collectFieldsByRegex src="$_src">
                    <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
                  </collectFieldsByRegex>
                </case>
                <default>
                  <setEventAttribute attr="srcName">$_src</setEventAttribute>
                </default>
              </switch>
            </case>
            <default/>
          </switch>
        </when>
      </when>

      <when test="$_logType = 'Application'">
        <when test="$_id = '208'">
          <switch>
            <case>
              <collectFieldsByRegex src="$_body">
                <regex><![CDATA[\[SQL Server Scheduled Job 'Microsoft_ApplicationServer_Monitoring_<jobName:patStrQuote>' \([^)]+\) - Status\]="<_status:patStrQuote>]]></regex>
              </collectFieldsByRegex>

              <collectFieldsByRegex src="$_status">
                <regex><![CDATA[<_statusCode:gPatWord> - Invoked on: .* Message: <errorString:patStrDot>\. .* invoked by <caller:patStrDot>\. The last step to run was <lastStep:patStrDot>\.]]></regex>
              </collectFieldsByRegex>

              <choose>
                <when test="$_statusCode = 'Failed'">
                  <setEventAttribute attr="jobStatus">0</setEventAttribute>
                </when>

                <when test="$_statusCode = 'Success'">
                  <setEventAttribute attr="jobStatus">1</setEventAttribute>
                </when>
              </choose>
            </case>
            <default/>
          </switch>
        </when>

        <!-- MS-SQL successful login (non-trusted and trusted) -->
        <when test="$_id IN '18453,18454'">
          <!-- Thu Feb 6 09:56:09 2014 10.60.60.7 AccelOps-WinLog-WMI [Category]="4" [CategoryString]="Logon" [ComputerName]="host" [Data]="(21,72,0,0,10,0,0,0,10,0,0,0,72,0,69,0,80,0,72,0,69,0,83,0,84,0,85,0,83,0,0,0,7,0,0,0,109,0,97,0,115,0,116,0,101,0,114,0,0,0)" [EventCode]="18453" [EventIdentifier]="1073760277" [EventType]="4" [Logfile]="Application" [RecordNumber]="4878127" [SourceName]="MSSQLSERVER" [TimeGenerated]="20140206095525.000000+120" [TimeWritten]="20140206095525.000000+120" [Type]="Audit Success" [User]="host\user" [Login succeeded for user 'host\user'.  Connection]="trusted. [CLIENT: 192.168.132.40]" -->
          <switch>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[Login\s+succeeded\s+for\s+user\s+'<user:patStrQuote>'\.\s+Connection:\s*<_connType:gPatStr>\.\s+\[CLIENT:\s*<_srcId:patStrRightSquareBracket>\]]]></regex>
              </collectAndSetAttrByRegex>
            </case>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[\[Login succeeded for user '<user:patStrQuote>'\.\s+Connection\]=".*\s\[CLIENT:\s+<_srcId:patStrRightSquareBracket>\]]]></regex>
              </collectAndSetAttrByRegex>
            </case>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[Login succeeded for user '<user:patStrQuote>'\..*\[CLIENT\]="\s*<_srcId:gPatStrRightSB>\]]]></regex>
              </collectAndSetAttrByRegex>
            </case>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA['<user:patStrQuote>'\.\s+.+?\.\s+\[.+?[ :="]+<_srcId:patStrRightSquareBracket>\]]]></regex>
              </collectAndSetAttrByRegex>
            </case>
          </switch>

          <switch>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[local machine]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
              <setEventAttribute attr="srcName">$_srcId</setEventAttribute>
            </case>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>

        <!-- MS-SQL failed login -->
        <when test="$_id = '18456'">
          <switch>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[.*Login\s+failed\s+for\s+user\s+'<user:patStrQuote>'.\s+\[CLIENT\]="<_srcId:patStrRightSquareBracket>\]<:gPatMesgBody>]]></regex>
              </collectAndSetAttrByRegex>
            </case>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[.*用户\s+'<user:patStrQuote>'\s+登录失败。\s+\[客户端\]="<_srcId:patStrRightSquareBracket>\]<:gPatMesgBody>]]></regex>
                <!--用户 'sa' 登录失败。 [客户端]="1.1.1.1-->
              </collectAndSetAttrByRegex>
            </case>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[.*Login\s+failed\s+for\s+user\s+'<user:patStrQuote>'.\s+Reason\]=.*\[CLIENT:\s+<_srcId:patStrRightSquareBracket>\]<:gPatMesgBody>]]></regex>
              </collectAndSetAttrByRegex>
            </case>
            <case>
              <collectAndSetAttrByRegex src="$_body">
                <regex><![CDATA[.*用户\s+'<user:patStrQuote>'\s+登录失败。\s+原因\]=.*\[客户端:\s+<_srcId:patStrRightSquareBracket>\]<:gPatMesgBody>]]></regex>
              </collectAndSetAttrByRegex>
            </case>
          </switch>
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[local machine]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
            </case>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
              </collectFieldsByRegex>
            </case>
          </switch>
        </when>

        <!-- Starting up database 'mssql' -->
        <when test="$_id = '17137'">
          <collectAndSetAttrByRegex src="$_body">
            <regex><![CDATA[.*Starting up database '<dbName:gPatStr>']]></regex>
          </collectAndSetAttrByRegex>
        </when>

        <!-- SQL Server (database) terminating because of a system shutdown -->
        <when test="$_id = '17138'">
          <collectAndSetAttrByRegex src="$_body">
            <regex><![CDATA[.*SQL Server terminating because of a system shutdown.*]]></regex>
          </collectAndSetAttrByRegex>
        </when>

        <!-- Zenith ARCA back up -->
        <when test="$_id IN '1120, 1121'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="backupStatus" key="[Backup status]="/>
            <attrKeyMap attr="imageFile" key="[Image file]="/>
            <attrKeyMap attr="code" key="[Code]="/>
            <attrKeyMap attr="startTime" key="[Start time]="/>
          </collectAndSetAttrByKeyValuePair>
          <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          <when test="$_id = '1121'">
            <setEventAttribute attr="eventSeverity">9</setEventAttribute>
          </when>
        </when>

        <when test="$_id = '18470'">
          <collectAndSetAttrByKeyValuePair sep=" [" src="$_body">
            <attrKeyMap attr="user" key="[User]="/>
          </collectAndSetAttrByKeyValuePair>
        </when>
      </when>

      <when test="$_logType = 'Microsoft-Windows-Sysmon/Operational'">
        <collectFieldsByRegex src="$msg">
          <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>

        <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$_body">
          <attrKeyMap attr="callTrace" key="CallTrace"/>
          <attrKeyMap attr="command" key="CommandLine"/>
          <attrKeyMap attr="configValue" key="Configuration"/>
          <attrKeyMap attr="_hash" key="ConfigurationFileHash"/>
          <attrKeyMap attr="destFilePath" key="Destination"/>
          <attrKeyMap attr="destIpAddr" key="DestinationIp"/>
          <attrKeyMap attr="destIpPort" key="DestinationPort"/>
          <attrKeyMap attr="description" key="Description"/>
          <attrKeyMap attr="destName" key="DestinationHostname"/>
          <attrKeyMap attr="details" key="Details"/>
          <attrKeyMap attr="deviceIdentification" key="Device"/>
          <attrKeyMap attr="dirName" key="CurrentDirectory"/>
          <attrKeyMap attr="namespace" key="EventNamespace"/>
          <attrKeyMap attr="fileVersion" key="FileVersion"/>
          <attrKeyMap attr="filter" key="Filter"/>
          <attrKeyMap attr="msgId" key="ID"/>
          <attrKeyMap attr="initiated" key="Initiated"/>
          <attrKeyMap attr="integrityLevel" key="IntegrityLevel"/>
          <attrKeyMap attr="machineGUID" key="LogonGuid"/>
          <attrKeyMap attr="paraName" key="Name"/>
          <attrKeyMap attr="threadId" key="NewThreadId"/>
          <attrKeyMap attr="opName" key="Operation"/>
          <attrKeyMap attr="srcFileName" key="OriginalFileName"/>
          <attrKeyMap attr="parentProcGUID" key="ParentProcessGuid"/>
          <attrKeyMap attr="pipeName" key="PipeName"/>
          <attrKeyMap attr="procGUID" key="ProcessGuid"/>
          <attrKeyMap attr="queryId" key="Query"/>
          <attrKeyMap attr="dnsQueryType" key="QueryStatus"/>
          <attrKeyMap attr="signatureStatus" key="SignatureStatus"/>
          <attrKeyMap attr="imageSigned" key="Signed"/>
          <attrKeyMap attr="srcProcGUID" key="SourceProcessGuid"/>
          <attrKeyMap attr="srcThreadId" key="SourceThreadId"/>
          <attrKeyMap attr="startAddress" key="StartAddress"/>
          <attrKeyMap attr="startFunction" key="StartFunction"/>
          <attrKeyMap attr="startModule" key="StartModule"/>
          <attrKeyMap attr="fileName" key="TargetFilename"/>
          <attrKeyMap attr="targetProcGUID" key="TargetProcessGuid"/>
          <attrKeyMap attr="sessionId" key="TerminalSessionId"/>
          <attrKeyMap attr="_hash" key="Hash"/>
          <attrKeyMap attr="_hash" key="Hashes"/>
          <attrKeyMap attr="_hash" key="Hashes"/>
          <attrKeyMap attr="_proto" key="Protocol"/>
          <attrKeyMap attr="srcProto" key="Protocol"/>
          <attrKeyMap attr="loadedProcName" key="ImageLoaded"/>
          <attrKeyMap attr="monitorState" key="State"/>
          <attrKeyMap attr="newRegValue" key="NewName"/>
          <attrKeyMap attr="newObjValue" key="NewName"/>
          <attrKeyMap attr="osObjAction" key="EventType"/>
          <attrKeyMap attr="parentCommand" key="ParentCommandLine"/>
          <attrKeyMap attr="parentProcId" key="ParentProcessId"/>
          <attrKeyMap attr="parentProcName" key="ParentImage"/>
          <attrKeyMap attr="procId" key="ProcessId"/>
          <attrKeyMap attr="destName" key="QueryName"/>
          <attrKeyMap attr="queryId" key="QueryName"/>
          <attrKeyMap attr="destIpAddrList" key="QueryResults"/>
          <attrKeyMap attr="_mitre" key="RuleName"/>
          <attrKeyMap attr="_v6" key="SourceIsIpv6"/>
          <attrKeyMap attr="procId" key="SourceProcessId"/>
          <attrKeyMap attr="procName" key="Image"/>
          <attrKeyMap attr="procName" key="SourceImage"/>
          <attrKeyMap attr="regKeyPath" key="TargetObject"/>
          <attrKeyMap attr="schemaName" key="SchemaVersion"/>
          <attrKeyMap attr="signatureName" key="Signature"/>
          <attrKeyMap attr="srcIpAddr" key="SourceIp"/>
          <attrKeyMap attr="srcIpPort" key="SourcePort"/>
          <attrKeyMap attr="srcName" key="SourceHostname"/>
          <attrKeyMap attr="user" key="User"/>
          <attrKeyMap attr="targetProcId" key="TargetProcessId"/>
          <attrKeyMap attr="targetProcName" key="TargetImage"/>
          <attrKeyMap attr="user" key="User"/>
          <attrKeyMap attr="version" key="Version"/>
          <attrKeyMap attr="winLogonId" key="LogonId"/>
          <attrKeyMap attr="product" key="Product"/>
          <attrKeyMap attr="company" key="Company"/>
          <attrKeyMap attr="integrityLevel" key="IntegrityLevel"/>
          <attrKeyMap attr="vpnTunnelName" key="PipeName"/>
          <attrKeyMap attr="module" key="StartModule"/>
          <attrKeyMap attr="funName" key="StartFunction"/>
          <attrKeyMap attr="destFilePath" key="Destination"/>
          <attrKeyMap attr="accessKeyId" key="GrantedAccess"/>
          <attrKeyMap attr="procPath" key="CallTrace"/>
          <attrKeyMap attr="authResult" key="Signed"/>
          <attrKeyMap attr="isIpv6" key="DestinationIsIpv6"/>
        </collectFieldsByKeyValuePair>

        <when test="exist _hash">
          <collectFieldsByRegex src="$_hash">
            <regex><![CDATA[^<hashAlgo:gPatWord>=<hashCode:gPatWord>]]></regex>
          </collectFieldsByRegex>

          <collectFieldsByKeyValuePair sep="," kvsep="=" src="$_hash">
            <attrKeyMap attr="hashMD5" key="MD5"/>
            <attrKeyMap attr="hashSHA256" key="SHA256"/>
            <attrKeyMap attr="hashSHA1" key="SHA1"/>
            <attrKeyMap attr="hashIMP" key="IMPHASH"/>
          </collectFieldsByKeyValuePair>
        </when>

        <when test="exist command">
          <switch>
            <case>
              <collectFieldsByRegex src="$msg">
                <regex><![CDATA[\nCommandLine:\s*<command:gPatMesgBodyMin>\s*(?:\n|$)]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
          <switch>
            <case>
              <collectFieldsByRegex src="$command">
                <regex><![CDATA[^"<command:gPatStrDQ>"$]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>

        <when test="exist _mitre">
          <collectFieldsByKeyValuePair sep="," kvsep="=" src="$_mitre">
            <attrKeyMap attr="attackTactic" key="Mitre_Tactic"/>
            <attrKeyMap attr="attackTechnique" key="Mitre_Technique"/>
            <attrKeyMap attr="attackTechniqueId" key="Mitre_Technique_Id"/>
            <attrKeyMap attr="mitreURL" key="Mitre_URL"/>
          </collectFieldsByKeyValuePair>
          <setEventAttribute attr="mitrePlatform">Windows</setEventAttribute>
        </when>

        <when test="exist destIpAddrList">
          <setEventAttribute attr="destIpAddr">replaceStringByRegex($destIpAddrList, ";.*", "")</setEventAttribute>
        </when>

        <choose>
          <when test="$_detail = 'Process accessed'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-ProcessAccess")</setEventAttribute>
          </when>
          <when test="$_detail = 'File stream created'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileCreateStreamHash")</setEventAttribute>
          </when>
          <when test="$_detail = 'Process Create'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Create-Process")</setEventAttribute>
          </when>

          <when test="$_detail = 'Registry value set'">
            <when test="exist details">
              <setEventAttribute attr="newRegValue">$details</setEventAttribute>
            </when>

            <when test="exist regKeyPath">
              <switch>
                <case>
                  <collectFieldsByRegex src="$regKeyPath">
                    <regex><![CDATA[^<:gPatMesgBody>[\\]<regValueName:gPatMesgBodyMin>$]]></regex>
                  </collectFieldsByRegex>
                </case>
                <default>
                  <setEventAttribute attr="regValueName">$regKeyPath</setEventAttribute>
                </default>
              </switch>
            </when>

            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Registry-", $osObjAction)</setEventAttribute>
          </when>

          <when test="$_detail = 'CreateRemoteThread detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-CreateRemoteThread")</setEventAttribute>
          </when>

          <when test="$_detail = 'Registry object added or deleted'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Registry-", $osObjAction)</setEventAttribute>
          </when>

          <when test="$_detail = 'Network connection detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Network-Connect")</setEventAttribute>
            <choose>
              <when test="$_v6 = 'true'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-IPv6")</setEventAttribute>
              </when>
              <otherwise>
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-IPv4")</setEventAttribute>
              </otherwise>
            </choose>
          </when>

          <when test="$_detail = 'File creation time changed'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileCreation-Time-Changed")</setEventAttribute>
          </when>

          <when test="$_detail = 'Sysmon service state changed'">
            <choose>
              <when test="exist monitorState">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Service-State-Change-", $monitorState)</setEventAttribute>
              </when>
              <otherwise>
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Service-State-Change")</setEventAttribute>
              </otherwise>
            </choose>
          </when>

          <when test="$_detail = 'Process terminated'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Process-Terminated")</setEventAttribute>
          </when>

          <when test="$_detail = 'Driver loaded'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Driver-Loaded")</setEventAttribute>
          </when>

          <when test="$_detail = 'Image loaded'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Image-Loaded")</setEventAttribute>
          </when>

          <when test="$_detail = 'RawAccessRead detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-RawAccessRead")</setEventAttribute>
          </when>

          <when test="$_detail = 'File created'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileCreate")</setEventAttribute>
          </when>

          <when test="$_detail = 'Registry object renamed'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Registry-", $osObjAction)</setEventAttribute>
          </when>

          <when test="$_detail = 'File stream created'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileCreateStreamHash")</setEventAttribute>
          </when>

          <when test="$_detail = 'Process access'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-ProcessAccess")</setEventAttribute>
          </when>

          <when test="$_detail = 'Dns query'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-DNS-Query")</setEventAttribute>

            <when test="not_exist srcIpAddr">
              <when test="exist reptDevIpAddr">
                <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
              </when>
            </when>
          </when>

          <when test="$_detail = 'Sysmon config state changed'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Config-State-Changed")</setEventAttribute>
          </when>

          <when test="$_detail = 'WmiEventFilter activity detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-WMI-Event-Filter-Activity")</setEventAttribute>
          </when>

          <when test="$_detail = 'WmiEventConsumer activity detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-WMI-Event-Consumer-Activity")</setEventAttribute>
          </when>

          <when test="$_detail = 'WmiEventConsumerToFilter activity detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-WMI-Event-ConsumerToFilter-Activity")</setEventAttribute>
          </when>

          <when test="$_detail = 'Clipboard changed'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Clipboard-Changed")</setEventAttribute>
          </when>

          <when test="$_detail = 'Process Tampering'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Process-Tampering")</setEventAttribute>
          </when>

          <when test="$_detail = 'File Delete logged'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-File-Delete-logged")</setEventAttribute>
          </when>

          <when test="$_detail = 'File Block Executable'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileBlockExecutable")</setEventAttribute>
          </when>

          <when test="$_detail = 'File Block Shredding'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileBlockShredding")</setEventAttribute>
          </when>

          <when test="$_detail = 'File Executable Detected'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-FileExecutableDetected")</setEventAttribute>
          </when>

          <when test="$_detail = 'Error report'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Error-Report")</setEventAttribute>
          </when>

          <otherwise>
            <setEventAttribute attr="_et">replaceStringByRegex($_detail, "\s+", "-")</setEventAttribute>
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-", $_et)</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_logType = 'Windows PowerShell'">
        <choose>
          <when test="$_id IN '400, 403, 600'">
            <switch>
              <case>
                <collectFieldsByRegex src="$msg">
                  <regex><![CDATA[^<_detail:gPatMesgBodyMin>\.\s+.*?:\s+<_body:gPatMesgBody>]]></regex>
                </collectFieldsByRegex>

                <setEventAttribute attr="_body">replaceStringByRegex($_body, "\t", "")</setEventAttribute>

                <collectFieldsByKeyValuePair kvsep="=" sep="\n" src="$_body">
                  <attrKeyMap attr="command" key="CommandLine"/>
                  <attrKeyMap attr="commandName" key="CommandName"/>
                  <attrKeyMap attr="commandPath" key="CommandPath"/>
                  <attrKeyMap attr="commandType" key="CommandType"/>
                  <attrKeyMap attr="engineVersion" key="EngineVersion"/>
                  <attrKeyMap attr="appName" key="HostApplication"/>
                  <attrKeyMap attr="hostId" key="HostId"/>
                  <attrKeyMap attr="hostName" key="HostName"/>
                  <attrKeyMap attr="version" key="HostVersion"/>
                  <attrKeyMap attr="engineState" key="NewEngineState"/>
                  <attrKeyMap attr="newProviderState" key="NewProviderState"/>
                  <attrKeyMap attr="pipelineId" key="PipelineId"/>
                  <attrKeyMap attr="prevEngineState" key="PreviousEngineState"/>
                  <attrKeyMap attr="providerName" key="ProviderName"/>
                  <attrKeyMap attr="runSpaceId" key="RunspaceId"/>
                  <attrKeyMap attr="script" key="ScriptName"/>
                  <attrKeyMap attr="seqNum" key="SequenceNumber"/>
                </collectFieldsByKeyValuePair>
              </case>
              <default/>
            </switch>
          </when>

          <when test="$_id = '800'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Context Information:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>

            <setEventAttribute attr="_body">replaceStringByRegex($_body, "\t", "")</setEventAttribute>

            <collectFieldsByKeyValuePair kvsep="=" sep="\n" src="$_body">
              <attrKeyMap attr="command" key="CommandLine"/>
              <attrKeyMap attr="detailSeq" key="DetailSequence"/>
              <attrKeyMap attr="detailTotal" key="DetailTotal"/>
              <attrKeyMap attr="engineVersion" key="EngineVersion"/>
              <attrKeyMap attr="appName" key="HostApplication"/>
              <attrKeyMap attr="hostId" key="HostId"/>
              <attrKeyMap attr="hostName" key="HostName"/>
              <attrKeyMap attr="version" key="HostVersion"/>
              <attrKeyMap attr="pipelineId" key="PipelineId"/>
              <attrKeyMap attr="runSpaceId" key="RunspaceId"/>
              <attrKeyMap attr="seqNum" key="SequenceNumber"/>
              <attrKeyMap attr="user" key="UserId"/>
            </collectFieldsByKeyValuePair>
          </when>
        </choose>
      </when>

      <when test="$_logType = 'Microsoft-Windows-DNSServer/Audit'">
        <switch>
          <case>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^The zone <:gPatMesgBodyMin> was <_action:patDNSAction>\b]]></regex>
            </collectFieldsByRegex>
            <choose>
              <when test="$_action = 'created'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Zone-Created")</setEventAttribute>
              </when>
              <when test="$_action = 'deleted'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Zone-Delete")</setEventAttribute>
              </when>
              <when test="$_action = 'updated'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Zone-Updated")</setEventAttribute>
              </when>
              <otherwise/>
            </choose>
          </case>

          <case>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^A resource record ]]></regex>
            </collectFieldsByRegex>
            <choose>
              <when test="$_id = '515'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Record-Create")</setEventAttribute>
              </when>
              <when test="$_id = '516'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Record-Delete")</setEventAttribute>
              </when>
              <when test="$_id = '517'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-RRSET-Delete")</setEventAttribute>
              </when>
              <when test="$_id = '518'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Node-Delete")</setEventAttribute>
              </when>
              <when test="$_id = '519'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Record-Create-Dynamic-Update")</setEventAttribute>
              </when>
              <when test="$_id = '520'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Record-Delete-Dynamic-Update")</setEventAttribute>
              </when>
              <when test="$_id = '521'">
                <setEventAttribute attr="eventType">combineMsgId($eventType, "-Record-Scavenge")</setEventAttribute>
              </when>
            </choose>
          </case>

          <default/>
        </switch>
      </when>

      <when test="$_logType = 'Microsoft-IIS-Logging/Logs'">
        <when test="exist msg">
          <collectAndSetAttrByKeyValuePair sep=" " src="$msg">
            <attrKeyMap attr="srcIpAddr" key="c-ip "/>
            <attrKeyMap attr="cookie" key="cs(Cookie) "/>
            <attrKeyMap attr="httpReferrer" key="cs(Referer) "/>
            <attrKeyMap attr="httpUserAgent" key="cs(User-Agent) "/>
            <attrKeyMap attr="sentBytes64" key="cs-bytes "/>
            <attrKeyMap attr="httpMethod" key="cs-method "/>
            <attrKeyMap attr="uriQuery" key="cs-uri-query "/>
            <attrKeyMap attr="uriStem" key="cs-uri-stem "/>
            <attrKeyMap attr="user" key="cs-username "/>
            <attrKeyMap attr="httpVersion" key="cs-version "/>
            <attrKeyMap attr="destName" key="s-computername "/>
            <attrKeyMap attr="destIpAddr" key="s-ip "/>
            <attrKeyMap attr="destIpPort" key="s-port "/>
            <attrKeyMap attr="recvBytes64" key="sc-bytes "/>
            <attrKeyMap attr="httpStatusCode" key="sc-status "/>
            <attrKeyMap attr="httpSubStatusCode" key="sc-substatus "/>
            <attrKeyMap attr="httpWin32Status" key="sc-win32-status "/>
            <attrKeyMap attr="durationMSec" key="time-taken "/>
          </collectAndSetAttrByKeyValuePair>
        </when>
      </when>

      <when test="$_sourceName = 'Microsoft-Windows-TerminalServices-Gateway'">
        <setEventAttribute attr="eventType">combineMsgId("Win-TerminalServices-Gateway-", $_id)</setEventAttribute>
        <setEventAttribute attr="_msg">replaceStrInStr($msg, "\\", "")</setEventAttribute>
        <choose>
          <when test="$_id = '200'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[The\suser\s"<user:gPatMesgBodyMin>",\s+on\s+client\s+computer\s"<srcIpAddr:gPatIpAddr>",.*method used was:\s+"<authenMethod:gPatStr>"\s+and\s+connection\s+protocol\s+used:\s+"<appTransportProto:gPatWord>"]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
          <when test="$_id = '205'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[The\suser\s"<user:gPatMesgBodyMin>",\s+on\s+client\s+computer\s"<srcIpAddr:gPatIpAddr>",.*remote server\s+"<destName:gPatHostName>".*method\s+used\s+was:\s+"<authenMethod:gPatWord>"]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
          <when test="$_id = '300'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[The\suser\s"<user:gPatMesgBodyMin>",\s+on\s+client\s+computer\s"<srcIpAddr:gPatIpAddr>",.*connect\s+to\s+resource\s+"<resourceName:gPatStr>"\.]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
          <when test="$_id = '302'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[The\suser\s"<user:gPatMesgBodyMin>",\s+on\s+client\s+computer\s"<srcIpAddr:gPatIpAddr>",\s+connected\s+to\s+resource\s+"<resourceName:gPatStr>"\.\s+Connection\s+protocol\s+used:\s+"<appTransportProto:gPatWord>"\.]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
          <when test="$_id = '303'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[The\suser\s"<user:gPatMesgBodyMin>",\s+on\s+client\s+computer\s"<srcIpAddr:gPatIpAddr>",\s+disconnected\s+from\s+the\s+following\s+network\s+resource:\s+"<resourceName:gPatStr>"\..*transferred\s+<sentBytes:gPatInt>\s+bytes\s+and\s+received\s+<recvBytes:gPatInt>\s+bytes\.\s+The\s+client\s+session\s+duration\s+was\s+<_durationSec:gPatInt>\s+seconds\.\s+Connection\s+protocol\s+used:\s+"<appTransportProto:gPatWord>"\.]]></regex>
                </collectFieldsByRegex>
                <setEventAttribute attr="durationMSec">scale($_durationSec, 1000)</setEventAttribute>
              </case>
              <default/>
            </switch>
          </when>
          <when test="$_id = '312'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[The\suser\s"<user:gPatMesgBodyMin>",\s+on\s+client\s+computer\s"<srcIpAddr:gPatIpAddr>(?:\:<srcIpPort:gPatInt>)?",]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
        </choose>
        <!-- bottom of parser does not set domain if already existing, so have to parse here -->
        <when test="exist user">
          <switch>
            <case>
              <collectFieldsByRegex src="$user">
                <regex><![CDATA[<domain:gPatMesgBody>[\\]<user:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>
      </when>
      <when test="$_sourceName = 'Microsoft-Windows-TerminalServices-LocalSessionManager'">
        <setEventAttribute attr="eventType">combineMsgId("Win-TerminalServices-LocalSessionManager-", $_id)</setEventAttribute>
        <setEventAttribute attr="_msg">replaceStrInStr($msg, "\\", "")</setEventAttribute>
        <choose>
          <when test="$_id IN '21,22,23,24,25,41,42'">
            <setEventAttribute attr="destName">$computer</setEventAttribute>
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$_msg">
              <attrKeyMap attr="user" key="User"/>
              <attrKeyMap attr="sessionId" key="Session ID"/>
              <attrKeyMap attr="srcIpAddr" key="Source Network Address"/>
            </collectFieldsByKeyValuePair>
          </when>
          <when test="$_id = '40'">
            <switch>
              <case>
                <collectFieldsByRegex src="$_msg">
                  <regex><![CDATA[Session <sessionId:gPatInt> has been disconnected, reason code <errorNoInt:gPatInt>]]></regex>
                </collectFieldsByRegex>
              </case>
              <default/>
            </switch>
          </when>
        </choose>
        <!-- bottom of parser does not set domain if already existing, so have to parse here -->
        <when test="exist user">
          <switch>
            <case>
              <collectFieldsByRegex src="$user">
                <regex><![CDATA[<domain:gPatMesgBody>[\\]<user:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>
      </when>
      <when test="$_sourceName = 'Microsoft-Windows-PrintService'">
        <setEventAttribute attr="eventType">Win-PrintService-Generic</setEventAttribute>
        <choose>
          <when test="$_id = '99'">
            <setEventAttribute attr="eventType">Win-PrintService-Encountered-Fatal-Error</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[\([^,]+,\s*error\s+<errorString:gPatMesgBodyMin>\).*Try\s+to\s+<incidentReso:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '100'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-Printer-Successed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer\s+<printer:gPatMesgBodyMin>\s+successfully]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '101'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatStrComma>, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '104'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-Printer-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '105'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '106'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-Doc-Job-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> for printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '107'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-Doc-Job-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> for printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '110'">
            <setEventAttribute attr="eventType">Win-PrintService-End-Doc-Job-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> for printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '111'">
            <setEventAttribute attr="eventType">Win-PrintService-End-Doc-Job-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> for printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '114'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-Driver-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver <printerDriver:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '115'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver <printerDriver:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '118'">
            <setEventAttribute attr="eventType">Win-PrintService-Open-Printer-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '119'">
            <setEventAttribute attr="eventType">Win-PrintService-Open-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '122'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-Page-Job-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> at printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '123'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-Page-Job-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin>, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '124'">
            <setEventAttribute attr="eventType">Win-PrintService-End-Page-Job-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> at printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '125'">
            <setEventAttribute attr="eventType">Win-PrintService-End-Page-Job-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[job <jobName:gPatMesgBodyMin> at printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '131'">
            <setEventAttribute attr="eventType">Win-PrintService-Set-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '200'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-CSR-Printer-Connection-Succeeded</setEventAttribute>
          </when>
          <when test="$_id = '201'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-CSR-Printer-Connection-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '204'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-CSR-Printer-Connection-Succeeded</setEventAttribute>
          </when>
          <when test="$_id = '205'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-CSR-Printer-Connection-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '207'">
            <setEventAttribute attr="eventType">Win-PrintService-Open-CSR-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '210'">
            <setEventAttribute attr="eventType">Win-PrintService-Close-CSR-Printer-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '211'">
            <setEventAttribute attr="eventType">Win-PrintService-Close-CSR-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '212'">
            <setEventAttribute attr="eventType">Win-PrintService-Parse-Inf-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver <printerDriver:gPatMesgBodyMin> succeeded]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '213'">
            <setEventAttribute attr="eventType">Win-PrintService-Parse-Inf-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver <printerDriver:gPatMesgBodyMin> failed .*, error code <errorCode:gPatStrComma>, HRESULT <actionResult:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '214'">
            <setEventAttribute attr="eventType">Win-PrintService-Install-Driver-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver <printerDriver:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '215'">
            <setEventAttribute attr="eventType">Win-PrintService-Install-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver <printerDriver:gPatMesgBodyMin> failed, error code <errorCode:gPatStrComma>, HRESULT <actionResult:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '216'">
            <setEventAttribute attr="eventType">Win-PrintService-Setup-Succeeded</setEventAttribute>
          </when>
          <when test="$_id = '217'">
            <setEventAttribute attr="eventType">Win-PrintService-Setup-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[error code <errorCode:gPatStrComma>, HRESULT <actionResult:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '218'">
            <setEventAttribute attr="eventType">Win-PrintService-Copy-Driver-Package-Succeeded</setEventAttribute>
          </when>
          <when test="$_id = '219'">
            <setEventAttribute attr="eventType">Win-PrintService-Copy-Driver-Package-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[error code <errorCode:gPatStrComma>, HRESULT <actionResult:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '220'">
            <setEventAttribute attr="eventType">Win-PrintService-Retrieve-CSR-Cache-Succeeded</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> succeeded.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '221'">
            <setEventAttribute attr="eventType">Win-PrintService-Retrieve-CSR-Cache-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '224'">
            <setEventAttribute attr="eventType">Win-PrintService-Driver-Package-Operation-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[operation <opName:gPatMesgBodyMin> failed with error code <errorCode:gPatStrComma>, server name <serverName:patStrDot>\..* caused by\s*<errReason:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '225,226,227,229,235,236,237,238,239,240'">
            <setEventAttribute attr="eventType">Win-PrintService-Install-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver '<printerDriver:gPatStrSQ>'\.(?:\s*Error\s+code: <errorCode:patStrDot>\.)?\s*<errReason:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '228,230'">
            <setEventAttribute attr="eventType">Win-PrintService-Install-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer driver '<printerDriver:gPatStrSQ>'\.\s*<errReason:patStrDot>\.\s*Error code: <errorCode:patStrDot>\.<incidentReso:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '231,232,233,241'">
            <setEventAttribute attr="eventType">Win-PrintService-Upgrade-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[driver '<printerDriver:gPatStrSQ>'<errReason:patStrDot>\.<incidentReso:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '234'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[driver '<printerDriver:gPatStrSQ>'.<errReason:patStrDot>\.\s*Error code:<errorCode:patStrDot>\.<incidentReso:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '242'">
            <setEventAttribute attr="eventType">Win-PrintService-Configure-Queue-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[driver '<printerDriver:gPatStrSQ>']]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '300,302,303,304'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> (?:was|will be) <_action:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-Printer-", $_action)</setEventAttribute>
          </when>
          <when test="$_id = '301'">
            <setEventAttribute attr="eventType">Win-PrintService-Printer-deleted</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> was <:gPatStrComma>,]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '305'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-Jobs</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> were deleted.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '306'">
            <setEventAttribute attr="eventType">Win-PrintService-Change-Settings</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> were changed.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '308,309,310'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Document <fileName:gPatStrComma>,.* owned by <fileOwner:gPatMesgBodyMin> was <_action:gPatStr> on <:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-Doc-", $_action)</setEventAttribute>
          </when>
          <when test="$_id = '307'">
            <setEventAttribute attr="eventType">Win-PrintService-Doc-printed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Document <seqNum:gPatStrComma>,<:gPatMesgBodyMin> owned by <fileOwner:gPatMesgBodyMin> on <:gPatMesgBodyMin> was printed on <printer:gPatMesgBodyMin> through port <fileName:gPatMesgBodyMin>\.\s*Size in bytes:\s*<fileSize64:gPatInt>\.\s*Pages printed:\s*<prtPrintPageCount:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '311'">
            <setEventAttribute attr="eventType">Win-PrintService-Doc-Moved</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[document <fileName:gPatStrComma>,.* owned by <fileOwner:gPatMesgBodyMin> to .* on <printer:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '312,313'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Form <:gPatMesgBodyMin> was <_action:patStrDot>\. ]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-Form-", $_action)</setEventAttribute>
          </when>
          <when test="$_id = '314'">
            <setEventAttribute attr="eventType">Win-PrintService-Job-Time-Out</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Document <fileName:gPatStrComma>,.* owned by <fileOwner:gPatMesgBodyMin> timed out while printing on <printer:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '315'">
            <setEventAttribute attr="eventType">Win-PrintService-Share-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> with shared resource name <resourceName:patStrDot>\. Error\s*<errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '316'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-Driver</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer driver <printerDriver:gPatMesgBodyMin> for .*. Files:\s*<fileName:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '317'">
            <setEventAttribute attr="eventType">Win-PrintService-Driver-deleted</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer driver <printerDriver:gPatMesgBodyMin> was .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '318'">
            <setEventAttribute attr="eventType">Win-PrintService-Upgrade-Settings</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> driver <printerDriver:patStrDot>\. Error:\s*<errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '319,320'">
            <setEventAttribute attr="eventType">Win-PrintService-Initialize-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> failed to initialize because\s+<errReason:gPatMesgBodyMin>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '321'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-File</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[File\(s\) <fileName:gPatMesgBodyMin> associated with printer <printer:gPatMesgBodyMin> were .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '322,323,326,327,328,329,331,333'">
            <setEventAttribute attr="eventType">Win-PrintService-Publish-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*,[^.]+.\s*Error:<errorString:patStrDot>\.?]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '325'">
            <setEventAttribute attr="eventType">Win-PrintService-Remove-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\.\s*Error:<errorString:patStrDot>\.?]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '332'">
            <setEventAttribute attr="eventType">Win-PrintService-Publish-Printer-Successed</setEventAttribute>
          </when>
          <when test="$_id = '334'">
            <setEventAttribute attr="eventType">Win-PrintService-Remove-Printer-Successed</setEventAttribute>
          </when>
          <when test="$_id = '335'">
            <setEventAttribute attr="eventType">Win-PrintService-Remove-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\.\s*Error:<errorString:patStrDot>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '336'">
            <setEventAttribute attr="eventType">Win-PrintService-Update-Queue</setEventAttribute>
          </when>
          <when test="$_id = '337'">
            <setEventAttribute attr="eventType">Win-PrintService-Find-Queue-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* domain <domain:patStrDot>\..*\.\s*Error:\s*<errorString:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '338'">
            <setEventAttribute attr="eventType">Win-PrintService-Removed-Printer-Successed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> was.*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '342,344,345,346'">
            <setEventAttribute attr="eventType">Win-PrintService-Remove-Queue-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*(?:\s+because\s+<errReason:patStrDot>)?\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '343'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Connect-Queue-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\.\s+Error <errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '347'">
            <setEventAttribute attr="eventType">Win-PrintService-Delete-Queue-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\.\s*Error: <errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '348'">
            <setEventAttribute attr="eventType">Win-PrintService-Incompatible-Driver</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[This version of <printerDriver:gPatMesgBodyMin> is .*\.\s*Please <incidentReso:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '349'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Create-Link-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\.\s*Error <errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '350'">
            <setEventAttribute attr="eventType">Win-PrintService-Print-File-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Document <fileName:gPatMesgBodyMin> failed .* because of <errReason:patStrDot>\..* driver is: <printerDriver:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '351'">
            <setEventAttribute attr="eventType">Win-PrintService-Incompatible-Driver</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*because <errReason:patStrDot>\.\s+Please <incidentReso:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '352'">
            <setEventAttribute attr="eventType">Win-PrintService-Change-Priority</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[document <fileName:gPatStrComma>,.* owned by <fileOwner:gPatMesgBodyMin> was changed to <:gPatMesgBodyMin> on <printer:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '353'">
            <setEventAttribute attr="eventType">Win-PrintService-Print-Doc-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*because <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '354'">
            <setEventAttribute attr="eventType">Win-PrintService-Initialization-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[<osObjName:gPatMesgBodyMin> initialization failed at <fileName:patStrDot>\. Error: <errorString:patStrDot>\.\s*This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '356'">
            <setEventAttribute attr="eventType">Win-PrintService-Install-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[driver <printerDriver:gPatMesgBodyMin> on cluster spooler resource <resourceName:patStrDot>\.\s*Win32 error: <errorCode:patStrDot>\..* because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '359'">
            <setEventAttribute attr="eventType">Win-PrintService-Install-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> into .* error code <errorCode:patStrDot>\.\s*This can occur if <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '360'">
            <setEventAttribute attr="eventType">Win-PrintService-Update-Color-Profile-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> with Win32 error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '361'">
            <setEventAttribute attr="eventType">Win-PrintService-Initialize-Port-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> failed .* Win32 error: <errorCode:patStrDot>\..* because of <errReason:patStrDot>\. Try <incidentReso:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '362'">
            <setEventAttribute attr="eventType">Win-PrintService-Initialize-Spooler-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* error code <errorCode:patStrDot>\..*Try <incidentReso:patStrDot>.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '363'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-Spooler-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[The print spooler <procName:gPatMesgBodyMin> failed .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '364,365'">
            <setEventAttribute attr="eventType">Win-PrintService-Load-Print-Processor-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[processor <procName:gPatMesgBodyMin> because <errReason:patStrDot>\.(\s*Error code <errorCode:patStrDot>\.)?\s*Module: <module:patStrDot>\.\s*Please\s*<incidentReso:patStrDot>]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '366'">
            <setEventAttribute attr="eventType">Win-PrintService-Descriptor-Invalid</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* for <originalSecurityDescriptor:gPatMesgBodyMin> is invalid.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '367'">
            <setEventAttribute attr="eventType">Win-PrintService-Initialize-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> because <errReason:patStrDot>\. Please <incidentReso:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '368'">
            <setEventAttribute attr="eventType">Win-PrintService-Verify-Driver-Package-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Win32 system error code <errorCode:patStrDot>. This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '369'">
            <setEventAttribute attr="eventType">Win-PrintService-Verify-Driver-Package-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Win32 system error code <errorCode:patStrDot>\.\s*This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '370'">
            <setEventAttribute attr="eventType">Win-PrintService-Regenerate-Driver-Info-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[driver <printerDriver:gPatMesgBodyMin> for environment <:patStrDot>\.\s*Win32 system error code <errorCode:patStrDot>\. This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '371'">
            <setEventAttribute attr="eventType">Win-PrintService-Unshare-Printer-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[printer <printer:gPatMesgBodyMin> which .*\.\s*Error <errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '372'">
            <setEventAttribute attr="eventType">Win-PrintService-Print-Doc-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[The document <fileName:gPatStrComma>,\s*owned by <fileOwner:gPatStrComma>,\s*failed to print on printer <printer:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '373'">
            <setEventAttribute attr="eventType">Win-PrintService-Unusual-GDI</setEventAttribute>
          </when>
          <when test="$_id = '502'">
            <setEventAttribute attr="eventType">Win-PrintService-Get-Computer-Name-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\.\s+This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '503'">
            <setEventAttribute attr="eventType">Win-PrintService-Initial-Print-Provider-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '504'">
            <setEventAttribute attr="eventType">Win-PrintService-Initial-Router-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '505'">
            <setEventAttribute attr="eventType">Win-PrintService-Create-Phase2Init-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '507'">
            <setEventAttribute attr="eventType">Win-PrintService-Initial-Name-Cache-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '508'">
            <setEventAttribute attr="eventType">Win-PrintService-Initial-Router-Cache-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '509'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-Spooler-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*because <errorString:patStrDot>\. Error code <errorCode:patStrDot>\. This can\s+occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '510'">
            <setEventAttribute attr="eventType">Win-PrintService-InitializeProvider-Allocate-Mem-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*for <errorString:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '511'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Load-Provider-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*provider <providerName:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '512'">
            <setEventAttribute attr="eventType">Win-PrintService-InitializePrintProvider-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*provider <providerName:patStrDot>\. This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '513'">
            <setEventAttribute attr="eventType">Win-PrintService-Policy-add-Connecton-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*Error code <errorCode:patStrDot>\. This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '514,515,516'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Group Policy was unable to <_action:gPatStr> per computer printer connection <:patStrDot>\.\s*Error <errorString:patStrDot>\.\s*<:patStrDot>\.\s*This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-Policy-", $_action,"-Connecton-Failed")</setEventAttribute>
          </when>
          <when test="$_id IN '517,518,519,520'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Group Policy was unable to <_action:gPatStr> (?:the )?per (computer|user) printer connection <:patStrDot>\. Error code <errorCode:patStrDot>\.(\s*[^.]+\.)?\s*This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-Policy-", $_action,"-Connecton-Failed")</setEventAttribute>
          </when>
          <when test="$_id = '600'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Import-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*driver <printerDriver:patStrDot>\. Error code=\s*<errorCode:patStrDot>\. This can occur <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '601'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Download-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*for\s+driver <printerDriver:patStrDot>\. Error code=\s*<errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '602,603'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Reopen-Connection-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*because <errorString:patStrDot>\.(\s*[^.]+\.)?\s*This can occur if <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '604'">
            <setEventAttribute attr="eventType">Win-PrintService-Encountered-Unknown-Driver-Type</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*This can occur\s+because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '701'">
            <setEventAttribute attr="eventType">Win-PrintService-Initial-Filter-Host-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\.\s*This can occur because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '702'">
            <setEventAttribute attr="eventType">Win-PrintService-Filter-Host-Shut-Down</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*Error <errorString:patStrDot>\. This can occur\s+because of <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '703,704'">
            <setEventAttribute attr="eventType">Win-PrintService-Filter-Host-Shut-Down</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*(due to|because) <errReason:patStrDot>\. Error <errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '800,801,802,805,806,807'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_action:gPatStr> job <jobName:patStrDot>\.$]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-", $_action, "-Job")</setEventAttribute>
          </when>
          <when test="$_id = '808'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Load-Module-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[module <module:gPatStrComma>, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '809'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Delete-Directory-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[directory <dirName:gPatStrComma>, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '810'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Delete-Directory-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[directory <dirName:gPatMesgBodyMin> and.*error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '811,812,813'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[ <_action:gPatStr> the file <fileName:gPatMesgBodyMin>(?: to <destFileName:gPatStrComma>)?, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="eventType">combineMsgId("Win-PrintService-Spooler-", $_action, "-File-Failed")</setEventAttribute>
          </when>
          <when test="$_id = '814'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Install-Processor-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* processor <procName:gPatStrComma>, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '815'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Register-RPC-Proto-Seq-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '816'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Detected-Invalid-RPC-Proto-Seq</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '817'">
            <setEventAttribute attr="eventType">Win-PrintService-RPC-Policy-Disabled</setEventAttribute>
          </when>
          <when test="$_id = '818'">
            <setEventAttribute attr="eventType">Win-PrintService-Start-RPC-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '819'">
            <setEventAttribute attr="eventType">Win-PrintService-Client-Rendering-Disabled</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*policy \(<policyName:patStrRightParen>\)\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '820'">
            <setEventAttribute attr="eventType">Win-PrintService-Client-Rendering-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '821'">
            <setEventAttribute attr="eventType">Win-PrintService-Client-Rendering-Render-Job</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* job <jobName:gPatMesgBodyMin> on the server \(Server Side\s+Rendering\), status <status:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '822'">
            <setEventAttribute attr="eventType">Win-PrintService-Client-Rendering-Disabled</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Unknown print processor \(<procName:patStrRightParen>\) or invalid data type \(<type:patStrRightParen>\), error <errorString:gPatStrComma>,.*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '823'">
            <setEventAttribute attr="eventType">Win-PrintService-Changed-Default-Printer</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[The default printer was changed to <printer:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '825'">
            <setEventAttribute attr="eventType">Win-PrintService-Client-Rendering-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '826'">
            <setEventAttribute attr="eventType">Win-PrintService-Set-Rendering-Policy-Successfully</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*printer <printer:gPatStrComma>, path <servicePath:gPatStrComma>, port <appPort:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '827'">
            <setEventAttribute attr="eventType">Win-PrintService-Print-Queue-Invalid</setEventAttribute>
          </when>
          <when test="$_id = '828'">
            <setEventAttribute attr="eventType">Win-PrintService-Print-Job-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[The print job <jobName:gPatMesgBodyMin> failed with error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '829'">
            <setEventAttribute attr="eventType">Win-PrintService-XPS-API-call-Started</setEventAttribute>
          </when>
          <when test="$_id = '830'">
            <setEventAttribute attr="eventType">Win-PrintService-XPS-API-call-Ended</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*status <status:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '831'">
            <setEventAttribute attr="eventType">Win-PrintService-XPS-API-dependency-Started</setEventAttribute>
          </when>
          <when test="$_id = '832'">
            <setEventAttribute attr="eventType">Win-PrintService-XPS-API-dependency-Ended</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*status <status:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '833'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Operation-Started</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Print spooler operation <opName:gPatMesgBodyMin> \(<:patStrRightParen>\) started\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '834'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Operation-Ended</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Print spooler operation <opName:gPatMesgBodyMin> \(<:patStrRightParen>\) ended, status <status:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '842'">
            <setEventAttribute attr="eventType">Win-PrintService-Send-Print-Job-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[The print job <jobName:gPatMesgBodyMin> was sent through the print processor <procName:gPatMesgBodyMin> on printer <printer:gPatStrComma>, driver <printerDriver:gPatStrComma>, in the isolation mode <connMode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '843'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Record-Active-Driver-Host</setEventAttribute>
          </when>
          <when test="$_id = '844'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Selected-Mode</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s*mode <connMode:gPatStr> for printer <printer:gPatStrComma>,\s*printer driver <printerDriver:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '845'">
            <setEventAttribute attr="eventType">Win-PrintService-Load-Module-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Attempted to load module <module:gPatMesgBodyMin> for printer <printer:gPatStrComma>, printer driver <printerDriver:patStrDot>\. Win32 error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '846'">
            <setEventAttribute attr="eventType">Win-PrintService-Cached-Printer-Scavenged</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Cached printer\s+<printer:gPatMesgBodyMin> has been scavenged and deleted.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '847'">
            <setEventAttribute attr="eventType">Win-PrintService-Deleting-Cached-Printer-Deletion</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Cached printer <printer:gPatMesgBodyMin> has .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '848'">
            <setEventAttribute attr="eventType">Win-PrintService-Share-Printer</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> was .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '849'">
            <setEventAttribute attr="eventType">Win-PrintService-Unshared-Printer</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Printer <printer:gPatMesgBodyMin> shared .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '850'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Initial-COM</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* function <funName:gPatMesgBodyMin> in print driver module <module:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '851'">
            <setEventAttribute attr="eventType">Win-PrintService-Point-And-Print-Not-Allowed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\.\s*Error <errorString:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '852'">
            <setEventAttribute attr="eventType">Win-PrintService-Selected-Replacement-Driver</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[Driver <printerDriver:gPatMesgBodyMin> could .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '853,854'">
            <setEventAttribute attr="eventType">Win-PrintService-Client-Rendering-Synchronization</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* with code <:gPatMesgBodyMin> for\s+printer <printer:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '855'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-OpenPrinter-Cache-Entry</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.* printer <printer:gPatMesgBodyMin> with .*]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id IN '856,857,858,859,860,861,862,863'">
            <setEventAttribute attr="eventType">Win-PrintService-Connection-Reconfigured</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*(because|due to) <errReason:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '864'">
            <setEventAttribute attr="eventType">Win-PrintService-Scan-Servicing-Operation-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*HRESULT <actionResult:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '865'">
            <setEventAttribute attr="eventType">Win-PrintService-Print-Job-Failures</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s+printer '<printer:gPatStrSQ>' using driver '<printerDriver:gPatStrSQ>'\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '866'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Create-Plug-and-Play-Object-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s+printer '<printer:gPatStrSQ>'\..*\. Error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '867'">
            <setEventAttribute attr="eventType">Win-PrintService-Initial-Port-Monitor-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*error code: <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '868'">
            <setEventAttribute attr="eventType">Win-PrintService-EventLog-Exceeded-Maxi-Size</setEventAttribute>
          </when>
          <when test="$_id = '869'">
            <setEventAttribute attr="eventType">Win-PrintService-Add-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s+driver <printerDriver:gPatMesgBodyMin> failed, error code <errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
          <when test="$_id = '870'">
            <setEventAttribute attr="eventType">Win-PrintService-Spooler-Download-Driver-Failed</setEventAttribute>
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[.*\s+driver <printerDriver:patStrDot>\. Error code=\s*<errorCode:patStrDot>\.]]></regex>
            </collectFieldsByRegex>
          </when>
        </choose>
        <when test="exist fileName">
          <collectFieldsByRegex src="$fileName">
            <regex><![CDATA[^(?:<filePath:gPatMesgBody>\\)?<fileName:gPatMesgBodyMin>\s*$]]></regex>
          </collectFieldsByRegex>
        </when>
      </when>

      <when test="$_logType = 'Microsoft-Windows-Windows Firewall With Advanced Security/Firewall'">
        <setEventAttribute attr="eventType">combineMsgId("Win-Firewall-AS-", $_id)</setEventAttribute>
        <setEventAttribute attr="msg">replaceStringByRegex($msg, "\t", "  ")</setEventAttribute>
        <choose>
          <when test="$_id = '2000'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="profileName" key="Current Profile"/>
              <attrKeyMap attr="_IPsec_SA_Idle_time" key="IPsec SA Idle time"/>
              <attrKeyMap attr="_IPsec_preshared_key_encoding" key="IPsec preshared key encoding"/>
              <attrKeyMap attr="_IPsec_Exempt" key="IPsec Exempt"/>
              <attrKeyMap attr="_IPsec_CRL_Check" key="IPsec CRL Check"/>
              <attrKeyMap attr="_IPsec_Through_NAT" key="IPsec Through NAT"/>
              <attrKeyMap attr="_Policy_Version_Supported" key="Policy Version Supported"/>
              <attrKeyMap attr="_Policy_Version" key="Policy Version"/>
              <attrKeyMap attr="_Binary_Version_Supported" key="Binary Version Supported"/>
              <attrKeyMap attr="_Stateful_FTP" key="Stateful FTP"/>
              <attrKeyMap attr="_Group_Policy_Applied" key="Group Policy Applied"/>
              <attrKeyMap attr="_Remote_Machine_Authorization_List" key="Remote Machine Authorization List"/>
              <attrKeyMap attr="_Remote_UserAuthorization_List" key="Remote UserAuthorization List"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2001'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="profileName" key="Profile"/>
              <attrKeyMap attr="operationalState" key="Operational Mode"/>
              <attrKeyMap attr="_Stealth_Mode" key="Stealth Mode"/>
              <attrKeyMap attr="_Block_all_Incoming_Connections" key="Block all Incoming Connections"/>
              <attrKeyMap attr="_Unicast_response_to_multicast_broadcast" key="Unicast response to multicast broadcast"/>
              <attrKeyMap attr="_Log_dropped_packets" key="Log dropped packets"/>
              <attrKeyMap attr="_Log_successful_connections" key="Log successful connections"/>
              <attrKeyMap attr="_Log_ignored_rules" key="Log ignored rules"/>
              <attrKeyMap attr="_Inbound_Notifications" key="Inbound Notifications"/>
              <attrKeyMap attr="_Allow_Local_Policy_Merge" key="Allow Local Policy Merge"/>
              <attrKeyMap attr="_Allow_Local_IPsec_Policy_Merge" key="Allow Local IPsec Policy Merge"/>
              <attrKeyMap attr="_Default_Outbound_Action" key="Default Outbound Action"/>
              <attrKeyMap attr="_Default_Inbound_Action" key="Default Inbound Action"/>
              <attrKeyMap attr="_Remote_Administration" key="Remote Administration"/>
              <attrKeyMap attr="_Stealth_Mode_IPsec_Secured_Packet_Exemption" key="Stealth Mode IPsec Secured Packet Exemption"/>
              <attrKeyMap attr="_Maximum_Log_file_size" key="Maximum Log file size"/>
              <attrKeyMap attr="filePath" key="Log File path"/>
              <attrKeyMap attr="_Allow_User_preferred_merge_of_Authorized_Applications" key="Allow User preferred merge of Authorized Applications"/>
              <attrKeyMap attr="_Allow_User_preferred_merge_of_Globally_open_ports" key="Allow User preferred merge of Globally open ports"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2002'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="type" key="Type: "/>
              <attrKeyMap attr="configValue" key="Value: "/>
              <attrKeyMap attr="srcUser" key="Modifying User: "/>
              <attrKeyMap attr="srcApp" key="Modifying Application: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2003'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="type" key="Type: "/>
              <attrKeyMap attr="configValue" key="Value: "/>
              <attrKeyMap attr="srcUser" key="Modifying User: "/>
              <attrKeyMap attr="srcApp" key="Modifying Application: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2004'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="ruleId" key="Rule ID: "/>
              <attrKeyMap attr="ruleName" key="Rule Name: "/>
              <attrKeyMap attr="origLocation" key="Origin: "/>
              <attrKeyMap attr="activeStatus" key="Active: "/>
              <attrKeyMap attr="direction" key="Direction: "/>
              <attrKeyMap attr="profileNames" key="Profiles: "/>
              <attrKeyMap attr="fwAction" key="Action: "/>
              <attrKeyMap attr="procPath" key="Application Path: "/>
              <attrKeyMap attr="serviceName" key="Service Name: "/>
              <attrKeyMap attr="_proto" key="Protocol: "/>
              <attrKeyMap attr="options" key="Security Options: "/>
              <attrKeyMap attr="edgeTraversalSetting" key="Edge Traversal: "/>
              <attrKeyMap attr="srcUser" key="Modifying User: "/>
              <attrKeyMap attr="srcApp" key="Modifying Application: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2005'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="ruleId" key="Rule ID: "/>
              <attrKeyMap attr="ruleName" key="Rule Name: "/>
              <attrKeyMap attr="origLocation" key="Origin: "/>
              <attrKeyMap attr="activeStatus" key="Active: "/>
              <attrKeyMap attr="direction" key="Direction: "/>
              <attrKeyMap attr="profileNames" key="Profiles: "/>
              <attrKeyMap attr="fwAction" key="Action: "/>
              <attrKeyMap attr="procPath" key="Application Path: "/>
              <attrKeyMap attr="serviceName" key="Service Name: "/>
              <attrKeyMap attr="_proto" key="Protocol: "/>
              <attrKeyMap attr="options" key="Security Options: "/>
              <attrKeyMap attr="edgeTraversalSetting" key="Edge Traversal: "/>
              <attrKeyMap attr="srcUser" key="Modifying User: "/>
              <attrKeyMap attr="srcApp" key="Modifying Application: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2006'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="ruleId" key="Rule ID: "/>
              <attrKeyMap attr="ruleName" key="Rule Name: "/>
              <attrKeyMap attr="srcUser" key="Modifying User: "/>
              <attrKeyMap attr="srcApp" key="Modifying Application: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2007'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="ruleId" key="Rule ID: "/>
              <attrKeyMap attr="ruleName" key="Rule Name: "/>
              <attrKeyMap attr="origLocation" key="Origin: "/>
              <attrKeyMap attr="activeStatus" key="Active: "/>
              <attrKeyMap attr="direction" key="Direction: "/>
              <attrKeyMap attr="profileNames" key="Profiles: "/>
              <attrKeyMap attr="fwAction" key="Action: "/>
              <attrKeyMap attr="procPath" key="Application Path: "/>
              <attrKeyMap attr="serviceName" key="Service Name: "/>
              <attrKeyMap attr="_proto" key="Protocol: "/>
              <attrKeyMap attr="options" key="Security Options: "/>
              <attrKeyMap attr="edgeTraversalSetting" key="Edge Traversal: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2009'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="errorString" key="Error"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2010'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Adapter_GUID" key="Adapter GUID"/>
              <attrKeyMap attr="destIntfAlias" key="Adapter Name"/>
              <attrKeyMap attr="oldSettingsValue" key="Old Profile"/>
              <attrKeyMap attr="newSettingsValue" key="New Profile"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2011'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="reason" key="Reason"/>
              <attrKeyMap attr="procPath" key="Application Path"/>
              <attrKeyMap attr="_IP_Version" key="IP Version"/>
              <attrKeyMap attr="_proto" key="Protocol"/>
              <attrKeyMap attr="destIpPort" key="Port"/>
              <attrKeyMap attr="procId" key="Process Id"/>
              <attrKeyMap attr="user" key="User"/>
            </collectFieldsByKeyValuePair>

            <choose>
              <when test="$_IP_Version = 'IPv4'">
                <setEventAttribute attr="ipVersion">4</setEventAttribute>
              </when>

              <when test="$_IP_Version = 'IPv6'">
                <setEventAttribute attr="ipVersion">6</setEventAttribute>
              </when>
            </choose>
          </when>

          <when test="$_id = '2012'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="activeStatus" key="Active"/>
              <attrKeyMap attr="_proto" key="Protocol"/>
              <attrKeyMap attr="_EndPoint1Ports" key="EndPoint1Ports"/>
              <attrKeyMap attr="_EndPoint2Ports" key="EndPoint2Ports"/>
              <attrKeyMap attr="_LocalTunnelEndpointV4" key="LocalTunnelEndpointV4"/>
              <attrKeyMap attr="_LocalTunnelEndpointV6" key="LocalTunnelEndpointV6"/>
              <attrKeyMap attr="_RemoteTunnelEndpointV4" key="RemoteTunnelEndpointV4"/>
              <attrKeyMap attr="_RemoteTunnelEndpointV6" key="RemoteTunnelEndpointV6"/>
              <attrKeyMap attr="_Phase1AuthSetId" key="Phase1AuthSetId"/>
              <attrKeyMap attr="_Phase2AuthSetId" key="Phase2AuthSetId"/>
              <attrKeyMap attr="_Phase2CryptoSetId" key="Phase2CryptoSetId"/>
              <attrKeyMap attr="fwAction" key="Action"/>
              <attrKeyMap attr="profileNames" key="Profiles"/>
              <attrKeyMap attr="_LocalAddresses" key="LocalAddresses"/>
              <attrKeyMap attr="_RemoteAddresses" key="RemoteAddresses"/>
              <attrKeyMap attr="_EmbeddedContext" key="EmbeddedContext"/>
              <attrKeyMap attr="_IsDTM" key="IsDTM"/>
              <attrKeyMap attr="_ApplyAuthZ" key="ApplyAuthZ"/>
              <attrKeyMap attr="_BypassTunnelIfEncrypted" key="BypassTunnelIfEncrypted"/>
              <attrKeyMap attr="_NoIPSecOnOutbound" key="NoIPSecOnOutbound"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2013'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="activeStatus" key="Active"/>
              <attrKeyMap attr="_proto" key="Protocol"/>
              <attrKeyMap attr="_EndPoint1Ports" key="EndPoint1Ports"/>
              <attrKeyMap attr="_EndPoint2Ports" key="EndPoint2Ports"/>
              <attrKeyMap attr="_LocalTunnelEndpointV4" key="LocalTunnelEndpointV4"/>
              <attrKeyMap attr="_LocalTunnelEndpointV6" key="LocalTunnelEndpointV6"/>
              <attrKeyMap attr="_RemoteTunnelEndpointV4" key="RemoteTunnelEndpointV4"/>
              <attrKeyMap attr="_RemoteTunnelEndpointV6" key="RemoteTunnelEndpointV6"/>
              <attrKeyMap attr="_Phase1AuthSetId" key="Phase1AuthSetId"/>
              <attrKeyMap attr="_Phase2AuthSetId" key="Phase2AuthSetId"/>
              <attrKeyMap attr="_Phase2CryptoSetId" key="Phase2CryptoSetId"/>
              <attrKeyMap attr="fwAction" key="Action"/>
              <attrKeyMap attr="profileNames" key="Profiles"/>
              <attrKeyMap attr="_LocalAddresses" key="LocalAddresses"/>
              <attrKeyMap attr="_RemoteAddresses" key="RemoteAddresses"/>
              <attrKeyMap attr="_EmbeddedContext" key="EmbeddedContext"/>
              <attrKeyMap attr="_IsDTM" key="IsDTM"/>
              <attrKeyMap attr="_ApplyAuthZ" key="ApplyAuthZ"/>
              <attrKeyMap attr="_BypassTunnelIfEncrypted" key="BypassTunnelIfEncrypted"/>
              <attrKeyMap attr="_NoIPSecOnOutbound" key="NoIPSecOnOutbound"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2014'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="srcUser" key="Modifying User"/>
              <attrKeyMap attr="srcApp" key="Modifying Application"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2015'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="activeStatus" key="Active"/>
              <attrKeyMap attr="_proto" key="Protocol"/>
              <attrKeyMap attr="_EndPoint1Ports" key="EndPoint1Ports"/>
              <attrKeyMap attr="_EndPoint2Ports" key="EndPoint2Ports"/>
              <attrKeyMap attr="_LocalTunnelEndpointV4" key="LocalTunnelEndpointV4"/>
              <attrKeyMap attr="_LocalTunnelEndpointV6" key="LocalTunnelEndpointV6"/>
              <attrKeyMap attr="_RemoteTunnelEndpointV4" key="RemoteTunnelEndpointV4"/>
              <attrKeyMap attr="_RemoteTunnelEndpointV6" key="RemoteTunnelEndpointV6"/>
              <attrKeyMap attr="_Phase1AuthSetId" key="Phase1AuthSetId"/>
              <attrKeyMap attr="_Phase2AuthSetId" key="Phase2AuthSetId"/>
              <attrKeyMap attr="_Phase2CryptoSetId" key="Phase2CryptoSetId"/>
              <attrKeyMap attr="fwAction" key="Action"/>
              <attrKeyMap attr="profileNames" key="Profiles"/>
              <attrKeyMap attr="_LocalAddresses" key="LocalAddresses"/>
              <attrKeyMap attr="_RemoteAddresses" key="RemoteAddresses"/>
              <attrKeyMap attr="_EmbeddedContext" key="EmbeddedContext"/>
              <attrKeyMap attr="_IsDTM" key="IsDTM"/>
              <attrKeyMap attr="_ApplyAuthZ" key="ApplyAuthZ"/>
              <attrKeyMap attr="_BypassTunnelIfEncrypted" key="BypassTunnelIfEncrypted"/>
              <attrKeyMap attr="_NoIPSecOnOutbound" key="NoIPSecOnOutbound"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2016'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="profileNames" key="Profiles"/>
              <attrKeyMap attr="_Endpoint1" key="Endpoint1"/>
              <attrKeyMap attr="_Endpoint2" key="Endpoint2"/>
              <attrKeyMap attr="_Phase1AuthSetId" key="Phase1AuthSetId"/>
              <attrKeyMap attr="_Phase1CryptoSetId" key="Phase1CryptoSetId"/>
              <attrKeyMap attr="_Flags" key="Flags"/>
              <attrKeyMap attr="activeStatus" key="Active"/>
              <attrKeyMap attr="_EmbeddedContext" key="EmbeddedContext"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2017'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="profileNames" key="Profiles"/>
              <attrKeyMap attr="_Endpoint1" key="Endpoint1"/>
              <attrKeyMap attr="_Endpoint2" key="Endpoint2"/>
              <attrKeyMap attr="_Phase1AuthSetId" key="Phase1AuthSetId"/>
              <attrKeyMap attr="_Phase1CryptoSetId" key="Phase1CryptoSetId"/>
              <attrKeyMap attr="_Flags" key="Flags"/>
              <attrKeyMap attr="activeStatus" key="Active"/>
              <attrKeyMap attr="_EmbeddedContext" key="EmbeddedContext"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2018'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="srcUser" key="Modifying User"/>
              <attrKeyMap attr="srcApp" key="Modifying Application"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2019'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="profileNames" key="Profiles"/>
              <attrKeyMap attr="_Endpoint1" key="Endpoint1"/>
              <attrKeyMap attr="_Endpoint2" key="Endpoint2"/>
              <attrKeyMap attr="_Phase1AuthSetId" key="Phase1AuthSetId"/>
              <attrKeyMap attr="_Phase1CryptoSetId" key="Phase1CryptoSetId"/>
              <attrKeyMap attr="_Flags" key="Flags"/>
              <attrKeyMap attr="activeStatus" key="Active"/>
              <attrKeyMap attr="_EmbeddedContext" key="EmbeddedContext"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2020'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_Flags" key="Flags"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="_TimeOutMinutes" key="TimeOutMinutes"/>
              <attrKeyMap attr="_TimeOutSessions" key="TimeOutSessions"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2021'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_Flags" key="Flags"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="_TimeOutMinutes" key="TimeOutMinutes"/>
              <attrKeyMap attr="_TimeOutSessions" key="TimeOutSessions"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2022'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="srcUser" key="Modifying User"/>
              <attrKeyMap attr="srcApp" key="Modifying Application"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2023'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_Flags" key="Flags"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="_TimeOutMinutes" key="TimeOutMinutes"/>
              <attrKeyMap attr="_TimeOutSessions" key="TimeOutSessions"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2024'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_Pfs" key="Pfs"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2025'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_Pfs" key="Pfs"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2026'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="ruleId" key="Rule ID"/>
              <attrKeyMap attr="ruleName" key="Rule Name"/>
              <attrKeyMap attr="srcUser" key="Modifying User"/>
              <attrKeyMap attr="srcApp" key="Modifying Application"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2027'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_Pfs" key="Pfs"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2028'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="_IPsec_Phase" key="IPsec Phase"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2029'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="_IPsec_Phase" key="IPsec Phase"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2030'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="ruleId" key="Rule ID: "/>
              <attrKeyMap attr="ruleName" key="Rule Name: "/>
              <attrKeyMap attr="srcUser" key="Modifying User: "/>
              <attrKeyMap attr="srcApp" key="Modifying Application: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2031'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_Set_ID" key="Set ID"/>
              <attrKeyMap attr="_Set_Name" key="Set Name"/>
              <attrKeyMap attr="_IPsec_Phase" key="IPsec Phase"/>
              <attrKeyMap attr="origLocation" key="Origin"/>
              <attrKeyMap attr="_NumSuites" key="NumSuites"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2032'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2033'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="datastoreType" key="Store Type"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2034'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="datastoreType" key="Store Type"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2035'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="datastoreType" key="Store Type"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2036'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_IPsec_Phase" key="IPsec Phase"/>
              <attrKeyMap attr="datastoreType" key="Store Type"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2037'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="_IPsec_Phase" key="IPsec Phase"/>
              <attrKeyMap attr="datastoreType" key="Store Type"/>
              <attrKeyMap attr="srcUser" key="ModifyingUser"/>
              <attrKeyMap attr="srcApp" key="ModifyingApplication"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2038'">
            <collectFieldsByRegex src="$msg">
              <regex><![CDATA[^<_detail:gPatMesgBodyMin>:\s+<_body:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
            <collectAndSetAttrByKeyValuePair sep="\n" src="$_body">
              <attrKeyMap attr="ruleId" key="ID: "/>
              <attrKeyMap attr="ruleName" key="Name: "/>
              <attrKeyMap attr="reason" key="Reason: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>

          <when test="$_id = '2039'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="reason" key="Reason"/>
              <attrKeyMap attr="_All_Proxies" key="All Proxies"/>
              <attrKeyMap attr="_All_Domain_Proxies" key="All Domain Proxies"/>
              <attrKeyMap attr="_Group_Policy_Configured_Domain_Proxies" key="Group Policy Configured Domain Proxies"/>
              <attrKeyMap attr="_Group_Policy_Configured_Local_Proxies" key="Group Policy Configured Local Proxies"/>
              <attrKeyMap attr="_All_DA_Nat64_Domain_Proxies" key="All DA Nat64 Domain Proxies"/>
              <attrKeyMap attr="_Group_Policy_is_authoritative" key="Group Policy is authoritative"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2040'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="reason" key="Reason"/>
              <attrKeyMap attr="_All_Domain_Subnets" key="All Domain Subnets"/>
              <attrKeyMap attr="_Group_Policy_Configured_Domain_Subnets" key="Group Policy Configured Domain Subnets"/>
              <attrKeyMap attr="_All_DA_Nat64_Domain_Subnets" key="All DA Nat64 Domain Subnets"/>
              <attrKeyMap attr="_Group_Policy_is_authoritative" key="Group Policy is authoritative"/>
            </collectFieldsByKeyValuePair>
          </when>

          <when test="$_id = '2041'">
            <collectFieldsByKeyValuePair sep="\n" kvsep=": " src="$msg">
              <attrKeyMap attr="reason" key="Reason"/>
              <attrKeyMap attr="_Capability" key="Capability"/>
              <attrKeyMap attr="profileName" key="Profile"/>
              <attrKeyMap attr="_IP_Range_Definition" key="IP Range Definition"/>
            </collectFieldsByKeyValuePair>
          </when>
        </choose>
      </when>

    </choose>

    <choose>

      <when test="exist procName">
        <setEventAttribute attr="swProcName">$procName</setEventAttribute>
        <when test="not exist appName">
          <setEventAttribute attr="appName">$procName</setEventAttribute>
        </when>
      </when>
      <otherwise>
        <when test="exist appName">
          <setEventAttribute attr="procName">$appName</setEventAttribute>
        </when>
      </otherwise>
    </choose>

    <when test="exist srcName">
      <switch>
        <case>
          <collectAndSetAttrByRegex src="$srcName">
            <regex><![CDATA[IP-<_s1:gPatInt>-<_s2:gPatInt>-<_s3:gPatInt>-<_s4:gPatInt>]]></regex>
          </collectAndSetAttrByRegex>
          <setEventAttribute attr="srcIpAddr">combineMsgId($_s1, ".", $_s2, ".", $_s3, ".", $_s4)</setEventAttribute>
        </case>
        <default/>
      </switch>
    </when>
    <when test="exist srcName">
      <setEventAttribute attr="srcName">replaceStrInStr($srcName, "\\", "")</setEventAttribute>
    </when>

    <when test="exist type">
      <choose>
        <when test="matches($type, 'Critical')">
          <setEventAttribute attr="eventSeverity">9</setEventAttribute>
        </when>
        <when test="matches($type, 'Error')">
          <setEventAttribute attr="eventSeverity">7</setEventAttribute>
        </when>
        <when test="matches($type, 'Warning')">
          <setEventAttribute attr="eventSeverity">5</setEventAttribute>
        </when>
        <when test="matches($type, 'Information')">
          <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        </when>
        <otherwise>
          <choose>
            <when test="matches($type, 'Success')">
              <setEventAttribute attr="eventSeverity">1</setEventAttribute>
            </when>
            <when test="matches($type, 'Failure|Failed')">
              <setEventAttribute attr="eventSeverity">3</setEventAttribute>
            </when>
          </choose>
        </otherwise>
      </choose>
    </when>

    <choose>
      <when test="not_exist _id"/>
      <when test="$_id = '4625'">
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '5137'">
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <otherwise/>
    </choose>

    <when test="exist user">
      <when test="matches($user, '@')">
        <collectFieldsByRegex src="$user">
          <regex><![CDATA[<user:patStrAt>@]]></regex>
        </collectFieldsByRegex>
      </when>

      <switch>
        <case>
          <collectFieldsByRegex src="$user">
            <regex><![CDATA[<_domain:gPatMesgBody>[\\]<user:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <when test="not_exist domain">
            <when test="exist _domain">
              <setEventAttribute attr="domain">$_domain</setEventAttribute>
            </when>
          </when>
        </case>
        <default/>
      </switch>
    </when>

    <when test="exist targetUser">
      <when test="matches($targetUser, '@')">
        <collectFieldsByRegex src="$targetUser">
          <regex><![CDATA[<targetUser:patStrAt>@]]></regex>
        </collectFieldsByRegex>
      </when>

      <when test="matches($targetUser, '\\')">
        <collectFieldsByRegex src="$targetUser">
          <regex><![CDATA[[\\]<targetUser:gPatStr>]]></regex>
        </collectFieldsByRegex>
      </when>
    </when>

    <when test="exist targetUserGrp">
      <when test="matches($targetUserGrp, '\$')">
        <collectFieldsByRegex src="$targetUserGrp">
          <regex><![CDATA[<targetUserGrp:patStrDollar>\$]]></regex>
        </collectFieldsByRegex>
      </when>
    </when>

    <when test="exist _targetUser">
      <when test="not_exist targetUser">
        <switch>
          <case>
            <!-- CN=Lastname\, Firstname,OU=EMPLOYEES,DC=com -->
            <collectFieldsByRegex src="$_targetUser">
              <regex><![CDATA[(?i:CN)=<_lastname:gPatStrComma>[\\],\s+<_firstname:gPatStrComma>]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="targetUser">combineMsgId($_firstname, " ", $_lastname)</setEventAttribute>
          </case>
          <case>
            <collectFieldsByRegex src="$_targetUser">
              <regex><![CDATA[(?i:CN)=<targetUser:gPatStrComma>,<:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </case>
          <default>
            <setEventAttribute attr="targetUser">$_targetUser</setEventAttribute>
          </default>
        </switch>
      </when>
    </when>

    <when test="exist targetDomain">
      <when test="exist hostName">
        <setEventAttribute attr="_hostName">toLower($hostName)</setEventAttribute>
        <setEventAttribute attr="_targetDomain">toLower($targetDomain)</setEventAttribute>
        <setEventAttribute attr="_hostDomain">extractHostFromFQDN($_hostName)</setEventAttribute>
        <when test="$_targetDomain = $_hostDomain">
          <setEventAttribute attr="isLocalUser">Yes</setEventAttribute>
        </when>
      </when>
    </when>

    <when test="exist osObjAccessType">
      <setEventAttribute attr="osObjAccessType">trimAttribute($osObjAccessType, ",")</setEventAttribute>
    </when>

    <when test="exist subStatus">
      <setEventAttribute attr="_subStatus">toUpper($subStatus)</setEventAttribute>
      <collectFieldsByCsvFile file="/opt/phoenix/data-definition/eventAttrDesc/winLogonFailCode2.csv" key="$_subStatus" reloadInterval="3600">
        <attrKeyMap attr="errReason" column="1"/>
      </collectFieldsByCsvFile>
    </when>

    <!-- 4776 events have Status which is mapped to this attrib, 4625 has both Status and SubStatus -->
    <when test="exist winLogonFailCode2">
      <setEventAttribute attr="winLogonFailCode2">toUpper($winLogonFailCode2)</setEventAttribute>
      <collectFieldsByCsvFile file="/opt/phoenix/data-definition/eventAttrDesc/winLogonFailCode2.csv" key="$winLogonFailCode2" reloadInterval="3600">
        <attrKeyMap attr="errReason" column="1"/>
      </collectFieldsByCsvFile>
    </when>

    <when test="exist _id">
      <setEventAttribute attr="winEventId">$_id</setEventAttribute>

      <when test="$_logType = 'Security'">
        <collectFieldsByCsvFile file="/opt/phoenix/data-definition/WindowsAuditCategories.csv" key="$_id" reloadInterval="3600">
          <attrKeyMap attr="winEvtCategory" column="1"/>
          <attrKeyMap attr="winEvtSubCategory" column="2"/>
        </collectFieldsByCsvFile>
      </when>
    </when>

    <when test="exist encryptAlgo">
      <setEventAttribute attr="_encryptAlgo">toLower($encryptAlgo)</setEventAttribute>
      <collectFieldsByCsvFile file="/opt/phoenix/data-definition/WindowsEncryptionTypes.csv" key="$_encryptAlgo" reloadInterval="3600">
        <attrKeyMap attr="encryptAlgoName" column="1"/>
        <attrKeyMap attr="description" column="2"/>
      </collectFieldsByCsvFile>
    </when>

    <when test="exist _proto">
      <setEventAttribute attr="ipProto">convertStrToIntIpProto($_proto)</setEventAttribute>
    </when>

    <when test="exist _logType">
      <setEventAttribute attr="activityType">$_logType</setEventAttribute>
    </when>

  </parsingInstructions>
</eventParser>
