<eventParser name="SendmailParser">

  <deviceType>
    <Vendor>Generic</Vendor>
    <Model>Generic</Model>
    <Version>ANY</Version>
  </deviceType>

  <appType>
    <Vendor>Sendmail.org</Vendor>
    <Model>Sendmail Mail Server</Model>
    <Version>ANY</Version>
    <Name>Sendmail Mail Server</Name>
  </appType>

  <eventFormatRecognizer><![CDATA[(?:^\s*<:gPatSyslogPRI>\s*|<:gPatIpAddr>\s+)(?:sendmail|sendmail-in)\[\d+\]|(?:<:gPatIpAddr>|<:gPatHostName>)\s+sendmail\s+\d+\s+-\s+-]]></eventFormatRecognizer>

  <testEvents>
    <testEvent><![CDATA[<22>Mar 10 19:04:34 2.2.2.2 sendmail[21478]: [ID 801593 mail.info] o2B046Ha021349: to=<user@abc.edu>, delay=00:00:19, xdelay=00:00:00, mailer=relay, pri=139292, relay=abc.edu. [2.2.2.2], dsn=2.0.0, stat=Sent (AUV36627 Message accepted for delivery)]]></testEvent>
    <testEvent><![CDATA[<21>Mar 10 19:15:51 2.2.2.2 sendmail-in[24209]: [ID 801593 mail.notice] o2B0Ffcv024209: ruleset=check_rcpt, arg1=<user@abc.edu>, relay=[2.2.2.2], reject=550 5.7.1 <user@abc.edu>... Mail from 3.3.3.3 REFUSED.  See http://www.abc.org/query/bl?ip=2.2.2.2]]></testEvent>
    <testEvent><![CDATA[<22>1 2024-07-17T07:01:01.849239+00:00 localhost sendmail 30780 - -  46H711t9030780: to=root, ctladdr=root (0/0), delay=00:00:00, xdelay=00:00:00, mailer=relay, pri=138426, relay=[127.0.0.1] [127.0.0.1], dsn=2.0.0, stat=Sent (46H711W4031620 Message accepted for delivery)]]></testEvent>
  </testEvents>

  <parsingInstructions>
    <switch>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatSyslogPRI><_mon:gPatMon>\s+<_day:gPatDay>\s+<_time:gPatTime>\s+<reptDevIpAddr:gPatIpAddr>\s<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatSyslogPRI><_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
    </switch>

    <setEventAttribute attr="eventType">SENDMAIL_GENERIC</setEventAttribute>
    <setEventAttribute attr="eventSeverity">1</setEventAttribute>
    <setEventAttribute attr="eventAction">0</setEventAttribute>

    <switch>
      <case>
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*ruleset=.*,\s*arg1=\<<user:gPatStr>\@.*\>,\s*relay=.*\[<srcIpAddr:gPatIpAddr>\],\s*reject=<errReason:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="eventType">SENDMAIL_REJECT</setEventAttribute>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        <setEventAttribute attr="eventAction">1</setEventAttribute>
      </case>
      <case>
        <switch>
          <case>
            <collectFieldsByRegex src="$_body">
              <regex><![CDATA[.*to=<receiverMailAddr:gPatStr>,\s*ctladdr=<senderMailAddr:gPatStr>\s*\(\d+/\d+\),\s*.*relay=.*\[<srcIpAddr:gPatIpAddr>\],\s*.*stat=<_stat:gPatStr>\s*.*accepted.*]]></regex>
            </collectFieldsByRegex>
          </case>
          <case>
            <collectFieldsByRegex src="$_body">
              <regex><![CDATA[.*to=\<<receiverMailAddr:gPatStr>\@.*\>,\s*.*relay=.*\[<srcIpAddr:gPatIpAddr>\],\s*.*stat=<_stat:gPatStr>\s*.*accepted.*]]></regex>
            </collectFieldsByRegex>
          </case>
        </switch>
        <setEventAttribute attr="eventType">SENDMAIL_ACCEPT</setEventAttribute>
      </case>
      <default/>
    </switch>
  </parsingInstructions>

</eventParser>
