<eventParser name="WinSyslogParser">
  <deviceType>
    <Vendor>Microsoft</Vendor>
    <Model>Windows</Model>
    <Version>ANY</Version>
  </deviceType>

  <eventFormatRecognizer><![CDATA[MSWinEventLog]]></eventFormatRecognizer>

  <testEvents>
    <testEvent><![CDATA[<13>Jul 23 17:38:35 20.20.20.20 MSWinEventLog	1	Security	34035	Thu Jul 23 17:38:31 2009	644	Security	SYSTEM	User	Success Audit	ADS-PRI	Account Management		User Account Locked Out:     Target Account Name: joeUser     Target Account ID: %{S-1-5-21-3383442562-1768178646-255068551-1250}     Caller Machine Name: ADS-Pri     Caller User Name: ADS-PRI$     Caller Domain: ABC     Caller Logon ID: (0x0,0x3E7)    	33720]]></testEvent>
    <testEvent><![CDATA[<13>Dec 13 10:01:36 449860-db2 MSWinEventLog	1	Application	10101	Tue Dec 13 10:01:36 2012	18456	MSSQLSERVER	N/A	N/A	Failure Audit	449860-db2	Logon	Login failed for user 'OFXSRVR_USER'.  Reason: Failed to open the explicitly specified database. [CLIENT: 1.2.3.4]	7786"]]></testEvent>
    <testEvent><![CDATA[<40>Apr 18 14:44:13 myhost MSWinEventLog	2	Security	245122	Do Apr 18 14:44:12 2013	4767	Microsoft-Windows-Security-Auditing	MYHOST\abc	N/A	Success Audit	myhost Account Management A user account was unlocked. Subject: Security ID: S-1-5-21-583907252-1004336348-725345543-5525 Account Name: passsync Account Domain: MYHOST Logon ID: 0x1f522fa Target Account: Security ID: S-1-5-21-583907252-1004336348-725345543-14992 Account Name: abc Account Domain: MYHOST	215623]]></testEvent>
  </testEvents>

  <!-- pattern definitions -->
  <patternDefinitions>
    <pattern name="patMonabbrDay"><![CDATA[(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)(?:\s*)\d{1,2}]]></pattern>
    <pattern name="patMonth"><![CDATA[(?i:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|\d{1,2}]]></pattern>
    <pattern name="patWordThree"><![CDATA[\w{3}]]></pattern>
    <pattern name="patWordTab"><![CDATA[[^\t]+]]></pattern>
    <pattern name="patOptLeftAngleBracket"><![CDATA[<]]></pattern>
    <pattern name="patOptRightAngleBracket"><![CDATA[>]]></pattern>
    <pattern name="patStrQuote"><![CDATA[[^']+]]></pattern>
    <pattern name="patStrRightSquareBracket"><![CDATA[[^\]]+]]></pattern>
    <pattern name="patStrRightAngleBracket"><![CDATA[[^>]+]]></pattern>
    <pattern name="patComma"><![CDATA[[^,\s]*]]></pattern>
  </patternDefinitions>

  <parsingInstructions>

    <switch>
      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatSyslogPRI><:gPatMon>\s+<:gPatDay> <:gPatTime> <_host:gPatStr> <_agentSig:gPatWord>\s+<_mesgType:gPatInt>\s+<_OSModule:patWordTab>\s+<seqNum:gPatInt>\s+<_dayName:gPatWord>:? <_mon:gPatMon><:gPatSpace><_day:gPatDay> <_time:gPatTime> <_year:gPatYear>\s+<_id:gPatInt>\s+<eventSource:patWordTab>\s+<:patWordTab>\s+<:patWordTab>\s+<_action:patWordTab>\s+<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>

        <switch>
          <case>
            <collectFieldsByRegex src="$_host">
              <regex><![CDATA[^<reptDevIpAddr:gPatIpAddr>$]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="destIpAddr">$reptDevIpAddr</setEventAttribute>
          </case>
          <case>
            <collectFieldsByRegex src="$_host">
              <regex><![CDATA[^<reptDevName:gPatHostName>$]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="destName">$reptDevName</setEventAttribute>
          </case>
          <default/>
        </switch>
      </case>

      <case>
        <collectFieldsByRegex src="$_rawmsg">
          <regex><![CDATA[<:gPatStr>\s+<_agentSig:gPatWord>\s+<_mesgType:gPatInt>\s+<_OSModule:patWordTab>\s+<seqNum:gPatInt>\s+<_dayName:gPatWord>\s+<_mon:patMonth><:gPatSpace><_day:gPatDay>\s+<_time:gPatTime>\s+<_year:gPatYear>\s+<_id:gPatInt>\s+<eventSource:patWordTab>\s+<:patWordTab>\s+<:patWordTab>\s+<_action:patWordTab>\s+<_body:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </case>
    </switch>

    <choose>
      <when test="not_exist _OSModule"/>
      <when test="matches($_OSModule, '^[a-z]')">
        <!-- if starts with lower case, change the first letter to upper case -->
        <setEventAttribute attr="_first">replaceStringByRegex($_OSModule, "(?&lt;=.).*", "")</setEventAttribute>
        <setEventAttribute attr="_first">toUpper($_first)</setEventAttribute>
        <setEventAttribute attr="_rest">replaceStringByRegex($_OSModule, "^.", "")</setEventAttribute>
        <setEventAttribute attr="_OSModule">combineMsgId($_first, $_rest)</setEventAttribute>
      </when>
    </choose>

    <when test="exist eventSource">
      <setEventAttribute attr="_sourceName">replaceStringByRegex($eventSource, "\s+", "-")</setEventAttribute>
      <setEventAttribute attr="_sourceName">replaceStringByRegex($_sourceName, "[()]", "")</setEventAttribute>
    </when>

    <choose>
      <when test="not_exist _action"/>
      <when test="matches($_action, '^Success')">
        <setEventAttribute attr="eventAction">0</setEventAttribute>
      </when>
      <when test="matches($_action, '^Failure')">
        <setEventAttribute attr="eventAction">1</setEventAttribute>
      </when>
    </choose>

    <choose>
      <when test="$_OSModule = 'Security'">
        <setEventAttribute attr="eventType">combineMsgId("Win-Security-", $_id)</setEventAttribute>
      </when>

      <otherwise>

        <choose>
          <when test="$_OSModule = 'Application'">
            <choose>
              <when test="matches($eventSource, '^MSSQL\$\w+$')">
                <setEventAttribute attr="eventType">combineMsgId("Win-App-MSSQLSERVER-", $_id)</setEventAttribute>
              </when>
              <when test="matches($eventSource, '^SQLAgent\$\w+$')">
                <setEventAttribute attr="eventType">combineMsgId("Win-App-SQLSERVERAGENT-", $_id)</setEventAttribute>
              </when>
              <when test="matches($eventSource, '^Report Server Windows Service \(MSSQLSERVER\)$')">
                <setEventAttribute attr="eventType">combineMsgId("Win-App-MSSQL-SSRS-", $_id)</setEventAttribute>
              </when>
              <otherwise>
                <setEventAttribute attr="eventType">combineMsgId("Win-App-", $_sourceName, "-", $_id)</setEventAttribute>
              </otherwise>
            </choose>
          </when>
          <when test="$_OSModule = 'Microsoft-Windows-Sysmon/Operational'">
            <setEventAttribute attr="eventType">combineMsgId("Win-Sysmon-", $_id)</setEventAttribute>
          </when>
          <when test="$_OSModule = 'Microsoft-Windows-DNSServer/Audit'">
            <setEventAttribute attr="eventType">combineMsgId("Win-DNS-", $_id)</setEventAttribute>
          </when>
          <when test="$_sourceName = 'Microsoft-Windows-TerminalServices-LocalSessionManager'">
            <setEventAttribute attr="eventType">combineMsgId("Win-TerminalServices-LocalSessionManager-", $_id)</setEventAttribute>
          </when>
          <when test="$_sourceName = 'Microsoft-Windows-TerminalServices-Gateway'">
            <setEventAttribute attr="eventType">combineMsgId("Win-TerminalServices-Gateway-", $_id)</setEventAttribute>
          </when>
          <when test="$_sourceName = 'Microsoft-Windows-Windows-Defender'">
            <setEventAttribute attr="eventType">combineMsgId("Win-Defender-", $_id)</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="_OSModule">replaceStringByRegex($_OSModule, "\s+", "-")</setEventAttribute>
            <setEventAttribute attr="eventType">combineMsgId("Win-", $_OSModule, "-", $_sourceName, "-", $_id)</setEventAttribute>
          </otherwise>
        </choose>
      </otherwise>
    </choose>

    <setEventAttribute attr="deviceTime">toDateTime($_mon, $_day, $_year, $_time)</setEventAttribute>

    <!-- default (overridden later) -->
    <setEventAttribute attr="eventSeverity">1</setEventAttribute>

    <choose>
      <when test="$_OSModule = 'Microsoft-Windows-Sysmon/Operational'">
        <collectAndSetAttrByKeyValuePair sep="  \\|\t" src="$_body">
          <attrKeyMap attr="command" key="CommandLine: "/>
          <attrKeyMap attr="dirName" key="CurrentDirectory: "/>
          <attrKeyMap attr="destName" key="DestinationHostname: "/>
          <attrKeyMap attr="destIpAddr" key="DestinationIp: "/>
          <attrKeyMap attr="destIpPort" key="DestinationPort: "/>
          <attrKeyMap attr="details" key="Details: "/>
          <attrKeyMap attr="_hash" key="Hashes: "/>
          <attrKeyMap attr="procName" key="Image: "/>
          <attrKeyMap attr="winLogonId" key="LogonId: "/>
          <attrKeyMap attr="parentCommand" key="ParentCommandLine: "/>
          <attrKeyMap attr="parentProcName" key="ParentImage: "/>
          <attrKeyMap attr="product" key="Product: "/>
          <attrKeyMap attr="srcName" key="SourceHostname: "/>
          <attrKeyMap attr="srcIpAddr" key="SourceIp: "/>
          <attrKeyMap attr="srcIpPort" key="SourcePort: "/>
          <attrKeyMap attr="fileName" key="TargetFilename: "/>
          <attrKeyMap attr="regKeyPath" key="TargetObject: "/>
          <attrKeyMap attr="user" key="User: "/>
        </collectAndSetAttrByKeyValuePair>

        <when test="exist _hash">
          <collectAndSetAttrByKeyValuePair sep="," src="$_body">
            <attrKeyMap attr="hashMD5" key="MD5="/>
            <attrKeyMap attr="hashSHA256" key="SHA256="/>
          </collectAndSetAttrByKeyValuePair>
        </when>
      </when>
    </choose>

    <choose>
      <when test="$_id IN '21,22'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User: "/>
          <attrKeyMap attr="sessionId" key="Session ID: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>
      <when test="$_id IN '200,300,302,312,313'">
        <switch>
          <case>
            <collectFieldsByRegex src="$_body">
              <regex><![CDATA[The\s+user\s+"<user:gPatStr>",\s*on\s+client\s+computer\s+"<srcIpAddr:gPatIpV4Dot>(?::<srcIpPort:gPatInt>)?",<usrMsg:gPatMesgBody>]]></regex>
            </collectFieldsByRegex>
          </case>
          <default>
            <setEventAttribute attr="usrMsg">$_body</setEventAttribute>
          </default>
        </switch>
      </when>
      <when test="$_id = '501'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '512'">
        <!-- windows staring up -->
        <setEventAttribute attr="eventSeverity">2</setEventAttribute>
      </when>

      <when test="$_id = '513'">
        <!-- windows shutting down -->
        <setEventAttribute attr="eventSeverity">2</setEventAttribute>
      </when>

      <when test="$_id = '514'">
        <!-- auth package loaded <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	514	Security	SYSTEM	User	Success Audit	ADS-PRI	An authentication package has been loaded by the Local Security Authority		Authentication Package Name: NTLM -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="procName" key="Authentication Package Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">6</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '515'">
        <!-- trusted logon process registered <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	515	Security	SYSTEM	User	Success Audit	ADS-PRI	A trusted logon process has registered with the Local Security Authority		Logon Process Name: KSecDD -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="procName" key="Logon Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">6</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '516'">
        <!-- internal resources for queueing audit messages exhausted -->
        <setEventAttribute attr="eventSeverity">7</setEventAttribute>
      </when>

      <when test="$_id = '517'">
        <!-- audit log cleared <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	517	Security	SYSTEM	User	Success Audit	ADS-PRI	The audit log was cleared		Client User Name: joeUser   Client Domain: ABC		Client Logon ID: (0x0, 0x158E87) -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Client User Name: "/>
          <attrKeyMap attr="domain" key="Client Domain: "/>
          <attrKeyMap attr="winLogonId" key="Client Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '518'">
        <!-- notofication package loaded <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	515	Security	SYSTEM	User	Success Audit	ADS-PRI	A notification package has been loaded by the Security Account Manager		Notification Package Name: scecli -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="procName" key="Notification Package Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">6</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '519'">
        <!-- process using invalid LPC port -->
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '520'">
        <!-- system time changed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	520	Security	SYSTEM	User	Success Audit	ADS-PRI	The system time was changed		Client User Name: joeUser   Client Domain: ABC		Client Logon ID: (0x0, 0x158E87)  Process name: C:\WINDOWS\system32\rundll32.exe -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Client User Name: "/>
          <attrKeyMap attr="domain" key="Client Domain: "/>
          <attrKeyMap attr="winLogonId" key="Client Logon ID: "/>
          <attrKeyMap attr="procName" key="Process  Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">6</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '528, 538'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="winLogonType" key="Logon Type: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id IN '529, 530, 531, 532, 533, 534, 535, 536, 537'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonCallerUser" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="winLogonType" key="Logon Type: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="srcName" key="Workstation Name: "/>
          <attrKeyMap attr="computer" key="Workstation Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '539'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="winLogonType" key="Logon Type: "/>
          <attrKeyMap attr="srcName" key="Workstation Name: "/>
          <attrKeyMap attr="computer" key="Workstation Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">10</setEventAttribute>
      </when>

      <when test="$_id = '540'">
        <!-- <13>Jan 21 09:45:48 ADS-Pri.example.com MSWinEventLog	1	Security	59874	Mon Jan 21 09:45:48 2008	540	Security	schen	User	Success Audit	ADS-PRI	Logon/Logoff		Successful Network Logon:     User Name: joeUser     Domain: ABC     Logon ID: (0x0,0x14066CF)     Logon Type: 3     Logon Process: Kerberos     Authentication Package: Kerberos     Workstation Name:      Logon GUID: {11111111-1111-1111-1111-111111111111}     Caller User Name: -     Caller Domain: -     Caller Logon ID: -     Caller Process ID: -     Transited Services: -     Source Network Address: 192.168.20.13     Source Port: 1159    	59676 -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="srcUser" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="winLogonType" key="Logon Type: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
          <attrKeyMap attr="srcName" key="Workstation Name: "/>
          <attrKeyMap attr="computer" key="Workstation Name: "/>
          <attrKeyMap attr="winLogonCallerUser" key="Caller User Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        <when test="exist srcName">
          <switch>
            <case>
              <collectFieldsByRegex src="$srcName">
                <regex><![CDATA[[\\]<srcName:gPatMesgBody>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>
      </when>

      <when test="$_id = '552'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target User Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '560'">
        <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	560	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Open		Client User Name: joeUser   Client Domain: ABC		Client Logon ID: (0x0,0x158E87)  Object Type: File  Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe Object Name: C:\ConfidentialFiles\ProjectPlan.doc.txt  Accesses: WriteData (or AddFile) AppendData (or AddSubdirectory or CreatePipeInstance) -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="_user" key="Client User Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">2</setEventAttribute>
        <choose>
          <when test="exist _user">
            <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
              <attrKeyMap attr="user" key="Client User Name: "/>
              <attrKeyMap attr="domain" key="Client Domain: "/>
              <attrKeyMap attr="winLogonId" key="Client Logon ID: "/>
              <attrKeyMap attr="procName" key="Image File Name: "/>
              <attrKeyMap attr="osObjType" key="Object Type: "/>
              <attrKeyMap attr="osObjName" key="Object Name: "/>
              <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
              <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <otherwise>
            <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
              <attrKeyMap attr="user" key="Primary User Name: "/>
              <attrKeyMap attr="domain" key="Primary Domain: "/>
              <attrKeyMap attr="winLogonId" key="Primary Logon ID: "/>
              <attrKeyMap attr="procName" key="Image File Name: "/>
              <attrKeyMap attr="osObjType" key="Object Type: "/>
              <attrKeyMap attr="osObjName" key=" Object Name: "/>
              <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
              <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
            </collectAndSetAttrByKeyValuePair>
          </otherwise>
        </choose>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '562'">
        <!-- windows object closed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	562	Security	SYSTEM	User	Success Audit	ADS-PRI	Handle Closed	 Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="procName" key="Image File Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="user" key="User: "/>
        </collectAndSetAttrByKeyValuePair>
        <when test="exist user">
          <switch>
            <case>
              <collectFieldsByRegex src="$user">
                <regex><![CDATA[<domain:gPatStr>[\\]<user:gPatStr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-560">
          <when test="$osObjHandleID = $AnotherEventType.osObjHandleID">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
            <setEventAttribute attr="user">$AnotherEventType.user</setEventAttribute>
            <setEventAttribute attr="domain">$AnotherEventType.domain</setEventAttribute>
            <setEventAttribute attr="winLogonId">$AnotherEventType.winLogonId</setEventAttribute>
            <setEventAttribute attr="osObjName">$AnotherEventType.osObjName</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '563'">
        <!-- windows object open for delete <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	563	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Open for Delete		Client User Name: joeUser   Client Domain: ABC		Client Logon ID: (0x0, 0x158E87)  Object Type: File  New Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe Object Name:C:\ConfidentialFiles\ ProjectPlan.doc.txt  Accesses: WriteData (or AddFile) AppendData (or AddSubdirectory or CreatePipeInstance) -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="_user" key="Client User Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="exist _user">
            <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
              <attrKeyMap attr="user" key="Client User Name: "/>
              <attrKeyMap attr="domain" key="Client Domain: "/>
              <attrKeyMap attr="winLogonId" key="Client Logon ID: "/>
              <attrKeyMap attr="procName" key="Image File Name: "/>
              <attrKeyMap attr="osObjType" key="Object Type: "/>
              <attrKeyMap attr="osObjName" key="Object Name: "/>
              <attrKeyMap attr="osObjHandleID" key="New Handle ID: "/>
              <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <otherwise>
            <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
              <attrKeyMap attr="user" key="Primary User Name: "/>
              <attrKeyMap attr="domain" key="Primary Domain: "/>
              <attrKeyMap attr="winLogonId" key="Primary Logon ID: "/>
              <attrKeyMap attr="procName" key="Image File Name: "/>
              <attrKeyMap attr="osObjType" key="Object Type: "/>
              <attrKeyMap attr="osObjName" key=" Object Name: "/>
              <attrKeyMap attr="osObjHandleID" key="New Handle ID: "/>
              <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
            </collectAndSetAttrByKeyValuePair>
          </otherwise>
          <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
            <when test="$winLogonId = $AnotherEventType.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
            </when>
          </collectAndSetAttrFromAnotherEvent>
        </choose>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '564'">
        <!-- windows object deleted <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	564	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Deleted	 Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="procName" key="Image File Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="user" key="User: "/>
        </collectAndSetAttrByKeyValuePair>
        <when test="exist user">
          <switch>
            <case>
              <collectFieldsByRegex src="$user">
                <regex><![CDATA[<domain:gPatStr>[\\]<user:gPatStr>]]></regex>
              </collectFieldsByRegex>
            </case>
            <default/>
          </switch>
        </when>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-560">
          <when test="$osObjHandleID = $AnotherEventType.osObjHandleID">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
            <setEventAttribute attr="user">$AnotherEventType.user</setEventAttribute>
            <setEventAttribute attr="domain">$AnotherEventType.domain</setEventAttribute>
            <setEventAttribute attr="winLogonId">$AnotherEventType.winLogonId</setEventAttribute>
            <setEventAttribute attr="osObjName">$AnotherEventType.osObjName</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '567'">
        <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	567	Security	SYSTEM	User	Success Audit	ADS-PRI	Object Access Attempt	 Object Type: File  Handle ID: 144 	Image File Name: C:\WINDOWS\system32\notepad.exe Accesses: WriteData (or AddFile) AppendData (or AddSubdirectory or CreatePipeInstance) -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="procName" key="Image File Name: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
          <attrKeyMap attr="user" key="User: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-560">
          <when test="$osObjHandleID = $AnotherEvent.osObjHandleID">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
            <setEventAttribute attr="user">$AnotherEvent.user</setEventAttribute>
            <setEventAttribute attr="domain">$AnotherEvent.domain</setEventAttribute>
            <setEventAttribute attr="winLogonId">$AnotherEvent.winLogonId</setEventAttribute>
            <setEventAttribute attr="osObjName">$AnotherEvent.osObjName</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '576'">
        <!-- Special privileges assigned to new logon -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
      </when>

      <when test="$_id = '578'">
        <!-- PRIVILEDGED OBJECT OPERATION <13>Mar 10 15:40:44 ADS-Pri.example.com MSWinEventLog     1       Security        1250    Mon Mar 10 15:40:24 2008        578     Security        Administrator  User    Failure Audit   ADS-PRI Privilege Use           Privileged object operation:     Object Server: Security     Object Handle: 0     Process ID: 2080     Primary User Name: Administrator     Primary Domain: ABC     Primary Logon ID: (0x0,0x3F98A7)     Client User Name: -     Client Domain: -     Client Logon ID: -     Privileges: SeTcbPrivilege         1237 -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="_user" key="Client User Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        <choose>
          <when test="exist _user">
            <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
              <attrKeyMap attr="user" key="Client User Name: "/>
              <attrKeyMap attr="domain" key="Client Domain: "/>
              <attrKeyMap attr="winLogonId" key="Client Logon ID: "/>
            </collectAndSetAttrByKeyValuePair>
          </when>
          <otherwise>
            <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
              <attrKeyMap attr="user" key="Primary User Name: "/>
              <attrKeyMap attr="domain" key="Primary Domain: "/>
              <attrKeyMap attr="winLogonId" key="Primary Logon ID: "/>
            </collectAndSetAttrByKeyValuePair>
          </otherwise>
        </choose>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528 ">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '592, 593'">
        <!-- A new process has been created <13>Mar 10 17:06:43 ADS-Pri.example.com MSWinEventLog	1	Security	8485	Mon Mar 10 17:06:36 2008	592	Security	SYSTEM	User	Success Audit	ADS-PRI	Detailed Tracking		A new process has been created:     New Process ID: 5788     Image File Name: C:\Program Files\Splunk\bin\splunk-optimize.exe     Creator Process ID: 4416     User Name: ADS-PRI$     Domain: ABC     Logon ID: (0x0,0x3E7)    	8470 <13>Mar 10 16:56:13 ADS-Pri.example.com MSWinEventLog	1	Security	7827	Mon Mar 10 16:56:05 2008	593	Security	SYSTEM	User	Success Audit	ADS-PRI	Detailed Tracking		A process has exited:     Process ID: 5160     Image File Name: C:\Program Files\Splunk\bin\splunk-optimize.exe     User Name: ADS-PRI$     Domain: ABC     Logon ID: (0x0,0x3E7)    	7813 -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="fileName" key="Image File Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="Image File Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '608'">
        <!-- user right assigned <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	608	Security	SYSTEM	User	Success Audit	ADS-PRI	User Right Assigned		User Name: joeUser   Domain: ABC	Logon ID: (0x0, 0x158E87) 	Assigned To: ABC\joeUser  Assigned By:  User Right: Assigned User Right: SetUndockPrivilege -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="targetUser" key="Assigned To: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$targetUser">
          <regex><![CDATA[<targetDomain:gPatStr>[\\]<targetUser:gPatStr>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '609'">
        <!-- user right removed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	609	Security	SYSTEM	User	Success Audit	ADS-PRI	User Right Removed		User Name: joeUser   Domain: ABC	Logon ID: (0x0, 0x158E87) 	User Right: Removed   User Right: joeUser Removed From AdminGrp -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="_userRight" key="User Right: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_userRight">
          <regex><![CDATA[ <targetUser:gPatWord> Removed From <targetUserGrp:gPatWord>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '610, 611, 620'">
        <!-- windows trust domain added/modified/removed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	610	Security	SYSTEM	User	Success Audit	ADS-PRI	New Trusted Domain		User Name: joeUser   Domain: ABC		Logon ID: (0x0, 0x158E87) 	Domain Name: joeUser  Domain ID: ABC -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="targetDomain" key="Domain Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">8</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '612, 617, 618, 619'">
        <!-- kerberos policy, QoS policy, audit policy <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	612	Security	SYSTEM	User	Success Audit	ADS-PRI	Windows Audit Policy Changed		User Name: joeUser   Domain: ABC		Logon ID: (0x0, 0x158E87) -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '613'">
        <!-- ipsec policy agent started -->
        <setEventAttribute attr="eventSeverity">2</setEventAttribute>
      </when>

      <when test="$_id = '614'">
        <!-- windows policy agent disabled -->
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '615'">
        <!-- windows ipsec policy changed -->
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '616'">
        <!-- windows policy agent serious failure -->
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id IN '621, 622'">
        <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	621	Security	SYSTEM	User	Success Audit	ADS-PRI	System Security Access Granted		User Name: joeUser   Domain: ABC	Logon ID: (0x0, 0x158E87) 	Account Modified: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="targetUser" key="Account Modified: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$targetUser">
          <regex><![CDATA[<targetDomain:gPatStr>[\\]<targetUser:gPatStr>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">8</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '624, 645'">
        <!-- USER / COMPUTER ACCOUNT CREATED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	624	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Created		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0,0x158E87) 	New Account Name: joeUser 	New Domain: ABC	New Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="New Account Name: "/>
          <attrKeyMap attr="targetDomain" key="New Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '625, 626, 642, 627, 629, 630, 643, 646, 647'">
        <!-- USER ACCOUNT TYPE CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	625	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Type Change		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <!-- USER ACCOUNT ENABLED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	626	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Ennabled		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser 	Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <!-- USER ACCOUNT DISABLED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	629	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Disabled		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <!-- USER ACCOUNT CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	642	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Changed		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <!-- CHANGE PASSWORD ATTEMPT <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	627	Security	SYSTEM	User	Success Audit	ADS-PRI	Change Password Attempt		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <!-- USER ACCOUNT PASSWORD RESET <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	628	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Password Set		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <!-- USER ACCOUNT Deleted <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	630	Security	SYSTEM	User	Success Audit	ADS-PRI	User Account Deleted		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <!-- DOMAIN POLICY CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	643	Security	SYSTEM	User	Success Audit	ADS-PRI	Domain Policy Changed		Caller User Name: Administrator	Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser  New Type: Writer -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '631, 635, 648, 653, 658, 663'">
        <!-- Security enabled/disabled local/global/universal group created -->
        <!-- <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	631	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group created		Caller User Name: joeUser  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	New Account Name: joeUser  New Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUserGrp" key="New Account Name: "/>
          <attrKeyMap attr="targetDomain" key="New Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '632, 636, 650, 655, 660, 665'">
        <!-- A member added to a security-enabled/disabled local/global/universal group -->
        <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP MEMBER ADDED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	632	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group member added		Caller User Name: joeUser    Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Member Name: "/>
          <attrKeyMap attr="targetUserGrp" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '633, 637, 651, 656, 661, 666'">
        <!-- A member was removed from a security-enabled global group -->
        <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP MEMBER REMOVED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	633	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group member removed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Member Name:: "/>
          <attrKeyMap attr="targetUserGrp" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '634, 638, 652, 657, 662, 667, 639, 641, 649, 654, 659, 664'">
        <!-- Group deleted or modified -->
        <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP DELETED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	634	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group deleted		Caller User Name: joeUser  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <!-- SECURITY ENABLED/DISABLED LOCAL/GLOBAL/UNIVERSAL GROUP CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	641	Security	SYSTEM	User	Success Audit	ADS-PRI	Security enabled global group changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUserGrp" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '640, 668'">
        <!-- 640: account database change, 668: group type change <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	668	Security	SYSTEM	User	Success Audit	ADS-PRI	Group Type changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '644'">
        <!-- USER ACCOUNT LOCKED OUT <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	644	Security	SYSTEM	User	Success Audit	ADS-PRI	Domain Policy Changed		Caller User Name: joeUser-laptop$	 Caller Machine Name: joeUser-laptop  Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="srcName" key="Caller Machine Name: "/>
          <attrKeyMap attr="user" key="Target Account Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">10</setEventAttribute>
      </when>

      <when test="$_id = '669'">
        <!-- 670: add SID hostory success <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	668	Security	SYSTEM	User	Success Audit	ADS-PRI	Group Type changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">4</setEventAttribute>
      </when>

      <when test="$_id IN '670, 671'">
        <!-- 670: add SID hostory failure, 671: account unlocked <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	668	Security	SYSTEM	User	Success Audit	ADS-PRI	Group Type changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '672'">
        <!-- domain auth success/failure -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="winKerbFailCode" key="Result Code: "/>
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="domain" key="Supplied Realm Name: "/>
          <attrKeyMap attr="user" key="User Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="$winKerbFailCode IN '-,0x0'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_id = '673'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="User Domain: "/>
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">2</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '674'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="User Domain: "/>
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '675'">
        <!-- FAILED DOMAIN AUTH VIA KERBEROS <13>Nov 29 00:01:12 ADS-Pri.example.com MSWinEventLog	1	Security	16714	Thu Nov 29 00:01:04 2007	675	Security	SYSTEM	User	Failure Audit	ADS-PRI	Pre-authentication failed:  User Name: joeUser     User ID: ABC\joeUser Service Name: joeUser/ABC Pre-Authentication Type: 0x02 Failure Code: 24 Client Address: 192.168.20.33 -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="_combUsrId" key="User ID: "/>
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="winKerbFailCode" key="Failure Code: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        <switch>
          <case>
            <collectFieldsByRegex src="$_combUsrId">
              <regex><![CDATA[<domain:gPatStr>\\]]></regex>
            </collectFieldsByRegex>
          </case>
          <default/>
        </switch>
      </when>

      <when test="$_id = '676'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Supplied Realm Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '677'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Supplied Realm Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '680'">
        <!-- SUCCESSFUL / FAILED DOMAIN RESOURCE ACCESS VIA NTLM <13>Nov 29 00:01:12 ADS-Pri.example.com MSWinEventLog	1	Security	16714	Thu Nov 29 00:01:04 2007	680	Security	SYSTEM	User	Failure Audit	ADS-PRI  Account Used For Logon By  Logon Account: joeUser  Source Workstation: ABC_LAPTOP Error Code: 0xC0000064 -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="winLogonFailCode2" key="Error Code: "/>
          <attrKeyMap attr="user" key="Logon Account: "/>
          <attrKeyMap attr="srcName" key="Source Workstation: "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="$winLogonFailCode2 IN '-, 0x0'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </otherwise>
        </choose>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Logon Account: "/>
          <attrKeyMap attr="srcName" key="Source Workstation: "/>
          <attrKeyMap attr="winLogonFailCode2" key="Error Code: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id IN '682, 683'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="User Name: "/>
          <attrKeyMap attr="domain" key="Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="srcName" key="Client Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '684'">
        <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	684	Security	SYSTEM	User	Success Audit	ADS-PRI	Set ACLs of members in administrators groups:		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: DC=ABC, DC=local	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="_targetAcct" key="Target Account ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_targetAcct">
          <regex><![CDATA[<targetDomain:gPatWord>\<:gPatWord>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="exist winLogonId">
            <when test="$winLogonId = $AnotherEventType.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
            </when>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '685'">
        <!-- ACCOUNT NAME CHANGED <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	668	Security	SYSTEM	User	Success Audit	ADS-PRI	Windows account name changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Old Account Name: joeUser  New Account Name: newjoeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Old Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">2</setEventAttribute>
      </when>

      <when test="$_id = '686'">
        <!-- password of user accessed <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	686	Security	SYSTEM	User	Success Audit	ADS-PRI	Windows user password accessed		Caller User Name: joeUser   Caller Domain: ABC	Caller Logon ID: (0x0, 0x158E87) 	Target User Name: joeUser  Target Domain: ABC -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target User Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="exist winLogonId">
            <when test="$winLogonId = $AnotherEventType.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
            </when>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id IN '687, 688'">
        <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	688	Security	SYSTEM	User	Success Audit	ADS-PRI	Basic Application Group Changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="New Account Name: "/>
          <attrKeyMap attr="targetDomain" key="New Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="exist winLogonId">
            <when test="$winLogonId = $AnotherEventType.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
            </when>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id IN '689, 690, 691, 692, 693, 694, 695, 696'">
        <!-- various <13>Dec 12 10:09:00 ADS-Pri.example.com MSWinEventLog	1	Security	1756	Wed Dec 12 10:08:53 2007	689	Security	SYSTEM	User	Success Audit	ADS-PRI	Basic Application Group Changed		Caller User Name: joeUser   Caller Domain: ABC		Caller Logon ID: (0x0, 0x158E87) 	Target Account Name: joeUser  Target Domain: ABC	Target Account ID: ABC\joeUser -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Caller User Name: "/>
          <attrKeyMap attr="domain" key="Caller Domain: "/>
          <attrKeyMap attr="winLogonId" key="Caller Logon ID: "/>
          <attrKeyMap attr="targetUser" key="Target Account Name: "/>
          <attrKeyMap attr="targetDomain" key="Target Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-540 OR Win-Security-528">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '806'">
        <!-- per user audit policy refreshed -->
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '807'">
        <!-- per user audit policy set -->
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '1001, 1003'">
        <!-- Process started or stopped -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[<:patWordTab>\s+<:patWordTab>\s+The <procName:gPatMesgBody> has<:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="hostIpAddr">$reptDevIpAddr</setEventAttribute>
      </when>

      <when test="$_id = '2020'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[<:patWordTab>\s+<:patWordTab>\s+<procName:gPatMesgBody> has terminated<:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="hostIpAddr">$reptDevIpAddr</setEventAttribute>
      </when>

      <when test="$_id = '4624'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>New Logon:<_newLogon:gPatMesgBody>Process Information:<_processInfo:gPatMesgBody>Network Information:<_netInfo:gPatMesgBody>Detailed Authentication Information:<_detailedAuth:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="winLogonType" key="Logon Type:   "/>
          <attrKeyMap attr="winLogonCallerUser" key="Account Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_newLogon">
          <attrKeyMap attr="srcUser" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_processInfo">
          <attrKeyMap attr="procName" key="Process Name:  "/>
          <attrKeyMap attr="procId" key="Process ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_netInfo">
          <attrKeyMap attr="srcName" key="Workstation Name: "/>
          <attrKeyMap attr="computer" key="Workstation Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port:  "/>
        </collectAndSetAttrByKeyValuePair>
        <!-- win logon proc is the logon method/ssp e.g. winlogon, schannel, advadpi, kerberos, ntlmssp -->
        <collectAndSetAttrByKeyValuePair sep=" " src="$_detailedAuth">
          <attrKeyMap attr="winLogonProc" key="Logon Process:  "/>
        </collectAndSetAttrByKeyValuePair>

        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        <when test="exist srcName">
          <setEventAttribute attr="srcName">replaceStrInStr($srcName, "\\", "")</setEventAttribute>
        </when>
      </when>

      <when test="$_id = '4625'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Account For Which Logon Failed:<_failedLogon:gPatMesgBody>Failure Information:<_failInfo:gPatMesgBody>Process Information:<_processInfo:gPatMesgBody>Network Information:<_netInfo:gPatMesgBody>Detailed Authentication Information:<_detailedAuth:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="winLogonType" key="Logon Type:   "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_failedLogon">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="securityId" key="Security ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_failInfo">
          <regex><![CDATA[Failure Reason:\s+<errReason:gPatMesgBody>\s+Status:\s+<status:gPatStr>\s+Sub Status:\s+<subStatus:gPatStr>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_processInfo">
          <attrKeyMap attr="procName" key="Caller Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_netInfo">
          <attrKeyMap attr="srcName" key="Workstation Name: "/>
          <attrKeyMap attr="computer" key="Workstation Name: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_detailedAuth">
          <attrKeyMap attr="winLogonProc" key="Logon Process: "/>
          <attrKeyMap attr="authenMethod" key="Authentication Package: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
        <setEventAttribute attr="srcName">replaceStrInStr($srcName, "\\", "")</setEventAttribute>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="exist winLogonId">
            <when test="$winLogonId = $AnotherEvent.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
            </when>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <when test="exist subStatus">
          <setEventAttribute attr="winLogonFailCode2">$subStatus</setEventAttribute>
        </when>
      </when>

      <when test="$_id IN '4634, 4647, 4719, 4793'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
          <attrKeyMap attr="winLogonType" key="Logon Type:   "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4648'">
        <!-- A logon was attempted using explicit credentials -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Account Whose Credentials Were Used:<_target:gPatMesgBody>Target Server:<_server:gPatMesgBody>Process Information:<_processInfo:gPatMesgBody>Network Information:<_netInfo:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_target">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_processInfo">
          <attrKeyMap attr="procName" key="Process Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_netInfo">
          <attrKeyMap attr="srcIpAddr" key="Network Address: "/>
          <attrKeyMap attr="srcIpPort" key="Port:   "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '4656'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4658'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4660'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '4661'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
          <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4662'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4663'">
        <!-- Logon related -->
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="osObjAccessType" key="Accesses: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4670'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="osObjHandleID" key="Handle ID: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="newSecurityDescriptor" key="New Security Descriptor: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="originalSecurityDescriptor" key="Original Security Descriptor: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '4672'">
        <!-- Special privileges assigned to new logon -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Privileges:<_priv:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="exist winLogonId">
            <when test="$winLogonId = $AnotherEvent.winLogonId">
              <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
            </when>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4673'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4674'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjHandleID" key="Object Handle: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4688'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="New Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '4689'">
        <collectAndSetAttrByKeyValuePair sep="  " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '4696'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="targetDomain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="targetUser" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
          <attrKeyMap attr="targetProcName" key="Target Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '4701'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="securityId" key="Security ID: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="task" key="Task Name: "/>
          <attrKeyMap attr="details" key="Task Content: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">6</setEventAttribute>
      </when>

      <when test="$_id = '4720'">
        <!-- user account created -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>New Account:<_acct:gPatMesgBody>Attributes:<_attrib:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_attrib">
          <regex><![CDATA[\bDisplay Name:\s+<userFullName:gPatMesgBody>\s+User Principal.*User Account Control:<:gPatMesgBody>User Parameters:]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '4722, 4723, 4724, 4725, 4738'">
        <!-- 4725: A user account was disabled 4738: A user account was changed 4722: A user account was enabled 4723: Password changed 4724: Password reset -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Target Account:<_target:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" \\|\t" src="$_target">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
          <attrKeyMap attr="userAcctControl" key="User Account Control: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4726'">
        <!-- user account deleted -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Target Account:<_acct:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">4</setEventAttribute>
      </when>

      <when test="$_id IN '4731, 4744, 4727, 4754, 4759, 4749'">
        <!-- A security-enabled/disabled local/global/universal group was created -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[A security-(?:dis|en)abled <type:gPatStr> group was created.\s+Subject:<_subject:gPatMesgBody>(?:New )?Group:<_grp:gPatMesgBody>\s+Additional Information:]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_grp">
          <regex><![CDATA[Group Name: <targetUserGrp:gPatMesgBody>\s+Group Domain: <targetDomain:gPatMesgBody>\s+Attributes:]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '4735, 4737, 4755, 4745, 4750, 4760'">
        <!-- A security-enabled/disabled local/global/unversal group was modified -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Group:<_grp:gPatMesgBody>Changed Attributes:<_attrib:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_grp">
          <regex><![CDATA[.*Group Name:  <targetUserGrp:gPatMesgBody>Group Domain:  <targetDomain:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4739'">
        <!-- Domain Policy was changed -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Domain:<_dom:gPatMesgBody>Changed Attributes:<_attrib:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_dom">
          <attrKeyMap attr="targetDomain" key="Domain Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4740'">
        <!-- A user account was locked out -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Account That Was Locked Out:<_target:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" \\|\t" src="$_target">
          <attrKeyMap attr="user" key="Account Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" \\|\t" src="$_addl">
          <attrKeyMap attr="srcIpAddr" key="Caller Computer Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <switch>
          <case>
            <collectFieldsByRegex src="$_srcIpAddr">
              <regex><![CDATA[<srcIpAddr:gPatIpAddr>]]></regex>
            </collectFieldsByRegex>
          </case>
          <default>
            <setEventAttribute attr="srcName">replaceStrInStr($_srcIpAddr, "\\", "")</setEventAttribute>
          </default>
        </switch>

        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <setEventAttribute attr="eventSeverity">10</setEventAttribute>
      </when>

      <when test="$_id = '4741'">
        <!-- new computer account created -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>New Computer Account:<_acct:gPatMesgBody>Attributes:<_attrib:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="hostName">replaceStringByRegex($targetUser, "\$", "")</setEventAttribute>

        <collectAndSetAttrByKeyValuePair sep=" " src="$_attrib">
          <attrKeyMap attr="fqdnName" key="DNS Host Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4742'">
        <!-- computer account changed -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Computer Account That Was Changed:<_acct:gPatMesgBody>Attributes:<_attrib:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4743'">
        <!-- computer account deleted -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Target Computer:<_acct:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="hostName">replaceStringByRegex($targetUser, "\$", "")</setEventAttribute>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '4746, 4751, 4761, 4728, 4732, 4756, 4785, 4787'">
        <!-- A member was added to a security-enabled global group -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Member:<_member:gPatMesgBody>Group:<_grp:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="fileName">$_subject</setEventAttribute>
        <collectAndSetAttrByKeyValuePair sep=" \\|\t" src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>

        <switch>
          <case>
            <collectFieldsByRegex src="$_grp">
              <regex><![CDATA[Account Name: <targetUserGrp:gPatMesgBody>\s+Account Domain: <targetDomain:gPatStr>]]></regex>
            </collectFieldsByRegex>
          </case>
          <case>
            <collectFieldsByRegex src="$_grp">
              <regex><![CDATA[Group Name: <targetUserGrp:gPatMesgBody>\s+Group Domain: <targetDomain:gPatStr>]]></regex>
            </collectFieldsByRegex>
          </case>
        </switch>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '4747, 4752, 4762, 4729, 4733, 4757, 4786, 4788'">
        <!-- A member was removed from a security-enabled global group -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:\s+<_subject:gPatMesgBody>Member:\s+<_member:gPatMesgBody>Group:<_grp:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" \\|\t" src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_grp">
          <regex><![CDATA[.*Group Name:\s+<targetUserGrp:gPatMesgBody>Group Domain:\s+ <targetDomain:gPatStr>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4767'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[Subject:\s+<_subj:gPatMesgBody>Target Account:\s+<_targetAcct:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subj">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_targetAcct">
          <attrKeyMap attr="targetUser" key="Account Name: "/>
          <attrKeyMap attr="_targetDomain" key="Account Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_targetDomain">
          <regex><![CDATA[<targetDomain:gPatStr>\s+\d+]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4768'">
        <!-- domain auth success/failure -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Account Information:<_account:gPatMesgBody>Service Information:<_service:gPatMesgBody>Network Information:<_network:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>Certificate Information:<_cert:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_account">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Supplied Realm Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_addl">
          <attrKeyMap attr="winKerbFailCode" key="Result Code:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_network">
          <attrKeyMap attr="srcIpAddr" key="Client Address:  "/>
          <attrKeyMap attr="srcIpPort" key="Client Port:  "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="$winKerbFailCode IN '-,0x0'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_id = '4769'">
        <!-- ticket grant success/failure -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Account Information:<_account:gPatMesgBody>Service Information:<_service:gPatMesgBody>Network Information:<_network:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_account">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_service">
          <attrKeyMap attr="winSrvcName" key="Service Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_addl">
          <attrKeyMap attr="winKerbFailCode" key="Failure Code:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_network">
          <attrKeyMap attr="srcIpAddr" key="Client Address:  "/>
          <attrKeyMap attr="srcIpPort" key="Client Port:  "/>
        </collectAndSetAttrByKeyValuePair>
        <choose>
          <when test="$winKerbFailCode IN '-, 0x0'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">1</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_id = '4770'">
        <!-- ticket grant success/failure -->
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[Account Information:<_account:gPatMesgBody>Service Information:<_service:gPatMesgBody>Network Information:<_network:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_account">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Domain: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_service">
          <attrKeyMap attr="winSrvcName" key="Service Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_addl">
          <attrKeyMap attr="_ticketOpt" key="Ticket Options: "/>
          <attrKeyMap attr="_ticketType" key="Ticket Encryption Type: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_network">
          <attrKeyMap attr="srcIpAddr" key="Client Address: "/>
          <attrKeyMap attr="srcIpPort" key="Client Port: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '4771'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Account Information:<_account:gPatMesgBody>Service Information:<_service:gPatMesgBody>Network Information:<_network:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>Certificate Information:<_cert:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_account">
          <attrKeyMap attr="user" key="Account Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_service">
          <attrKeyMap attr="winSrvcName" key="Service Name:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_addl">
          <attrKeyMap attr="winKerbFailCode" key="Failure Code:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_network">
          <attrKeyMap attr="_srcIpAddr" key="Client Address:  "/>
          <attrKeyMap attr="srcIpPort" key="Client Port:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_srcIpAddr">
          <regex><![CDATA[[^\d]*<srcIpAddr:gPatIpAddr>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="eventSeverity">3</setEventAttribute>
      </when>

      <when test="$_id = '4776'">
        <!-- The domain controller attempted to validate the credentials for an account -->
        <collectAndSetAttrByKeyValuePair sep="  \\|\t" src="$_body">
          <attrKeyMap attr="user" key="Logon Account: "/>
          <attrKeyMap attr="srcName" key="Source Workstation: "/>
          <attrKeyMap attr="winLogonFailCode2" key="Error Code: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
        <setEventAttribute attr="type">$_action</setEventAttribute>
        <choose>
          <when test="$_action IN 'Audit Success, Success Audit'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-success")</setEventAttribute>
          </when>
          <when test="$_action = 'Audit Failure'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-failure")</setEventAttribute>
            <setEventAttribute attr="eventSeverity">3</setEventAttribute>
          </when>
        </choose>
        <setEventAttribute attr="srcName">replaceStrInStr($srcName, "\\", "")</setEventAttribute>
      </when>

      <when test="$_id = '4783'">
        <!-- basic application group created -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Group:<_acct:gPatMesgBody>Attributes:<_attrib:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id = '4784'">
        <!-- basic application group changed -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subject:gPatMesgBody>Group:<_acct:gPatMesgBody>Attributes:<_attrib:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_acct">
          <attrKeyMap attr="targetUser" key="Account Name:  "/>
          <attrKeyMap attr="targetDomain" key="Account Domain:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEvent.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEvent.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">4</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '4789, 4763, 4748, 4753, 4734, 4758, 4730'">
        <!-- A security-enabled/disabled local/global/universal group was deleted -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[A security-(?:dis|en)abled <type:gPatStr> group was deleted.\s+Subject:<_subject:gPatMesgBody>(?:Deleted )?Group:<_grp:gPatMesgBody>Additional Information:<_addl:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subject">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_grp">
          <regex><![CDATA[.*Group Name:  <targetUserGrp:gPatMesgBody>\s+Group Domain:  <targetDomain:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrFromAnotherEvent AnotherEventType="Win-Security-4624">
          <when test="$winLogonId = $AnotherEventType.winLogonId">
            <setEventAttribute attr="srcIpAddr">$AnotherEventType.srcIpAddr</setEventAttribute>
          </when>
        </collectAndSetAttrFromAnotherEvent>
        <choose>
          <when test="matches($_action, '^Success')">
            <setEventAttribute attr="eventSeverity">5</setEventAttribute>
          </when>
          <when test="matches($_action, '^Failure)">
            <setEventAttribute attr="eventSeverity">7</setEventAttribute>
          </when>
        </choose>
      </when>

      <when test="$_id IN '4800,4801'">
        <!-- The workstation was locked/unlocked -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Subject:<_subj:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_subj">
          <attrKeyMap attr="user" key="Account Name:  "/>
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="winLogonId" key="Logon ID:  "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '4907'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjName" key="Object Name: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '4931'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="destIpAddr" key="Destination Address: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '4985'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="procName" key="Process Name: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '5136'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="domain" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '5137'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="userDN" key="DN: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '5140'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id IN '5142, 5143, 5144'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="fileName" key="Share Path: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '5145'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
          <attrKeyMap attr="osObjType" key="Object Type: "/>
          <attrKeyMap attr="fileName" key="Share Path: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <when test="$_id = '5156'">
        <!-- The Windows Filtering Platform has allowed a connection -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Application Information:<_appl:gPatMesgBody>Network Information:<_net:gPatMesgBody>Filter Information:<_filter:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_appl">
          <attrKeyMap attr="appName" key="Application Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_net">
          <regex><![CDATA[.*Direction:\s+<:gPatStr>\s+Source Address:\s+<srcIpAddr:gPatIpAddr>\s+Source Port:\s+<srcIpPort:gPatIpPort>\s+Destination Address:\s+<destIpAddr:gPatIpAddr>\s+Destination Port:\s+<destIpPort:gPatIpPort>\s+Protocol:\s+<ipProto:gPatInt>.*]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '5157'">
        <!-- The Windows Filtering Platform has blocked a connection -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Application Information:<_appl:gPatMesgBody>Network Information:<_net:gPatMesgBody>Filter Information:<_filter:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <collectAndSetAttrByKeyValuePair sep=" " src="$_appl">
          <attrKeyMap attr="appName" key="Application Name: "/>
        </collectAndSetAttrByKeyValuePair>
        <collectFieldsByRegex src="$_net">
          <regex><![CDATA[.*Direction:\s+<:gPatStr>\s+Source Address:\s+<srcIpAddr:gPatIpAddr>\s+Source Port:\s+<srcIpPort:gPatIpPort>\s+Destination Address:\s+<destIpAddr:gPatIpAddr>\s+Destination Port:\s+<destIpPort:gPatIpPort>\s+Protocol:\s+<ipProto:gPatInt>.*]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="eventSeverity">5</setEventAttribute>
      </when>

      <when test="$_id = '5159'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="appName" key="Application Name: "/>
          <attrKeyMap attr="ipProto" key="Protocol: "/>
          <attrKeyMap attr="srcIpAddr" key="Source Address: "/>
          <attrKeyMap attr="srcIpPort" key="Source Port: "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="eventSeverity">1</setEventAttribute>
      </when>

      <when test="$_id = '5168'">
        <collectAndSetAttrByKeyValuePair sep=" " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain: "/>
          <attrKeyMap attr="user" key="Account Name: "/>
          <attrKeyMap attr="winLogonId" key="Logon ID: "/>
        </collectAndSetAttrByKeyValuePair>
      </when>

      <!-- NK: Custom: Win-Security-6272, Win-Security-6278, Win-Security-6273, Win-Security-6274-->
      <when test="$_id IN '6272,6273,6274,6278'">
        <!--<14>Sep 12 14:42:04 example.com MSWinEventLog	0	Security	2123	Fri Sep 12 14:42:02 2014	6272	Microsoft-Windows-Security-Auditing	domain1\user	N/A	Success Audit	example.com	Network Policy Server		Network Policy Server granted access to a user.    User:   Security ID:   S-1-5-21-1144396095-541703293-2020251423-1425   Account Name:   user   Account Domain:   domain1   Fully Qualified Account Name: domain1\user    Client Machine:   Security ID:   S-1-0-0   Account Name:   -   Fully Qualified Account Name: -   OS-Version:   -   Called Station Identifier:  64-e9-50-b8-37-40:IND-SEC   Calling Station Identifier:  ac-cf-5c-9f-73-3f    NAS:   NAS IPv4 Address:  172.16.0.33   NAS IPv6 Address:  -   NAS Identifier:   WLC5508-3   NAS Port-Type:   Wireless - IEEE 802.11   NAS Port:   1    RADIUS Client:   Client Friendly Name:  WLC5508-3   Client IP Address:   172.22.35.4    Authentication Details:   Connection Request Policy Name: Use Windows authentication for all users   Network Policy Name:  802.1X Wireless Authentication (Account Authentication)   Authentication Provider:  Windows   Authentication Server:  example.com   Authentication Type:  EAP   EAP Type:   Microsoft: Smart Card or other certificate   Account Session Identifier:  -   Logging Results:   Accounting information was written to the local log file.    Quarantine Information:   Result:    Full Access   Session Identifier:   -  	2111-->
        <!--<14>Sep 12 15:31:34 example.com MSWinEventLog	0	Security	6208	Fri Sep 12 15:31:33 2014	6274	Microsoft-Windows-Security-Auditing	domain1\448e1200a265	N/A	Failure Audit	example.com	Network Policy Server		Network Policy Server discarded the request for a user.    Contact the Network Policy Server administrator for more information.    User:   Security ID:   S-1-0-0   Account Name:   448e1200a265   Account Domain:   domain1   Fully Qualified Account Name: domain1\448e1200a265    Client Machine:   Security ID:   S-1-0-0   Account Name:   -   Fully Qualified Account Name: -   OS-Version:   -   Called Station Identifier:  00-1f-12-34-52-40   Calling Station Identifier:  44-8e-12-00-a2-65    NAS:   NAS IPv4 Address:  172.20.1.123   NAS IPv6 Address:  -   NAS Identifier:   CL-SW-CARN-L1   NAS Port-Type:   Ethernet   NAS Port:   172    RADIUS Client:   Client Friendly Name:  CL-SW-CARN-L1   Client IP Address:   172.20.1.123    Authentication Details:   Connection Request Policy Name: Use Windows authentication for all users   Network Policy Name:  -   Authentication Provider:  Windows   Authentication Server:  example.com   Authentication Type:  EAP   EAP Type:   -   Account Session Identifier:  384F322E317838313438303234643030303935646534   Reason Code:   5   Reason:    The Network Policy Server was unable to connect to a domain controller in the domain where the account is located. Because of this, authentication and authorization for the RADIUS request could not be performed.  	6182-->
        <collectAndSetAttrByKeyValuePair sep="   " src="$_body">
          <attrKeyMap attr="domain" key="Account Domain:  "/>
          <attrKeyMap attr="_tmpuser" key="Account Name:  "/>
          <attrKeyMap attr="calledStationId" key="Called Station Identifier:  "/>
          <attrKeyMap attr="callingStationId" key="Calling Station Identifier:  "/>
          <attrKeyMap attr="destIpAddr" key="NAS IPv4 Address:  "/>
          <attrKeyMap attr="nasId" key="NAS Identifier:  "/>
          <attrKeyMap attr="nasPortType" key="NAS Port-Type:  "/>
          <attrKeyMap attr="destIpPort" key="NAS Port:  "/>
          <attrKeyMap attr="srcName" key="Client Friendly Name:  "/>
          <attrKeyMap attr="srcIpAddr" key="Client IP Address:  "/>
          <attrKeyMap attr="policyName" key="Network Policy Name:  "/>
          <attrKeyMap attr="authenMethod" key="Authentication Type:  "/>
          <attrKeyMap attr="eapType" key="EAP Type:  "/>
        </collectAndSetAttrByKeyValuePair>
        <setEventAttribute attr="user">replaceStringByRegex($_tmpuser, ".*(/|\\)|@.*", "")</setEventAttribute>

      </when>

      <when test="$_id = '7035'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[<:patWordTab>\s+<:patWordTab>\s+The <procName:gPatMesgBody> service<:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
      </when>

      <when test="$_id = '7036'">
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[<:patWordTab>\s+<:patWordTab>\s+The <procName:gPatMesgBody> service entered the <_state:gPatStr> state<:gPatMesgBody>]]></regex>
        </collectFieldsByRegex>
        <setEventAttribute attr="appName">$procName</setEventAttribute>
        <choose>
          <when test="$_state = 'running'">
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Start")</setEventAttribute>
          </when>
          <otherwise>
            <setEventAttribute attr="eventType">combineMsgId($eventType, "-Stop")</setEventAttribute>
          </otherwise>
        </choose>
      </when>

      <when test="$_id = '17137'">
        <!-- Starting up database 'mssql' -->
        <collectFieldsByRegex src="$_body">
          <regex><![CDATA[.*Starting up database '<dbName:gPatStr>']]></regex>
        </collectFieldsByRegex>
      </when>

      <when test="$_id IN '18453,18454'">
        <!-- MS-SQL successful login (non-trusted and trusted) -->
        <when test="$eventSource = 'MSSQLSERVER'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[.*Login\s+succeeded\s+for\s+user\s+'<user:patStrQuote>'\.\s+Connection:\s*<_connType:gPatStr>\.\s+\[CLIENT:\s*<_srcId:patStrRightSquareBracket>\]<:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
        </when>
        <!-- set src ip or name -->
        <switch>
          <case>
            <collectFieldsByRegex src="$_srcId">
              <regex><![CDATA[local machine]]></regex>
            </collectFieldsByRegex>
            <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
          </case>
          <case>
            <collectFieldsByRegex src="$_srcId">
              <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
            </collectFieldsByRegex>
          </case>
        </switch>
      </when>

      <when test="$_id = '18456'">
        <!-- MS-SQL failed login -->
        <when test="$eventSource = 'MSSQLSERVER'">
          <collectFieldsByRegex src="$_body">
            <regex><![CDATA[Login\s+failed\s+for\s+user\s+'<user:patStrQuote>'\..*\[CLIENT:\s*<_srcId:patStrRightSquareBracket>\]]]></regex>
          </collectFieldsByRegex>
          <switch>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[local machine]]></regex>
              </collectFieldsByRegex>
              <setEventAttribute attr="srcIpAddr">$reptDevIpAddr</setEventAttribute>
            </case>
            <case>
              <collectFieldsByRegex src="$_srcId">
                <regex><![CDATA[^<srcIpAddr:gPatIpAddr>$]]></regex>
              </collectFieldsByRegex>
            </case>
          </switch>
        </when>
      </when>
    </choose>

    <when test="exist procName">
      <setEventAttribute attr="swProcName">$procName</setEventAttribute>
      <when test="not exist appName">
        <setEventAttribute attr="appName">$procName</setEventAttribute>
      </when>
    </when>

    <when test="exist user">
      <switch>
        <case>
          <collectFieldsByRegex src="$user">
            <regex><![CDATA[^\s*<domain:gPatStr>[\\]<user:gPatStr>\s*$]]></regex>
          </collectFieldsByRegex>
        </case>
        <default/>
      </switch>
    </when>

    <when test="exist winLogonFailCode2">
      <setEventAttribute attr="winLogonFailCode2">toUpper($winLogonFailCode2)</setEventAttribute>
    </when>

    <when test="exist _member">
      <switch>
        <case>
          <collectFieldsByRegex src="$_member">
            <regex><![CDATA[Account Name:.*?\bCN=<targetUser:patComma>]]></regex>
          </collectFieldsByRegex>
        </case>
        <case>
          <collectFieldsByRegex src="$_member">
            <regex><![CDATA[Account Name:<_targetUser:gPatMesgBody>]]></regex>
          </collectFieldsByRegex>
          <when test="not_exist targetUser">
            <setEventAttribute attr="targetUser">$_targetUser</setEventAttribute>
          </when>
        </case>
        <default/>
      </switch>
    </when>
  </parsingInstructions>
</eventParser>
